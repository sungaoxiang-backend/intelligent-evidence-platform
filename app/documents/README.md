# æ–‡ä¹¦ç”Ÿæˆæ¨¡å— - ç®€åŒ–ç‰ˆæœ¬

## åŠŸèƒ½æ¦‚è¿°

æ–‡ä¹¦ç”Ÿæˆæ¨¡å—æ˜¯ä¸€ä¸ªèƒ½å¤Ÿæ ¹æ®æ¡ˆä»¶æ•°æ®è‡ªåŠ¨ç”ŸæˆWordæ–‡æ¡£çš„å·¥å…·ï¼Œæ”¯æŒå¤šç§æ–‡ä¹¦ç±»å‹ï¼Œå¦‚èµ·è¯‰çŠ¶ã€è¯æ®ææ–™æ¸…å•ç­‰ã€‚è¯¥æ¨¡å—é‡‡ç”¨**é™æ€æ–‡ä»¶ç®¡ç†**çš„è®¾è®¡ç†å¿µï¼Œæ— éœ€æ•°æ®åº“ä¾èµ–ï¼Œé€šè¿‡YAMLé…ç½®æ–‡ä»¶å’ŒWordæ¨¡æ¿æ–‡ä»¶å®ç°çµæ´»é…ç½®ã€‚

## ğŸ¯ è®¾è®¡ç†å¿µ

### ä¸ºä»€ä¹ˆé€‰æ‹©é™æ€æ–‡ä»¶ç®¡ç†ï¼Ÿ

1. **ç®€å•æ€§**: æ— éœ€æ•°æ®åº“è¿ç§»ã€è¡¨ç»“æ„è®¾è®¡ç­‰å¤æ‚æ“ä½œ
2. **çµæ´»æ€§**: é…ç½®æ–‡ä»¶å¯ä»¥ç›´æ¥ä¿®æ”¹ï¼Œæ— éœ€é‡æ–°éƒ¨ç½²
3. **å¯ç»´æŠ¤æ€§**: æ¨¡æ¿æ–‡ä»¶å¯ä»¥ç‰ˆæœ¬æ§åˆ¶ï¼Œä¾¿äºå›¢é˜Ÿåä½œ
4. **éƒ¨ç½²å‹å¥½**: å‡å°‘å¤–éƒ¨ä¾èµ–ï¼Œéƒ¨ç½²æ›´ç®€å•
5. **å¼€å‘æ•ˆç‡**: å¿«é€Ÿè¿­ä»£ï¼Œæ— éœ€è€ƒè™‘æ•°æ®ä¸€è‡´æ€§

## æ¶æ„è®¾è®¡

### ç®€åŒ–æ¨¡å—ç»“æ„

```
app/documents/
â”œâ”€â”€ __init__.py          # æ¨¡å—åˆå§‹åŒ–ï¼Œå¯¼å‡ºæ ¸å¿ƒç±»
â”œâ”€â”€ schemas.py           # APIæ•°æ®ç»“æ„å®šä¹‰
â”œâ”€â”€ services.py          # ä¸šåŠ¡é€»è¾‘æœåŠ¡å±‚
â”œâ”€â”€ routers.py           # APIè·¯ç”±å®šä¹‰
â”œâ”€â”€ templates.yaml       # æ¨¡æ¿é…ç½®æ–‡ä»¶
â”œâ”€â”€ README.md            # æ¨¡å—è¯´æ˜æ–‡æ¡£
â””â”€â”€ USAGE.md             # ä½¿ç”¨è¯´æ˜æ–‡æ¡£
```

### æ ¸å¿ƒç»„ä»¶

1. **æ•°æ®æ¨¡å¼ (schemas.py)**
   - `DocumentGenerateRequest`: æ–‡ä¹¦ç”Ÿæˆè¯·æ±‚
   - `DocumentGenerateResponse`: æ–‡ä¹¦ç”Ÿæˆå“åº”
   - `DocumentTemplateInfo`: æ–‡ä¹¦æ¨¡æ¿ä¿¡æ¯
   - `CaseDataForDocument`: æ¡ˆä»¶æ•°æ®æ¨¡å¼

2. **ä¸šåŠ¡æœåŠ¡ (services.py)**
   - `DocumentGenerator`: æ–‡ä¹¦ç”Ÿæˆå™¨ä¸»ç±»
   - é…ç½®ç®¡ç†ã€æ¨¡æ¿å¤„ç†ã€å˜é‡æ›¿æ¢ã€æ–‡æ¡£ç”Ÿæˆ

3. **APIè·¯ç”± (routers.py)**
   - RESTful APIæ¥å£
   - ç»Ÿä¸€çš„å“åº”æ ¼å¼
   - å®Œæ•´çš„é”™è¯¯å¤„ç†

## æŠ€æœ¯ç‰¹ç‚¹

### 1. é™æ€é…ç½®ç®¡ç†
- ä½¿ç”¨YAMLé…ç½®æ–‡ä»¶ç®¡ç†æ¨¡æ¿ä¿¡æ¯
- æ”¯æŒçƒ­é‡è½½ï¼Œä¿®æ”¹é…ç½®æ— éœ€é‡å¯æœåŠ¡
- ç»“æ„åŒ–çš„å˜é‡å®šä¹‰å’ŒéªŒè¯

### 2. æ™ºèƒ½å˜é‡ç³»ç»Ÿ
- è‡ªåŠ¨æ˜ å°„æ¡ˆä»¶æ•°æ®åˆ°æ¨¡æ¿å˜é‡
- æ”¯æŒè‡ªå®šä¹‰å˜é‡æ‰©å±•
- æ™ºèƒ½ç”Ÿæˆæ¡ˆä»¶æ ‡é¢˜å’Œç¼–å·

### 3. æ¨¡æ¿å¼•æ“
- ä½¿ç”¨docxtplå¤„ç†Wordæ¨¡æ¿
- æ”¯æŒ`{{å˜é‡å}}`è¯­æ³•
- è‡ªåŠ¨åˆ›å»ºé»˜è®¤æ¨¡æ¿æ–‡ä»¶

### 4. æ–‡ä»¶ç®¡ç†
- è‡ªåŠ¨åˆ›å»ºå¿…è¦çš„ç›®å½•ç»“æ„
- æ™ºèƒ½æ–‡ä»¶å‘½åå’Œè·¯å¾„ç®¡ç†
- æ”¯æŒæ–‡ä»¶ä¸‹è½½å’Œè®¿é—®

## æ”¯æŒçš„æ–‡ä¹¦ç±»å‹

- **èµ·è¯‰çŠ¶** (`complaint`): é€‚ç”¨äºå„ç§çº çº·æ¡ˆä»¶
- **è¯æ®ææ–™æ¸…å•** (`evidence_list`): æ•´ç†æ¡ˆä»¶è¯æ®
- **è°ƒè§£åè®®** (`settlement_agreement`): æ¡ˆä»¶è°ƒè§£
- **åˆ¤å†³ä¹¦** (`judgment`): æ³•é™¢åˆ¤å†³
- **é€šçŸ¥ä¹¦** (`notice`): å„ç§æ³•å¾‹é€šçŸ¥
- **å…¶ä»–** (`other`): è‡ªå®šä¹‰æ–‡ä¹¦ç±»å‹

## APIæ¥å£

### åŸºç¡€è·¯å¾„
```
/api/v1/documents/*
```

### ä¸»è¦ç«¯ç‚¹

| æ–¹æ³• | è·¯å¾„ | æè¿° |
|------|------|------|
| GET | `/templates` | è·å–å¯ç”¨æ¨¡æ¿åˆ—è¡¨ |
| POST | `/generate` | ç”Ÿæˆæ–‡ä¹¦ |
| GET | `/download/{filename}` | ä¸‹è½½ç”Ÿæˆçš„æ–‡ä¹¦ |
| POST | `/init-templates` | åˆå§‹åŒ–ç¤ºä¾‹æ¨¡æ¿ |
| GET | `/health` | å¥åº·æ£€æŸ¥ |

## ä½¿ç”¨æ–¹æ³•

### 1. åŸºæœ¬ä½¿ç”¨

```python
from app.documents.services import DocumentGenerator

# åˆ›å»ºç”Ÿæˆå™¨
generator = DocumentGenerator()

# å‡†å¤‡æ¡ˆä»¶æ•°æ®
case_data = {
    "case_id": 12345,
    "case_type": "å€Ÿæ¬¾çº çº·",
    "creditor_name": "å¼ ä¸‰",
    "debtor_name": "æå››",
    "loan_amount": 50000.0,
    "description": "ä¸ªäººå€Ÿæ¬¾çº çº·æ¡ˆä»¶"
}

# ç”Ÿæˆæ–‡ä¹¦
result = generator.generate_document(
    template_id="complaint_template",
    case_data=case_data,
    custom_variables={"loan_date": "2023å¹´1æœˆ1æ—¥"}
)
```

### 2. APIè°ƒç”¨

```bash
# ç”Ÿæˆèµ·è¯‰çŠ¶
curl -X POST "http://localhost:8008/api/v1/documents/generate" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer {token}" \
  -d '{
    "template_id": "complaint_template",
    "case_id": 12345,
    "variables": {
      "loan_date": "2023å¹´1æœˆ1æ—¥",
      "due_date": "2023å¹´12æœˆ31æ—¥"
    }
  }'
```

## é…ç½®ç®¡ç†

### æ¨¡æ¿é…ç½® (templates.yaml)

```yaml
templates:
  complaint_template:
    name: "å€Ÿæ¬¾çº çº·èµ·è¯‰çŠ¶æ¨¡æ¿"
    type: "complaint"
    description: "é€‚ç”¨äºä¸ªäººå€Ÿæ¬¾çº çº·æ¡ˆä»¶çš„èµ·è¯‰çŠ¶æ¨¡æ¿"
    file_path: "templates/documents/complaint_template.docx"
    variables:
      - name: "creditor_name"
        description: "å€ºæƒäººå§“å"
        required: true
        default: ""
      - name: "debtor_name"
        description: "å€ºåŠ¡äººå§“å"
        required: true
        default: ""
```

### ç¯å¢ƒé…ç½®

- æ¨¡æ¿ç›®å½•: `templates/documents/`
- è¾“å‡ºç›®å½•: `static/documents/`
- é…ç½®æ–‡ä»¶: `app/documents/templates.yaml`

## æ‰©å±•å¼€å‘

### æ·»åŠ æ–°æ–‡ä¹¦ç±»å‹

1. **é…ç½®æ¨¡æ¿ä¿¡æ¯**
   ```yaml
   # åœ¨templates.yamlä¸­æ·»åŠ 
   new_type_template:
     name: "æ–°æ–‡ä¹¦æ¨¡æ¿"
     type: "new_type"
     description: "æ–°ç±»å‹æ–‡ä¹¦çš„æè¿°"
     file_path: "templates/documents/new_type_template.docx"
     variables:
       - name: "custom_field"
         description: "è‡ªå®šä¹‰å­—æ®µ"
         required: true
   ```

2. **åˆ›å»ºæ¨¡æ¿æ–‡ä»¶**
   - åœ¨`templates/documents/`ç›®å½•ä¸‹åˆ›å»º`.docx`æ–‡ä»¶
   - ä½¿ç”¨`{{å˜é‡å}}`è¯­æ³•å®šä¹‰å˜é‡å ä½ç¬¦

3. **æ·»åŠ ä¸šåŠ¡é€»è¾‘**ï¼ˆå¯é€‰ï¼‰
   ```python
   # åœ¨DocumentGeneratorä¸­æ‰©å±•å˜é‡å¤„ç†
   def _prepare_variables(self, template, case_data, custom_variables):
       variables = super()._prepare_variables(...)
       
       if template.get("type") == "new_type":
           variables["special_field"] = self._calculate_special_value(case_data)
       
       return variables
   ```

### è‡ªå®šä¹‰å˜é‡å¤„ç†

```python
def _prepare_variables(self, template, case_data, custom_variables):
    variables = {
        "creditor_name": case_data.get("creditor_name", ""),
        "debtor_name": case_data.get("debtor_name", ""),
        "case_type": case_data.get("case_type", "å€Ÿæ¬¾çº çº·"),
        # ... å…¶ä»–åŸºç¡€å˜é‡
    }
    
    # åˆå¹¶è‡ªå®šä¹‰å˜é‡
    if custom_variables:
        variables.update(custom_variables)
    
    return variables
```

## ç»´æŠ¤å’Œç›‘æ§

### å¥åº·æ£€æŸ¥

```bash
GET /api/v1/documents/health
```

è¿”å›ç³»ç»ŸçŠ¶æ€ä¿¡æ¯ï¼š
- ç›®å½•å­˜åœ¨æ€§æ£€æŸ¥
- æ¨¡æ¿æ–‡ä»¶å®Œæ•´æ€§
- æœåŠ¡è¿è¡ŒçŠ¶æ€

### æ—¥å¿—è®°å½•

- ä½¿ç”¨é¡¹ç›®ç»Ÿä¸€çš„æ—¥å¿—ç³»ç»Ÿ
- è®°å½•æ‰€æœ‰å…³é”®æ“ä½œ
- é”™è¯¯è¿½è¸ªå’Œè°ƒè¯•ä¿¡æ¯

### æ€§èƒ½ä¼˜åŒ–

- é…ç½®æ–‡ä»¶ç¼“å­˜
- æ¨¡æ¿æ–‡ä»¶é¢„åŠ è½½
- å¼‚æ­¥æ–‡ä»¶æ“ä½œ

## æœ€ä½³å®è·µ

### 1. æ¨¡æ¿è®¾è®¡
- ä½¿ç”¨æ¸…æ™°çš„å˜é‡å‘½å
- ä¿æŒæ¨¡æ¿ç»“æ„ä¸€è‡´
- æ·»åŠ å¿…è¦çš„è¯´æ˜æ³¨é‡Š
- ä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶ç®¡ç†æ¨¡æ¿æ–‡ä»¶

### 2. é…ç½®ç®¡ç†
- ç»“æ„åŒ–å˜é‡å®šä¹‰
- æ¸…æ™°çš„æè¿°ä¿¡æ¯
- åˆç†çš„é»˜è®¤å€¼è®¾ç½®
- é…ç½®æ–‡ä»¶ç‰ˆæœ¬æ§åˆ¶

### 3. é”™è¯¯å¤„ç†
- å®Œæ•´çš„å¼‚å¸¸æ•è·
- å‹å¥½çš„é”™è¯¯ä¿¡æ¯
- ä¼˜é›…çš„é™çº§å¤„ç†
- è¯¦ç»†çš„æ—¥å¿—è®°å½•

### 4. å®‰å…¨è€ƒè™‘
- æ–‡ä»¶è·¯å¾„éªŒè¯
- ç”¨æˆ·æƒé™æ£€æŸ¥
- è¾“å…¥æ•°æ®éªŒè¯
- æ–‡ä»¶è®¿é—®æ§åˆ¶

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ¨¡æ¿æ–‡ä»¶ä¸å­˜åœ¨**
   - æ£€æŸ¥æ–‡ä»¶è·¯å¾„é…ç½®
   - è¿è¡Œåˆå§‹åŒ–æ¨¡æ¿æ¥å£
   - éªŒè¯ç›®å½•æƒé™

2. **å˜é‡æ›¿æ¢å¤±è´¥**
   - ç¡®è®¤æ¨¡æ¿è¯­æ³•æ­£ç¡®
   - æ£€æŸ¥å˜é‡ååŒ¹é…
   - éªŒè¯æ•°æ®å®Œæ•´æ€§

3. **é…ç½®æ–‡ä»¶é”™è¯¯**
   - æ£€æŸ¥YAMLè¯­æ³•
   - éªŒè¯é…ç½®ç»“æ„
   - æŸ¥çœ‹é”™è¯¯æ—¥å¿—

### è°ƒè¯•æ–¹æ³•

1. **å¯ç”¨è¯¦ç»†æ—¥å¿—**
   ```python
   import logging
   logging.basicConfig(level=logging.DEBUG)
   ```

2. **å¥åº·æ£€æŸ¥æ¥å£**
   ```bash
   curl http://localhost:8008/api/v1/documents/health
   ```

3. **é…ç½®æ–‡ä»¶éªŒè¯**
   ```bash
   # æ£€æŸ¥YAMLè¯­æ³•
   python -c "import yaml; yaml.safe_load(open('app/documents/templates.yaml'))"
   ```

## æ›´æ–°æ—¥å¿—

### v3.0.0 - ç®€åŒ–ç‰ˆæœ¬
- ç§»é™¤æ•°æ®åº“ä¾èµ–ï¼Œä½¿ç”¨é™æ€æ–‡ä»¶ç®¡ç†
- ç®€åŒ–æ¶æ„ï¼Œæé«˜å¼€å‘æ•ˆç‡
- å¢å¼ºé…ç½®çµæ´»æ€§
- ä¼˜åŒ–éƒ¨ç½²å’Œç»´æŠ¤

### v2.0.0 - æ ‡å‡†ç‰ˆæœ¬
- é‡æ„ä¸ºæ ‡å‡†æ¨¡å—æ¶æ„
- é›†æˆæ•°æ®åº“æ“ä½œ
- å®Œæ•´çš„CRUDæ¥å£
- ç»Ÿä¸€çš„é”™è¯¯å¤„ç†

### v1.0.0 - åŸºç¡€ç‰ˆæœ¬
- åŸºæœ¬çš„æ–‡ä¹¦ç”ŸæˆåŠŸèƒ½
- é…ç½®æ–‡ä»¶ç®¡ç†
- ç®€å•çš„APIæ¥å£

## ä¼˜åŠ¿æ€»ç»“

### ğŸš€ å¼€å‘æ•ˆç‡
- æ— éœ€æ•°æ®åº“è®¾è®¡å’Œè¿ç§»
- é…ç½®æ–‡ä»¶ç›´æ¥ä¿®æ”¹ç”Ÿæ•ˆ
- å¿«é€Ÿè¿­ä»£å’Œæµ‹è¯•

### ğŸ› ï¸ ç»´æŠ¤ç®€å•
- é™æ€æ–‡ä»¶æ˜“äºç‰ˆæœ¬æ§åˆ¶
- é…ç½®å˜æ›´æ— éœ€é‡å¯
- æ¸…æ™°çš„ç›®å½•ç»“æ„

### ğŸ”§ éƒ¨ç½²å‹å¥½
- å‡å°‘å¤–éƒ¨ä¾èµ–
- é…ç½®æ–‡ä»¶å¯æ‰“åŒ…éƒ¨ç½²
- æ”¯æŒå®¹å™¨åŒ–éƒ¨ç½²

### ğŸ“š å›¢é˜Ÿåä½œ
- æ¨¡æ¿æ–‡ä»¶å¯å…±äº«
- é…ç½®å˜æ›´å¯è¿½è¸ª
- æ”¯æŒåˆ†æ”¯å¼€å‘

## è”ç³»æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·ï¼š
1. æŸ¥çœ‹é¡¹ç›®æ–‡æ¡£
2. æ£€æŸ¥æ—¥å¿—ä¿¡æ¯
3. è¿è¡Œå¥åº·æ£€æŸ¥
4. è”ç³»å¼€å‘å›¢é˜Ÿ
