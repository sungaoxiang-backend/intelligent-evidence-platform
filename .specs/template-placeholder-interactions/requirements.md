# Requirements Document

## Introduction

该功能旨在让文书模板编辑器在“编辑模式”下，将文档中的双花括号占位符与左侧的占位符列表实时建立一一映射，并提供可交互的高亮、点击反馈与编辑能力，使模板配置员可以准确维护占位符（新增、编辑、删除）并保持画面与数据的一致性。同时，所有交互增强必须保证导出能力仍以原始占位符文本（如 `{{plaintiff_name}}`）输出，不得破坏既有渲染与导出链路。

## Requirements

### Requirement 1

**User Story:** 作为 模板配置管理员，我想在进入编辑模式时看到文档中所有占位符被自动识别并与左侧列表同步，以便快速定位和核对。

#### Acceptance Criteria

1. WHEN 用户切换到编辑模式 THEN 系统 SHALL 解析当前文档中的 `{{placeholder}}` 结构并生成唯一 ID 与偏移信息。
2. WHEN 占位符解析完成 THEN 系统 SHALL 将解析结果与左侧占位符列表中的数据源进行对齐，并在缺失或重复时标记告警状态。
3. IF 文档中存在未在列表登记的占位符 THEN 系统 SHALL 在列表中以“未绑定”状态展示并提示用户补全信息。

### Requirement 2

**User Story:** 作为 模板配置管理员，我希望文档中的占位符渲染成可交互的高亮块，并与左侧列表联动，以便定位和校验。

#### Acceptance Criteria

1. WHEN 文档渲染包含占位符节点 THEN 编辑器 SHALL 将其包装为单个不可拆分的块元素，具备 hover/click 样式。
2. WHEN 用户在文档中 hover 某个占位符块 THEN 左侧列表中对应项 SHALL 被同步高亮；反之亦然。
3. WHEN 占位符块被选中 THEN 编辑器 SHALL 显示聚焦样式并禁止用户在块内部插入非法字符，仅允许整体删除或通过专用面板编辑。
4. WHEN 文档处于可交互渲染状态 THEN 占位符块的 DOM 包装或样式增强 SHALL NOT 修改底层 ProseMirror/导出数据；导出结果仍以 `{{placeholder_name}}` 文本输出。

### Requirement 3

**User Story:** 作为 模板配置管理员，我想点击占位符后弹出编辑窗口修改其字段、描述、默认值等信息，并即时体现在文档与列表中。

#### Acceptance Criteria

1. WHEN 用户点击占位符块或列表中的编辑按钮 THEN 系统 SHALL 打开编辑对话框，展示当前占位符的名称、字段标识、描述、默认值等属性。
2. WHEN 用户在对话框中修改并保存 THEN 系统 SHALL 同时更新文档中的占位符文本与列表数据，并在接口成功后给出反馈。
3. IF 保存失败（如字段冲突或校验错误） THEN 系统 SHALL 保留原值并提示具体错误，不得导致文档与列表不一致。

### Requirement 4

**User Story:** 作为 模板配置管理员，我需要在编辑模式下新增或删除占位符，并保证列表、文档以及后端数据的同步。

#### Acceptance Criteria

1. WHEN 用户在列表中点击“新增占位符” THEN 系统 SHALL 提供创建表单，成功后在文档光标位置插入对应占位符块并刷新列表。
2. WHEN 用户选择删除占位符（无论在文档或列表） THEN 系统 SHALL 移除文档中的占位符块、从列表中删除记录，并触发持久化接口。
3. IF 删除的占位符被后端引用或存在依赖 THEN 系统 SHALL 阻止删除并提示原因，保持当前状态不变。
4. WHEN 新增、编辑、删除占位符完成后 THEN 导出与预览功能 SHALL 继续输出原始 `{{placeholder}}` 标记，不得嵌入额外样式字符。
