## ADDED Requirements

### Requirement: WPS 粘贴内容适配
系统 SHALL 正确处理从 WPS 粘贴的表格内容，确保内容不会超出单元格边界。

#### Scenario: 粘贴 WPS 表格内容
- **WHEN** 用户从 WPS 复制包含表格的内容并粘贴到编辑器
- **THEN** 粘贴的内容 SHALL 自动适配单元格宽度
- **AND** 长文本 SHALL 自动换行，不会溢出单元格
- **AND** 单元格样式 SHALL 被规范化，移除可能导致溢出的样式

### Requirement: 单元格上方插入
系统 SHALL 支持在选中单元格的上方插入新单元格。

#### Scenario: 在单元格上方插入
- **WHEN** 用户选中一个单元格并点击"在上方插入单元格"按钮
- **THEN** 系统 SHALL 在相同列的上方插入一个新单元格
- **AND** 新单元格 SHALL 与当前单元格具有相同的列位置
- **AND** 表格结构 SHALL 保持完整（所有行的单元格数量一致）

#### Scenario: 在合并单元格上方插入
- **WHEN** 用户选中一个合并单元格并点击"在上方插入单元格"按钮
- **THEN** 系统 SHALL 在合并区域的上方边界插入新单元格
- **AND** 新单元格 SHALL 跨越合并区域的列数（如果合并单元格跨多列）

### Requirement: 单元格下方插入
系统 SHALL 支持在选中单元格的下方插入新单元格。

#### Scenario: 在单元格下方插入
- **WHEN** 用户选中一个单元格并点击"在下方插入单元格"按钮
- **THEN** 系统 SHALL 在相同列的下方插入一个新单元格
- **AND** 新单元格 SHALL 与当前单元格具有相同的列位置
- **AND** 表格结构 SHALL 保持完整

#### Scenario: 在合并单元格下方插入
- **WHEN** 用户选中一个合并单元格并点击"在下方插入单元格"按钮
- **THEN** 系统 SHALL 在合并区域的下方边界插入新单元格
- **AND** 新单元格 SHALL 跨越合并区域的列数（如果合并单元格跨多列）

### Requirement: 单元格删除
系统 SHALL 支持删除单个单元格，并自动调整表格结构。

#### Scenario: 删除普通单元格
- **WHEN** 用户选中一个普通单元格并点击"删除单元格"按钮
- **THEN** 系统 SHALL 删除该单元格
- **AND** 后续单元格 SHALL 自动前移填补空缺
- **AND** 如果删除后某行没有单元格，系统 SHALL 自动删除该行
- **AND** 如果删除后某列没有单元格，系统 SHALL 自动删除该列

#### Scenario: 删除合并单元格的一部分
- **WHEN** 用户选中一个合并单元格并点击"删除单元格"按钮
- **THEN** 系统 SHALL 拆分合并单元格
- **AND** 删除选中的单元格部分
- **AND** 保留其他部分为独立单元格

### Requirement: 单元格合并
系统 SHALL 支持合并选中的多个单元格为一个单元格。

#### Scenario: 合并横向单元格
- **WHEN** 用户选中同一行的多个连续单元格并点击"合并单元格"按钮
- **THEN** 系统 SHALL 将这些单元格合并为一个单元格
- **AND** 合并后的单元格 SHALL 具有正确的 `colspan` 值
- **AND** 被合并的其他单元格 SHALL 被删除
- **AND** 合并后的单元格内容 SHALL 保留第一个单元格的内容

#### Scenario: 合并纵向单元格
- **WHEN** 用户选中同一列的多个连续单元格并点击"合并单元格"按钮
- **THEN** 系统 SHALL 将这些单元格合并为一个单元格
- **AND** 合并后的单元格 SHALL 具有正确的 `rowspan` 值
- **AND** 被合并的其他单元格 SHALL 被删除
- **AND** 合并后的单元格内容 SHALL 保留第一个单元格的内容

#### Scenario: 合并矩形区域
- **WHEN** 用户选中一个矩形区域的多个单元格并点击"合并单元格"按钮
- **THEN** 系统 SHALL 将这些单元格合并为一个单元格
- **AND** 合并后的单元格 SHALL 具有正确的 `colspan` 和 `rowspan` 值
- **AND** 被合并的其他单元格 SHALL 被删除
- **AND** 合并后的单元格内容 SHALL 保留第一个单元格的内容

#### Scenario: 合并包含已合并单元格的区域
- **WHEN** 用户选中的区域包含已合并的单元格
- **THEN** 系统 SHALL 先拆分已合并的单元格
- **AND** 然后执行新的合并操作

### Requirement: 单元格拆分
系统 SHALL 支持将合并的单元格拆分为原始结构。

#### Scenario: 拆分横向合并的单元格
- **WHEN** 用户选中一个横向合并的单元格（`colspan > 1`）并点击"拆分单元格"按钮
- **THEN** 系统 SHALL 将该单元格拆分为 `colspan` 个独立单元格
- **AND** 原单元格内容 SHALL 保留在第一个新单元格中
- **AND** 其他新单元格 SHALL 为空

#### Scenario: 拆分纵向合并的单元格
- **WHEN** 用户选中一个纵向合并的单元格（`rowspan > 1`）并点击"拆分单元格"按钮
- **THEN** 系统 SHALL 将该单元格拆分为 `rowspan` 个独立单元格
- **AND** 原单元格内容 SHALL 保留在第一个新单元格中
- **AND** 其他新单元格 SHALL 为空

#### Scenario: 拆分同时横向和纵向合并的单元格
- **WHEN** 用户选中一个同时横向和纵向合并的单元格（`colspan > 1` 且 `rowspan > 1`）并点击"拆分单元格"按钮
- **THEN** 系统 SHALL 将该单元格拆分为 `colspan × rowspan` 个独立单元格
- **AND** 原单元格内容 SHALL 保留在第一个新单元格中
- **AND** 其他新单元格 SHALL 为空

### Requirement: 表格操作工具栏
系统 SHALL 在编辑器工具栏中提供表格操作按钮。

#### Scenario: 显示表格操作按钮
- **WHEN** 用户将光标定位在表格单元格中
- **THEN** 系统 SHALL 在工具栏中显示表格操作按钮
- **AND** 按钮 SHALL 包括：插入单元格（上方/下方）、删除单元格、合并单元格、拆分单元格
- **AND** 按钮的启用/禁用状态 SHALL 根据当前选择动态更新

#### Scenario: 按钮可用性判断
- **WHEN** 用户选中一个普通单元格
- **THEN** "拆分单元格"按钮 SHALL 被禁用
- **AND** 其他按钮 SHALL 被启用
- **WHEN** 用户选中一个合并单元格
- **THEN** "拆分单元格"按钮 SHALL 被启用
- **AND** "合并单元格"按钮 SHALL 被禁用（除非选中多个单元格）

### Requirement: 表格单元格右键菜单
系统 SHALL 为表格单元格提供右键菜单，包含所有表格操作。

#### Scenario: 显示右键菜单
- **WHEN** 用户在表格单元格上右键点击
- **THEN** 系统 SHALL 显示上下文菜单
- **AND** 菜单 SHALL 包含所有表格操作选项（插入、删除、合并、拆分）
- **AND** 菜单项的启用/禁用状态 SHALL 根据当前选择动态更新

#### Scenario: 执行右键菜单操作
- **WHEN** 用户从右键菜单中选择一个操作
- **THEN** 系统 SHALL 执行相应的表格操作
- **AND** 菜单 SHALL 自动关闭

### Requirement: 合并单元格导出兼容性
系统 SHALL 确保合并单元格在导出为 DOCX 格式时正确处理。

#### Scenario: 导出包含合并单元格的文档
- **WHEN** 用户导出包含合并单元格的文档
- **THEN** 系统 SHALL 正确映射 `colspan` 和 `rowspan` 到 DOCX 格式
- **AND** 导出的文档 SHALL 在 WPS 中正确显示合并单元格

