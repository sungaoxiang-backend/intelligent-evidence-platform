# Design: 优化文书管理模块交互体验

## Context

当前文书管理模块已经实现了基本的 CRUD 功能，但在用户体验方面存在一些不足。本次优化主要关注三个方面的改进：

1. 编辑模式的按钮显示逻辑
2. 保存时的命名功能
3. 列表的快速操作功能

## Goals / Non-Goals

### Goals
- 优化编辑和预览模式的按钮显示，使交互更符合用户预期
- 提供保存时的命名功能，允许用户自定义文书名称
- 在列表中添加快速操作按钮，减少操作步骤

### Non-Goals
- 不改变现有的数据模型
- 不修改后端 API（API 已支持更新名称）
- 不添加批量操作功能（后续可扩展）

## Decisions

### 1. 编辑模式按钮显示逻辑

**问题**：当前 `DocumentEditor` 组件在编辑模式下显示了"导出 PDF"按钮，但用户期望编辑模式下只显示"保存"和"取消"按钮。

**解决方案**：
- 移除 `DocumentEditor` 组件中的 `onExport` prop 在编辑模式下的显示
- 在 `page.tsx` 中，只在预览模式下传递 `onExport` 给 `DocumentPreview` 组件
- 编辑模式下，`DocumentEditor` 只接收 `onSave` 和 `onCancel` props

**理由**：
- 编辑模式下导出没有意义，因为内容可能还在编辑中
- 预览模式下导出更符合用户预期，因为预览是最终内容的展示
- 简化编辑模式的界面，减少干扰

### 2. 保存时命名功能

**问题**：保存新文书时使用硬编码的"新文书"名称，更新时无法修改名称。

**解决方案**：
- 在 `page.tsx` 的 `handleSave` 函数中，保存前弹出对话框（使用 `Dialog` 组件）
- 对话框包含一个输入框，用于输入文书名称
- 如果是新文书，输入框为空；如果是更新文书，自动填充现有名称
- 用户确认后，使用输入的名称进行保存

**实现细节**：
- 使用 Shadcn UI 的 `Dialog` 组件
- 添加状态管理：`isSaveDialogOpen` 和 `documentName`
- 在 `handleSave` 中先打开对话框，用户确认后再执行实际的保存操作
- 保存时同时传递 `name` 字段到 API

**理由**：
- 对话框模式不会打断用户的编辑流程
- 自动填充现有名称提供良好的用户体验
- 使用现有的 UI 组件库，保持一致性

### 3. 列表快速操作

**问题**：列表只支持点击查看，编辑和删除需要多步操作。

**解决方案**：
- 在 `DocumentList` 组件的每个文书卡片上添加操作按钮区域
- 添加"编辑"按钮：点击后直接调用 `onEdit` callback，传入对应的文书
- 添加"删除"按钮：点击后弹出确认对话框，确认后调用 `onDelete` callback
- 按钮使用图标按钮，节省空间
- 使用 hover 效果，鼠标悬停时显示按钮

**实现细节**：
- 在 `DocumentListProps` 中添加 `onEdit` 和 `onDelete` callbacks
- 使用 `AlertDialog` 组件实现删除确认对话框
- 按钮使用 `Edit` 和 `Trash2` 图标（来自 lucide-react）
- 按钮布局：卡片右侧，使用 flex 布局
- 防止事件冒泡：按钮点击时阻止冒泡到卡片点击事件

**理由**：
- 快速操作减少用户操作步骤
- 删除确认对话框防止误操作
- 图标按钮节省空间，保持列表整洁

## Risks / Trade-offs

### 风险
1. **列表项布局变化**：添加按钮可能影响列表的视觉平衡
   - **缓解**：使用图标按钮，hover 显示，保持列表整洁
   
2. **事件冒泡问题**：按钮点击可能触发卡片的点击事件
   - **缓解**：在按钮点击事件中调用 `event.stopPropagation()`

3. **命名对话框打断流程**：每次保存都需要输入名称
   - **缓解**：自动填充现有名称，减少输入负担

### 权衡
- **对话框 vs 内联输入**：选择对话框模式，因为不会改变编辑器布局，用户体验更好
- **列表按钮 vs 预览按钮**：两者都保留，提供多种操作路径，满足不同用户习惯

## Migration Plan

1. **修改 DocumentEditor 组件**：移除编辑模式下的导出按钮显示逻辑
2. **修改 DocumentPreview 组件**：确保预览模式下有导出按钮
3. **修改 page.tsx**：
   - 添加保存对话框状态管理
   - 修改 `handleSave` 函数，添加命名对话框
   - 添加 `handleEditFromList` 和 `handleDelete` 函数
4. **修改 DocumentList 组件**：
   - 添加编辑和删除按钮
   - 添加删除确认对话框
   - 传递 `onEdit` 和 `onDelete` callbacks
5. **测试**：验证所有交互流程正常工作

## Open Questions

无

