2025-07-10 01:58:17 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://127.0.0.1:8000/docs
2025-07-10 01:58:17 | INFO | app.core.middleware:dispatch:19 - 完成请求: GET http://127.0.0.1:8000/docs - 状态码: 200 - 耗时: 0.0057秒
2025-07-10 01:58:17 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://127.0.0.1:8000/openapi.json
2025-07-10 01:58:17 | INFO | app.core.middleware:dispatch:19 - 完成请求: GET http://127.0.0.1:8000/openapi.json - 状态码: 200 - 耗时: 0.1024秒
2025-07-10 01:58:25 | INFO | app.core.middleware:dispatch:11 - 开始请求: POST http://127.0.0.1:8000/api/v1/login/access-token
2025-07-10 01:58:25 | INFO | app.core.middleware:dispatch:19 - 完成请求: POST http://127.0.0.1:8000/api/v1/login/access-token - 状态码: 401 - 耗时: 0.4227秒
2025-07-10 01:58:49 | INFO | app.core.middleware:dispatch:11 - 开始请求: POST http://127.0.0.1:8000/api/v1/login/access-token
2025-07-10 01:58:49 | INFO | app.core.middleware:dispatch:19 - 完成请求: POST http://127.0.0.1:8000/api/v1/login/access-token - 状态码: 401 - 耗时: 0.3332秒
2025-07-10 02:01:26 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://127.0.0.1:8000/docs
2025-07-10 02:01:26 | INFO | app.core.middleware:dispatch:19 - 完成请求: GET http://127.0.0.1:8000/docs - 状态码: 200 - 耗时: 0.0169秒
2025-07-10 02:01:27 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://127.0.0.1:8000/openapi.json
2025-07-10 02:01:27 | INFO | app.core.middleware:dispatch:19 - 完成请求: GET http://127.0.0.1:8000/openapi.json - 状态码: 200 - 耗时: 0.0745秒
2025-07-10 02:01:36 | INFO | app.core.middleware:dispatch:11 - 开始请求: POST http://127.0.0.1:8000/api/v1/login/access-token
2025-07-10 02:01:37 | INFO | app.core.middleware:dispatch:19 - 完成请求: POST http://127.0.0.1:8000/api/v1/login/access-token - 状态码: 200 - 耗时: 0.4223秒
2025-07-10 02:01:44 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://127.0.0.1:8000/api/v1/evidences/with-cases?skip=0&limit=100
2025-07-10 02:01:44 | INFO | app.core.middleware:dispatch:19 - 完成请求: GET http://127.0.0.1:8000/api/v1/evidences/with-cases?skip=0&limit=100 - 状态码: 200 - 耗时: 0.0691秒
2025-07-10 02:01:55 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://127.0.0.1:8000/api/v1/staff/me
2025-07-10 02:01:55 | INFO | app.core.middleware:dispatch:19 - 完成请求: GET http://127.0.0.1:8000/api/v1/staff/me - 状态码: 200 - 耗时: 0.2485秒
2025-07-10 02:02:12 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://127.0.0.1:8000/api/v1/staff?skip=0&limit=100
2025-07-10 02:02:13 | INFO | app.core.middleware:dispatch:19 - 完成请求: GET http://127.0.0.1:8000/api/v1/staff?skip=0&limit=100 - 状态码: 200 - 耗时: 0.1077秒
2025-07-10 03:32:39 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://127.0.0.1:8000/docs
2025-07-10 03:32:39 | INFO | app.core.middleware:dispatch:19 - 完成请求: GET http://127.0.0.1:8000/docs - 状态码: 200 - 耗时: 0.0142秒
2025-07-10 03:32:40 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://127.0.0.1:8000/openapi.json
2025-07-10 03:32:40 | INFO | app.core.middleware:dispatch:19 - 完成请求: GET http://127.0.0.1:8000/openapi.json - 状态码: 200 - 耗时: 0.1717秒
2025-07-10 03:38:57 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://127.0.0.1:8000/docs
2025-07-10 03:38:57 | INFO | app.core.middleware:dispatch:19 - 完成请求: GET http://127.0.0.1:8000/docs - 状态码: 200 - 耗时: 0.0243秒
2025-07-10 03:38:58 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://127.0.0.1:8000/openapi.json
2025-07-10 03:38:58 | INFO | app.core.middleware:dispatch:19 - 完成请求: GET http://127.0.0.1:8000/openapi.json - 状态码: 200 - 耗时: 0.1451秒
2025-07-10 03:39:05 | INFO | app.core.middleware:dispatch:11 - 开始请求: POST http://127.0.0.1:8000/api/v1/login/access-token
2025-07-10 03:39:05 | INFO | app.core.middleware:dispatch:19 - 完成请求: POST http://127.0.0.1:8000/api/v1/login/access-token - 状态码: 404 - 耗时: 0.0239秒
2025-07-10 03:44:01 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://127.0.0.1:8000/docs
2025-07-10 03:44:01 | INFO | app.core.middleware:dispatch:19 - 完成请求: GET http://127.0.0.1:8000/docs - 状态码: 200 - 耗时: 0.0083秒
2025-07-10 03:44:02 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://127.0.0.1:8000/openapi.json
2025-07-10 03:44:02 | INFO | app.core.middleware:dispatch:19 - 完成请求: GET http://127.0.0.1:8000/openapi.json - 状态码: 200 - 耗时: 0.1179秒
2025-07-10 03:44:19 | INFO | app.core.middleware:dispatch:11 - 开始请求: POST http://127.0.0.1:8000/api/v1/login/access-token
2025-07-10 03:44:19 | INFO | app.core.middleware:dispatch:19 - 完成请求: POST http://127.0.0.1:8000/api/v1/login/access-token - 状态码: 200 - 耗时: 0.4909秒
2025-07-10 03:44:24 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://127.0.0.1:8000/api/v1/staffs/me
2025-07-10 03:44:25 | INFO | app.core.middleware:dispatch:19 - 完成请求: GET http://127.0.0.1:8000/api/v1/staffs/me - 状态码: 200 - 耗时: 0.2801秒
2025-07-10 03:44:31 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://127.0.0.1:8000/api/v1/staffs/?skip=0&limit=100
2025-07-10 03:44:31 | INFO | app.core.middleware:dispatch:19 - 完成请求: GET http://127.0.0.1:8000/api/v1/staffs/?skip=0&limit=100 - 状态码: 200 - 耗时: 0.1761秒
2025-07-10 03:44:56 | INFO | app.core.middleware:dispatch:11 - 开始请求: POST http://127.0.0.1:8000/api/v1/staffs/
2025-07-10 03:44:57 | INFO | app.core.middleware:dispatch:19 - 完成请求: POST http://127.0.0.1:8000/api/v1/staffs/ - 状态码: 201 - 耗时: 0.8707秒
2025-07-10 03:45:04 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://127.0.0.1:8000/api/v1/staffs/?skip=0&limit=100
2025-07-10 03:45:04 | INFO | app.core.middleware:dispatch:19 - 完成请求: GET http://127.0.0.1:8000/api/v1/staffs/?skip=0&limit=100 - 状态码: 200 - 耗时: 0.1299秒
2025-07-10 03:45:23 | INFO | app.core.middleware:dispatch:11 - 开始请求: POST http://127.0.0.1:8000/api/v1/users/
2025-07-10 03:45:23 | INFO | app.core.middleware:dispatch:19 - 完成请求: POST http://127.0.0.1:8000/api/v1/users/ - 状态码: 201 - 耗时: 0.1535秒
2025-07-10 03:45:38 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://127.0.0.1:8000/api/v1/cases/?skip=0&limit=100
2025-07-10 03:45:39 | INFO | app.core.middleware:dispatch:19 - 完成请求: GET http://127.0.0.1:8000/api/v1/cases/?skip=0&limit=100 - 状态码: 200 - 耗时: 0.1539秒
2025-07-10 03:46:47 | INFO | app.core.middleware:dispatch:11 - 开始请求: POST http://127.0.0.1:8000/api/v1/cases/
2025-07-10 03:46:47 | INFO | app.core.middleware:dispatch:19 - 完成请求: POST http://127.0.0.1:8000/api/v1/cases/ - 状态码: 201 - 耗时: 0.2607秒
2025-07-10 03:47:02 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://127.0.0.1:8000/api/v1/cases/with-users?skip=0&limit=100
2025-07-10 03:47:02 | INFO | app.core.middleware:dispatch:19 - 完成请求: GET http://127.0.0.1:8000/api/v1/cases/with-users?skip=0&limit=100 - 状态码: 200 - 耗时: 0.1947秒
2025-07-10 03:47:43 | INFO | app.core.middleware:dispatch:11 - 开始请求: POST http://127.0.0.1:8000/api/v1/evidences/?disposition=inline
2025-07-10 03:47:43 | INFO | app.core.middleware:dispatch:19 - 完成请求: POST http://127.0.0.1:8000/api/v1/evidences/?disposition=inline - 状态码: 422 - 耗时: 0.1653秒
2025-07-10 03:48:05 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://127.0.0.1:8000/api/v1/evidences/?skip=0&limit=100
2025-07-10 03:48:05 | INFO | app.core.middleware:dispatch:19 - 完成请求: GET http://127.0.0.1:8000/api/v1/evidences/?skip=0&limit=100 - 状态码: 200 - 耗时: 0.1246秒
2025-07-10 03:48:26 | INFO | app.core.middleware:dispatch:11 - 开始请求: POST http://127.0.0.1:8000/api/v1/evidences/batch
2025-07-10 03:48:26 | INFO | app.evidences.routers:batch_create_evidences:124 - 接收批量创建证据请求: 案件ID=1, 文件数量=2
2025-07-10 03:48:26 | DEBUG | app.evidences.routers:batch_create_evidences:135 - 文件1: 名称=身份证正面.png, 内容类型=image/png, 大小=347913
2025-07-10 03:48:26 | DEBUG | app.evidences.routers:batch_create_evidences:135 - 文件2: 名称=银行卡.jpg, 内容类型=image/jpeg, 大小=488408
2025-07-10 03:48:26 | DEBUG | app.evidences.routers:batch_create_evidences:158 - 案件存在: ID=1, 名称=李明vs王莉
2025-07-10 03:48:26 | INFO | app.evidences.routers:batch_create_evidences:162 - 开始批量创建证据: 案件ID=1, 文件数量=2
2025-07-10 03:48:26 | INFO | app.evidences.services:batch_create:185 - 开始批量创建证据: 案件ID=1, 文件数量=2
2025-07-10 03:48:26 | DEBUG | app.evidences.services:batch_create:190 - 处理第1个文件: 身份证正面.png, 大小: 347913
2025-07-10 03:48:26 | DEBUG | app.evidences.services:upload_file:37 - 开始上传文件: 身份证正面.png
2025-07-10 03:48:26 | DEBUG | app.evidences.services:upload_file:42 - 文件扩展名: png
2025-07-10 03:48:26 | DEBUG | app.evidences.services:upload_file:55 - 存储文件夹: images
2025-07-10 03:48:26 | DEBUG | app.evidences.services:upload_file:61 - 文件大小: 347913 字节
2025-07-10 03:48:26 | DEBUG | app.evidences.services:upload_file:72 - 开始上传文件到COS: 身份证正面.png, disposition=inline
2025-07-10 03:48:26 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 身份证正面.png, 文件夹: images
2025-07-10 03:48:26 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 347913 字节
2025-07-10 03:48:26 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250710034826_身份证正面.png
2025-07-10 03:48:26 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250710034826_身份证正面.png
2025-07-10 03:48:26 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250710034826_身份证正面.png, disposition=inline
2025-07-10 03:48:29 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250710034826_身份证正面.png
2025-07-10 03:48:29 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710034826_身份证正面.png
2025-07-10 03:48:29 | DEBUG | app.evidences.services:upload_file:74 - 文件上传成功: 身份证正面.png, URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710034826_身份证正面.png
2025-07-10 03:48:29 | DEBUG | app.evidences.services:batch_create:194 - 文件上传成功: 身份证正面.png, URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710034826_身份证正面.png
2025-07-10 03:48:29 | DEBUG | app.evidences.services:batch_create:208 - 证据对象创建成功: 身份证正面.png
2025-07-10 03:48:29 | DEBUG | app.evidences.services:batch_create:190 - 处理第2个文件: 银行卡.jpg, 大小: 488408
2025-07-10 03:48:29 | DEBUG | app.evidences.services:upload_file:37 - 开始上传文件: 银行卡.jpg
2025-07-10 03:48:29 | DEBUG | app.evidences.services:upload_file:42 - 文件扩展名: jpg
2025-07-10 03:48:29 | DEBUG | app.evidences.services:upload_file:55 - 存储文件夹: images
2025-07-10 03:48:29 | DEBUG | app.evidences.services:upload_file:61 - 文件大小: 488408 字节
2025-07-10 03:48:29 | DEBUG | app.evidences.services:upload_file:72 - 开始上传文件到COS: 银行卡.jpg, disposition=inline
2025-07-10 03:48:29 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 银行卡.jpg, 文件夹: images
2025-07-10 03:48:29 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 488408 字节
2025-07-10 03:48:29 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250710034829_银行卡.jpg
2025-07-10 03:48:29 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250710034829_银行卡.jpg
2025-07-10 03:48:29 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250710034829_银行卡.jpg, disposition=inline
2025-07-10 03:48:30 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250710034829_银行卡.jpg
2025-07-10 03:48:30 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710034829_银行卡.jpg
2025-07-10 03:48:30 | DEBUG | app.evidences.services:upload_file:74 - 文件上传成功: 银行卡.jpg, URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710034829_银行卡.jpg
2025-07-10 03:48:30 | DEBUG | app.evidences.services:batch_create:194 - 文件上传成功: 银行卡.jpg, URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710034829_银行卡.jpg
2025-07-10 03:48:30 | DEBUG | app.evidences.services:batch_create:208 - 证据对象创建成功: 银行卡.jpg
2025-07-10 03:48:30 | INFO | app.evidences.services:batch_create:220 - 成功提交2个证据到数据库
2025-07-10 03:48:30 | INFO | app.evidences.routers:batch_create_evidences:201 - 批量创建证据成功: 成功数量=2
2025-07-10 03:48:30 | INFO | app.core.middleware:dispatch:19 - 完成请求: POST http://127.0.0.1:8000/api/v1/evidences/batch - 状态码: 201 - 耗时: 4.4180秒
2025-07-10 03:48:46 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://127.0.0.1:8000/api/v1/evidences/1/with-case
2025-07-10 03:48:46 | INFO | app.core.middleware:dispatch:19 - 完成请求: GET http://127.0.0.1:8000/api/v1/evidences/1/with-case - 状态码: 200 - 耗时: 0.1737秒
2025-07-10 03:48:54 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://127.0.0.1:8000/api/v1/evidences/2/with-case
2025-07-10 03:48:55 | INFO | app.core.middleware:dispatch:19 - 完成请求: GET http://127.0.0.1:8000/api/v1/evidences/2/with-case - 状态码: 200 - 耗时: 0.1651秒
2025-07-10 03:49:08 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://127.0.0.1:8000/api/v1/evidences/1
2025-07-10 03:49:08 | INFO | app.core.middleware:dispatch:19 - 完成请求: GET http://127.0.0.1:8000/api/v1/evidences/1 - 状态码: 200 - 耗时: 0.1584秒
2025-07-10 03:49:16 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://127.0.0.1:8000/api/v1/evidences/with-cases?skip=0&limit=100
2025-07-10 03:49:17 | INFO | app.core.middleware:dispatch:19 - 完成请求: GET http://127.0.0.1:8000/api/v1/evidences/with-cases?skip=0&limit=100 - 状态码: 200 - 耗时: 0.1693秒
2025-07-10 03:49:29 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://127.0.0.1:8000/api/v1/evidences/?skip=0&limit=100
2025-07-10 03:49:29 | INFO | app.core.middleware:dispatch:19 - 完成请求: GET http://127.0.0.1:8000/api/v1/evidences/?skip=0&limit=100 - 状态码: 200 - 耗时: 0.1222秒
2025-07-10 03:50:22 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://127.0.0.1:8000/docs
2025-07-10 03:50:22 | INFO | app.core.middleware:dispatch:19 - 完成请求: GET http://127.0.0.1:8000/docs - 状态码: 200 - 耗时: 0.0054秒
2025-07-10 03:50:23 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://127.0.0.1:8000/openapi.json
2025-07-10 03:50:23 | INFO | app.core.middleware:dispatch:19 - 完成请求: GET http://127.0.0.1:8000/openapi.json - 状态码: 200 - 耗时: 0.0710秒
2025-07-10 03:58:22 | INFO | app.core.middleware:dispatch:11 - 开始请求: POST http://127.0.0.1:8000/api/v1/evidences/batch
2025-07-10 03:58:22 | INFO | app.core.middleware:dispatch:19 - 完成请求: POST http://127.0.0.1:8000/api/v1/evidences/batch - 状态码: 401 - 耗时: 0.0326秒
2025-07-10 03:58:27 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://127.0.0.1:8000/docs
2025-07-10 03:58:27 | INFO | app.core.middleware:dispatch:19 - 完成请求: GET http://127.0.0.1:8000/docs - 状态码: 200 - 耗时: 0.0248秒
2025-07-10 03:58:28 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://127.0.0.1:8000/openapi.json
2025-07-10 03:58:28 | INFO | app.core.middleware:dispatch:19 - 完成请求: GET http://127.0.0.1:8000/openapi.json - 状态码: 200 - 耗时: 0.1712秒
2025-07-10 03:58:37 | INFO | app.core.middleware:dispatch:11 - 开始请求: POST http://127.0.0.1:8000/api/v1/login/access-token
2025-07-10 03:58:37 | INFO | app.core.middleware:dispatch:19 - 完成请求: POST http://127.0.0.1:8000/api/v1/login/access-token - 状态码: 200 - 耗时: 0.4630秒
2025-07-10 03:58:57 | INFO | app.core.middleware:dispatch:11 - 开始请求: POST http://127.0.0.1:8000/api/v1/evidences/batch
2025-07-10 03:58:57 | INFO | app.evidences.routers:batch_create_evidences:96 - 接收批量创建证据请求: 案件ID=1, 文件数量=1
2025-07-10 03:58:57 | DEBUG | app.evidences.routers:batch_create_evidences:107 - 文件1: 名称=营业执照.png, 内容类型=image/png, 大小=369499
2025-07-10 03:58:57 | DEBUG | app.evidences.routers:batch_create_evidences:130 - 案件存在: ID=1, 名称=李明vs王莉
2025-07-10 03:58:57 | INFO | app.evidences.routers:batch_create_evidences:134 - 开始批量创建证据: 案件ID=1, 文件数量=1
2025-07-10 03:58:57 | INFO | app.evidences.services:batch_create:185 - 开始批量创建证据: 案件ID=1, 文件数量=1
2025-07-10 03:58:57 | DEBUG | app.evidences.services:batch_create:190 - 处理第1个文件: 营业执照.png, 大小: 369499
2025-07-10 03:58:57 | DEBUG | app.evidences.services:upload_file:37 - 开始上传文件: 营业执照.png
2025-07-10 03:58:57 | DEBUG | app.evidences.services:upload_file:42 - 文件扩展名: png
2025-07-10 03:58:57 | DEBUG | app.evidences.services:upload_file:55 - 存储文件夹: images
2025-07-10 03:58:57 | DEBUG | app.evidences.services:upload_file:61 - 文件大小: 369499 字节
2025-07-10 03:58:57 | DEBUG | app.evidences.services:upload_file:72 - 开始上传文件到COS: 营业执照.png, disposition=inline
2025-07-10 03:58:57 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 营业执照.png, 文件夹: images
2025-07-10 03:58:57 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 369499 字节
2025-07-10 03:58:57 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250710035857_营业执照.png
2025-07-10 03:58:57 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250710035857_营业执照.png
2025-07-10 03:58:57 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250710035857_营业执照.png, disposition=inline
2025-07-10 03:59:00 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250710035857_营业执照.png
2025-07-10 03:59:00 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710035857_营业执照.png
2025-07-10 03:59:00 | DEBUG | app.evidences.services:upload_file:74 - 文件上传成功: 营业执照.png, URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710035857_营业执照.png
2025-07-10 03:59:00 | DEBUG | app.evidences.services:batch_create:194 - 文件上传成功: 营业执照.png, URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710035857_营业执照.png
2025-07-10 03:59:00 | DEBUG | app.evidences.services:batch_create:208 - 证据对象创建成功: 营业执照.png
2025-07-10 03:59:00 | INFO | app.evidences.services:batch_create:220 - 成功提交1个证据到数据库
2025-07-10 03:59:00 | INFO | app.evidences.routers:batch_create_evidences:173 - 批量创建证据成功: 成功数量=1
2025-07-10 03:59:00 | INFO | app.core.middleware:dispatch:19 - 完成请求: POST http://127.0.0.1:8000/api/v1/evidences/batch - 状态码: 201 - 耗时: 3.5495秒
2025-07-10 05:54:20 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://127.0.0.1:8000/docs
2025-07-10 05:54:20 | INFO | app.core.middleware:dispatch:19 - 完成请求: GET http://127.0.0.1:8000/docs - 状态码: 200 - 耗时: 0.0223秒
2025-07-10 05:54:20 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://127.0.0.1:8000/openapi.json
2025-07-10 05:54:21 | INFO | app.core.middleware:dispatch:19 - 完成请求: GET http://127.0.0.1:8000/openapi.json - 状态码: 200 - 耗时: 0.0495秒
2025-07-10 05:54:46 | INFO | app.core.middleware:dispatch:11 - 开始请求: POST http://127.0.0.1:8000/api/v1/login/access-token
2025-07-10 05:54:47 | INFO | app.core.middleware:dispatch:19 - 完成请求: POST http://127.0.0.1:8000/api/v1/login/access-token - 状态码: 200 - 耗时: 1.1604秒
2025-07-10 05:54:50 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://127.0.0.1:8000/api/v1/staffs/me
2025-07-10 05:54:51 | INFO | app.core.middleware:dispatch:19 - 完成请求: GET http://127.0.0.1:8000/api/v1/staffs/me - 状态码: 200 - 耗时: 0.4291秒
2025-07-10 05:59:07 | INFO | app.core.middleware:dispatch:11 - 开始请求: POST http://localhost:8000/api/v1/login/access-token
2025-07-10 05:59:07 | INFO | app.core.middleware:dispatch:19 - 完成请求: POST http://localhost:8000/api/v1/login/access-token - 状态码: 422 - 耗时: 0.1381秒
2025-07-10 05:59:32 | INFO | app.core.middleware:dispatch:11 - 开始请求: POST http://localhost:8000/api/v1/login/access-token
2025-07-10 05:59:32 | INFO | app.core.middleware:dispatch:19 - 完成请求: POST http://localhost:8000/api/v1/login/access-token - 状态码: 200 - 耗时: 0.4876秒
2025-07-10 05:59:44 | INFO | app.core.middleware:dispatch:11 - 开始请求: POST http://localhost:8000/api/v1/login/access-token
2025-07-10 05:59:44 | INFO | app.core.middleware:dispatch:19 - 完成请求: POST http://localhost:8000/api/v1/login/access-token - 状态码: 200 - 耗时: 0.3884秒
2025-07-10 06:00:41 | INFO | app.core.middleware:dispatch:11 - 开始请求: POST http://localhost:8000/api/v1/staffs/me
2025-07-10 06:00:41 | INFO | app.core.middleware:dispatch:19 - 完成请求: POST http://localhost:8000/api/v1/staffs/me - 状态码: 405 - 耗时: 0.0129秒
2025-07-10 06:00:46 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://localhost:8000/api/v1/staffs/me
2025-07-10 06:00:46 | INFO | app.core.middleware:dispatch:19 - 完成请求: GET http://localhost:8000/api/v1/staffs/me - 状态码: 200 - 耗时: 0.1043秒
2025-07-10 06:08:22 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://localhost:8000/api/v1/staffs/me
2025-07-10 06:08:23 | INFO | app.core.middleware:dispatch:19 - 完成请求: GET http://localhost:8000/api/v1/staffs/me - 状态码: 200 - 耗时: 0.2727秒
2025-07-10 06:09:46 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://localhost:8000/api/v1/staffs
2025-07-10 06:09:46 | INFO | app.core.middleware:dispatch:19 - 完成请求: GET http://localhost:8000/api/v1/staffs - 状态码: 307 - 耗时: 0.0129秒
2025-07-10 06:09:46 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://localhost:8000/api/v1/staffs/
2025-07-10 06:09:46 | ERROR | app.core.middleware:dispatch:23 - 请求异常: GET http://localhost:8000/api/v1/staffs/ - 错误: name 'func' is not defined
2025-07-10 06:10:31 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://localhost:8000/api/v1/staffs
2025-07-10 06:10:31 | INFO | app.core.middleware:dispatch:19 - 完成请求: GET http://localhost:8000/api/v1/staffs - 状态码: 307 - 耗时: 0.0063秒
2025-07-10 06:10:31 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://localhost:8000/api/v1/staffs/
2025-07-10 06:10:31 | INFO | app.core.middleware:dispatch:19 - 完成请求: GET http://localhost:8000/api/v1/staffs/ - 状态码: 200 - 耗时: 0.2187秒
2025-07-10 06:15:16 | INFO | app.core.middleware:dispatch:11 - 开始请求: POST http://localhost:8000/api/v1/users
2025-07-10 06:15:16 | INFO | app.core.middleware:dispatch:19 - 完成请求: POST http://localhost:8000/api/v1/users - 状态码: 307 - 耗时: 0.0186秒
2025-07-10 06:15:16 | INFO | app.core.middleware:dispatch:11 - 开始请求: POST http://localhost:8000/api/v1/users/
2025-07-10 06:15:16 | INFO | app.core.middleware:dispatch:19 - 完成请求: POST http://localhost:8000/api/v1/users/ - 状态码: 401 - 耗时: 0.0080秒
2025-07-10 06:15:38 | INFO | app.core.middleware:dispatch:11 - 开始请求: POST http://localhost:8000/api/v1/users
2025-07-10 06:15:38 | INFO | app.core.middleware:dispatch:19 - 完成请求: POST http://localhost:8000/api/v1/users - 状态码: 307 - 耗时: 0.0080秒
2025-07-10 06:15:38 | INFO | app.core.middleware:dispatch:11 - 开始请求: POST http://localhost:8000/api/v1/users/
2025-07-10 06:15:38 | INFO | app.core.middleware:dispatch:19 - 完成请求: POST http://localhost:8000/api/v1/users/ - 状态码: 201 - 耗时: 0.2539秒
2025-07-10 06:15:45 | INFO | app.core.middleware:dispatch:11 - 开始请求: POST http://localhost:8000/api/v1/users
2025-07-10 06:15:45 | INFO | app.core.middleware:dispatch:19 - 完成请求: POST http://localhost:8000/api/v1/users - 状态码: 307 - 耗时: 0.0009秒
2025-07-10 06:15:45 | INFO | app.core.middleware:dispatch:11 - 开始请求: POST http://localhost:8000/api/v1/users/
2025-07-10 06:15:45 | INFO | app.core.middleware:dispatch:19 - 完成请求: POST http://localhost:8000/api/v1/users/ - 状态码: 500 - 耗时: 0.0284秒
2025-07-10 06:16:31 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://localhost:8000/api/v1/users
2025-07-10 06:16:31 | INFO | app.core.middleware:dispatch:19 - 完成请求: GET http://localhost:8000/api/v1/users - 状态码: 307 - 耗时: 0.0160秒
2025-07-10 06:16:31 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://localhost:8000/api/v1/users/
2025-07-10 06:16:31 | ERROR | app.core.middleware:dispatch:23 - 请求异常: GET http://localhost:8000/api/v1/users/ - 错误: PaginatedSuccess() got an unexpected keyword argument 'data'
2025-07-10 06:18:05 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://localhost:8000/api/v1/users
2025-07-10 06:18:05 | INFO | app.core.middleware:dispatch:19 - 完成请求: GET http://localhost:8000/api/v1/users - 状态码: 307 - 耗时: 0.0023秒
2025-07-10 06:18:05 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://localhost:8000/api/v1/users/
2025-07-10 06:18:05 | INFO | app.core.middleware:dispatch:19 - 完成请求: GET http://localhost:8000/api/v1/users/ - 状态码: 200 - 耗时: 0.0836秒
2025-07-10 06:20:34 | INFO | app.core.middleware:dispatch:11 - 开始请求: POST http://localhost:8000/api/v1/login/access-token
2025-07-10 06:20:34 | INFO | app.core.middleware:dispatch:19 - 完成请求: POST http://localhost:8000/api/v1/login/access-token - 状态码: 401 - 耗时: 0.3976秒
2025-07-10 06:23:08 | INFO | app.core.middleware:dispatch:11 - 开始请求: POST http://localhost:8000/api/v1/cases
2025-07-10 06:23:08 | INFO | app.core.middleware:dispatch:19 - 完成请求: POST http://localhost:8000/api/v1/cases - 状态码: 307 - 耗时: 0.0073秒
2025-07-10 06:23:08 | INFO | app.core.middleware:dispatch:11 - 开始请求: POST http://localhost:8000/api/v1/cases/
2025-07-10 06:23:08 | INFO | app.core.middleware:dispatch:19 - 完成请求: POST http://localhost:8000/api/v1/cases/ - 状态码: 422 - 耗时: 0.1401秒
2025-07-10 06:23:35 | INFO | app.core.middleware:dispatch:11 - 开始请求: POST http://localhost:8000/api/v1/cases
2025-07-10 06:23:35 | INFO | app.core.middleware:dispatch:19 - 完成请求: POST http://localhost:8000/api/v1/cases - 状态码: 307 - 耗时: 0.0098秒
2025-07-10 06:23:35 | INFO | app.core.middleware:dispatch:11 - 开始请求: POST http://localhost:8000/api/v1/cases/
2025-07-10 06:23:35 | INFO | app.core.middleware:dispatch:19 - 完成请求: POST http://localhost:8000/api/v1/cases/ - 状态码: 422 - 耗时: 0.0773秒
2025-07-10 06:23:55 | INFO | app.core.middleware:dispatch:11 - 开始请求: POST http://localhost:8000/api/v1/cases
2025-07-10 06:23:55 | INFO | app.core.middleware:dispatch:19 - 完成请求: POST http://localhost:8000/api/v1/cases - 状态码: 307 - 耗时: 0.0120秒
2025-07-10 06:23:55 | INFO | app.core.middleware:dispatch:11 - 开始请求: POST http://localhost:8000/api/v1/cases/
2025-07-10 06:23:55 | INFO | app.core.middleware:dispatch:19 - 完成请求: POST http://localhost:8000/api/v1/cases/ - 状态码: 422 - 耗时: 0.0250秒
2025-07-10 06:24:30 | INFO | app.core.middleware:dispatch:11 - 开始请求: POST http://localhost:8000/api/v1/cases
2025-07-10 06:24:30 | INFO | app.core.middleware:dispatch:19 - 完成请求: POST http://localhost:8000/api/v1/cases - 状态码: 307 - 耗时: 0.0190秒
2025-07-10 06:24:30 | INFO | app.core.middleware:dispatch:11 - 开始请求: POST http://localhost:8000/api/v1/cases/
2025-07-10 06:24:30 | INFO | app.core.middleware:dispatch:19 - 完成请求: POST http://localhost:8000/api/v1/cases/ - 状态码: 422 - 耗时: 0.0739秒
2025-07-10 06:24:56 | INFO | app.core.middleware:dispatch:11 - 开始请求: POST http://localhost:8000/api/v1/cases
2025-07-10 06:24:56 | INFO | app.core.middleware:dispatch:19 - 完成请求: POST http://localhost:8000/api/v1/cases - 状态码: 307 - 耗时: 0.0136秒
2025-07-10 06:24:56 | INFO | app.core.middleware:dispatch:11 - 开始请求: POST http://localhost:8000/api/v1/cases/
2025-07-10 06:24:56 | INFO | app.core.middleware:dispatch:19 - 完成请求: POST http://localhost:8000/api/v1/cases/ - 状态码: -1 - 耗时: 0.0963秒
2025-07-10 06:25:05 | INFO | app.core.middleware:dispatch:11 - 开始请求: POST http://localhost:8000/api/v1/cases
2025-07-10 06:25:05 | INFO | app.core.middleware:dispatch:19 - 完成请求: POST http://localhost:8000/api/v1/cases - 状态码: 307 - 耗时: 0.0205秒
2025-07-10 06:25:05 | INFO | app.core.middleware:dispatch:11 - 开始请求: POST http://localhost:8000/api/v1/cases/
2025-07-10 06:25:05 | INFO | app.core.middleware:dispatch:19 - 完成请求: POST http://localhost:8000/api/v1/cases/ - 状态码: -1 - 耗时: 0.0809秒
2025-07-10 06:41:45 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://localhost:8000/api/v1/staffs/me
2025-07-10 06:41:45 | INFO | app.core.middleware:dispatch:19 - 完成请求: GET http://localhost:8000/api/v1/staffs/me - 状态码: 401 - 耗时: 0.0325秒
2025-07-10 06:41:49 | INFO | app.core.middleware:dispatch:11 - 开始请求: POST http://localhost:8000/api/v1/login/access-token
2025-07-10 06:41:50 | INFO | app.core.middleware:dispatch:19 - 完成请求: POST http://localhost:8000/api/v1/login/access-token - 状态码: 401 - 耗时: 0.3762秒
2025-07-10 06:41:53 | INFO | app.core.middleware:dispatch:11 - 开始请求: POST http://localhost:8000/api/v1/login/access-token
2025-07-10 06:41:53 | INFO | app.core.middleware:dispatch:19 - 完成请求: POST http://localhost:8000/api/v1/login/access-token - 状态码: 200 - 耗时: 0.3127秒
2025-07-10 06:41:59 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://localhost:8000/api/v1/staffs/me
2025-07-10 06:41:59 | INFO | app.core.middleware:dispatch:19 - 完成请求: GET http://localhost:8000/api/v1/staffs/me - 状态码: 401 - 耗时: 0.0029秒
2025-07-10 06:42:06 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://localhost:8000/api/v1/staffs/me
2025-07-10 06:42:06 | ERROR | app.core.middleware:dispatch:23 - 请求异常: GET http://localhost:8000/api/v1/staffs/me - 错误: Object of type Staff is not JSON serializable
2025-07-10 06:44:04 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://localhost:8000/api/v1/staffs/me
2025-07-10 06:44:04 | ERROR | app.core.middleware:dispatch:23 - 请求异常: GET http://localhost:8000/api/v1/staffs/me - 错误: Unable to serialize unknown type: <class 'app.staffs.models.Staff'>
2025-07-10 06:44:07 | INFO | app.core.middleware:dispatch:11 - 开始请求: POST http://localhost:8000/api/v1/login/access-token
2025-07-10 06:44:07 | INFO | app.core.middleware:dispatch:19 - 完成请求: POST http://localhost:8000/api/v1/login/access-token - 状态码: 200 - 耗时: 0.3350秒
2025-07-10 06:44:09 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://localhost:8000/api/v1/staffs/me
2025-07-10 06:44:09 | ERROR | app.core.middleware:dispatch:23 - 请求异常: GET http://localhost:8000/api/v1/staffs/me - 错误: Unable to serialize unknown type: <class 'app.staffs.models.Staff'>
2025-07-10 06:54:33 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://localhost:8000/api/v1/staffs/me
2025-07-10 06:54:33 | INFO | app.core.middleware:dispatch:19 - 完成请求: GET http://localhost:8000/api/v1/staffs/me - 状态码: 200 - 耗时: 0.2069秒
2025-07-10 06:57:35 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://localhost:8000/api/v1/staffs/me
2025-07-10 06:57:35 | INFO | app.core.middleware:dispatch:19 - 完成请求: GET http://localhost:8000/api/v1/staffs/me - 状态码: 200 - 耗时: 0.2533秒
2025-07-10 06:57:50 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://localhost:8000/api/v1/users
2025-07-10 06:57:50 | INFO | app.core.middleware:dispatch:19 - 完成请求: GET http://localhost:8000/api/v1/users - 状态码: 307 - 耗时: 0.0171秒
2025-07-10 06:57:50 | INFO | app.core.middleware:dispatch:11 - 开始请求: GET http://localhost:8000/api/v1/users/
2025-07-10 06:57:50 | INFO | app.core.middleware:dispatch:19 - 完成请求: GET http://localhost:8000/api/v1/users/ - 状态码: 401 - 耗时: 0.0098秒
2025-07-10 07:02:10 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/api/v1/users
2025-07-10 07:02:10 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/api/v1/users - 状态码: 307 - 耗时: 0.0024秒
2025-07-10 07:02:10 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/api/v1/users/
2025-07-10 07:02:10 | ERROR | app.core.middleware:http_exception_handler:12 - HTTPException: 无法验证凭据 - GET /api/v1/users/
2025-07-10 07:02:10 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/api/v1/users/ - 状态码: 401 - 耗时: 0.0273秒
2025-07-10 07:02:12 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/api/v1/users
2025-07-10 07:02:12 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/api/v1/users - 状态码: 307 - 耗时: 0.0014秒
2025-07-10 07:02:12 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/api/v1/users/
2025-07-10 07:02:12 | ERROR | app.core.middleware:http_exception_handler:12 - HTTPException: 无法验证凭据 - GET /api/v1/users/
2025-07-10 07:02:12 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/api/v1/users/ - 状态码: 401 - 耗时: 0.0020秒
2025-07-10 07:02:22 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/api/v1/staffs
2025-07-10 07:02:22 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/api/v1/staffs - 状态码: 307 - 耗时: 0.0298秒
2025-07-10 07:02:22 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/api/v1/staffs/
2025-07-10 07:02:22 | ERROR | app.core.middleware:http_exception_handler:12 - HTTPException: 无法验证凭据 - GET /api/v1/staffs/
2025-07-10 07:02:22 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/api/v1/staffs/ - 状态码: 401 - 耗时: 0.0081秒
2025-07-10 07:02:23 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/api/v1/staffs
2025-07-10 07:02:23 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/api/v1/staffs - 状态码: 307 - 耗时: 0.0027秒
2025-07-10 07:02:23 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/api/v1/staffs/
2025-07-10 07:02:23 | ERROR | app.core.middleware:http_exception_handler:12 - HTTPException: 无法验证凭据 - GET /api/v1/staffs/
2025-07-10 07:02:23 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/api/v1/staffs/ - 状态码: 401 - 耗时: 0.0070秒
2025-07-10 07:05:23 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/login/access-token
2025-07-10 07:05:23 | INFO | app.core.middleware:dispatch:62 - 完成请求: POST http://localhost:8000/api/v1/login/access-token - 状态码: 200 - 耗时: 0.4439秒
2025-07-10 07:05:37 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/api/v1/staffs/me
2025-07-10 07:05:37 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/api/v1/staffs/me - 状态码: 200 - 耗时: 0.4524秒
2025-07-10 07:05:45 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/api/v1/staffs
2025-07-10 07:05:45 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/api/v1/staffs - 状态码: 307 - 耗时: 0.0118秒
2025-07-10 07:05:45 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/api/v1/staffs/
2025-07-10 07:05:46 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/api/v1/staffs/ - 状态码: 200 - 耗时: 0.1988秒
2025-07-10 07:05:59 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/users
2025-07-10 07:05:59 | INFO | app.core.middleware:dispatch:62 - 完成请求: POST http://localhost:8000/api/v1/users - 状态码: 307 - 耗时: 0.0067秒
2025-07-10 07:05:59 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/users/
2025-07-10 07:05:59 | ERROR | app.core.middleware:http_exception_handler:12 - HTTPException: 无法验证凭据 - POST /api/v1/users/
2025-07-10 07:05:59 | INFO | app.core.middleware:dispatch:62 - 完成请求: POST http://localhost:8000/api/v1/users/ - 状态码: 401 - 耗时: 0.0341秒
2025-07-10 07:06:05 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/users
2025-07-10 07:06:05 | INFO | app.core.middleware:dispatch:62 - 完成请求: POST http://localhost:8000/api/v1/users - 状态码: 307 - 耗时: 0.0094秒
2025-07-10 07:06:05 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/users/
2025-07-10 07:06:05 | ERROR | app.core.middleware:http_exception_handler:12 - HTTPException: 手机号已存在 - POST /api/v1/users/
2025-07-10 07:06:05 | INFO | app.core.middleware:dispatch:62 - 完成请求: POST http://localhost:8000/api/v1/users/ - 状态码: 400 - 耗时: 0.1460秒
2025-07-10 07:06:09 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/api/v1/users
2025-07-10 07:06:09 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/api/v1/users - 状态码: 307 - 耗时: 0.0009秒
2025-07-10 07:06:09 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/api/v1/users/
2025-07-10 07:06:09 | ERROR | app.core.middleware:http_exception_handler:12 - HTTPException: 无法验证凭据 - GET /api/v1/users/
2025-07-10 07:06:09 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/api/v1/users/ - 状态码: 401 - 耗时: 0.0013秒
2025-07-10 07:06:14 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/api/v1/users
2025-07-10 07:06:14 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/api/v1/users - 状态码: 307 - 耗时: 0.0029秒
2025-07-10 07:06:14 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/api/v1/users/
2025-07-10 07:06:14 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/api/v1/users/ - 状态码: 200 - 耗时: 0.0496秒
2025-07-10 07:06:20 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/cases
2025-07-10 07:06:20 | INFO | app.core.middleware:dispatch:62 - 完成请求: POST http://localhost:8000/api/v1/cases - 状态码: 307 - 耗时: 0.0050秒
2025-07-10 07:06:20 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/cases/
2025-07-10 07:06:20 | ERROR | app.core.middleware:http_exception_handler:12 - HTTPException: 无法验证凭据 - POST /api/v1/cases/
2025-07-10 07:06:20 | INFO | app.core.middleware:dispatch:62 - 完成请求: POST http://localhost:8000/api/v1/cases/ - 状态码: 401 - 耗时: 0.0040秒
2025-07-10 07:06:25 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/cases
2025-07-10 07:06:25 | INFO | app.core.middleware:dispatch:62 - 完成请求: POST http://localhost:8000/api/v1/cases - 状态码: 307 - 耗时: 0.0022秒
2025-07-10 07:06:25 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/cases/
2025-07-10 07:06:26 | ERROR | app.core.middleware:http_exception_handler:12 - HTTPException: 用户不存在 - POST /api/v1/cases/
2025-07-10 07:06:26 | INFO | app.core.middleware:dispatch:62 - 完成请求: POST http://localhost:8000/api/v1/cases/ - 状态码: 404 - 耗时: 0.0564秒
2025-07-10 07:06:37 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/cases
2025-07-10 07:06:37 | INFO | app.core.middleware:dispatch:62 - 完成请求: POST http://localhost:8000/api/v1/cases - 状态码: 307 - 耗时: 0.0017秒
2025-07-10 07:06:37 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/cases/
2025-07-10 07:06:37 | INFO | app.core.middleware:dispatch:62 - 完成请求: POST http://localhost:8000/api/v1/cases/ - 状态码: 201 - 耗时: 0.1463秒
2025-07-10 07:07:41 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/evidences/batch
2025-07-10 07:07:42 | ERROR | app.core.middleware:validation_exception_handler:26 - Validation error: [{'type': 'missing', 'loc': ('body', 'case_id'), 'msg': 'Field required', 'input': None}] for request body: None
2025-07-10 07:07:42 | INFO | app.core.middleware:dispatch:62 - 完成请求: POST http://localhost:8000/api/v1/evidences/batch - 状态码: 422 - 耗时: 0.1023秒
2025-07-10 07:08:05 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/evidences/batch
2025-07-10 07:08:05 | INFO | app.evidences.routers:batch_create_evidences:106 - 接收批量创建证据请求: 案件ID=1, 文件数量=2
2025-07-10 07:08:05 | DEBUG | app.evidences.routers:batch_create_evidences:117 - 文件1: 名称=发票.png, 内容类型=image/png, 大小=181542
2025-07-10 07:08:05 | DEBUG | app.evidences.routers:batch_create_evidences:117 - 文件2: 名称=银行卡.jpg, 内容类型=image/jpeg, 大小=488408
2025-07-10 07:08:05 | DEBUG | app.evidences.routers:batch_create_evidences:143 - 案件存在: ID=1, 名称=李磊vs小米
2025-07-10 07:08:05 | INFO | app.evidences.routers:batch_create_evidences:147 - 开始批量创建证据: 案件ID=1, 文件数量=2
2025-07-10 07:08:05 | INFO | app.evidences.services:batch_create:223 - 开始批量创建证据: 案件ID=1, 文件数量=2
2025-07-10 07:08:05 | DEBUG | app.evidences.services:batch_create:228 - 处理第1个文件: 发票.png, 大小: 181542
2025-07-10 07:08:05 | DEBUG | app.evidences.services:upload_file:37 - 开始上传文件: 发票.png
2025-07-10 07:08:05 | DEBUG | app.evidences.services:upload_file:42 - 文件扩展名: png
2025-07-10 07:08:05 | DEBUG | app.evidences.services:upload_file:55 - 存储文件夹: images
2025-07-10 07:08:05 | DEBUG | app.evidences.services:upload_file:61 - 文件大小: 181542 字节
2025-07-10 07:08:05 | DEBUG | app.evidences.services:upload_file:72 - 开始上传文件到COS: 发票.png, disposition=inline
2025-07-10 07:08:05 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 发票.png, 文件夹: images
2025-07-10 07:08:05 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 181542 字节
2025-07-10 07:08:05 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250710070805_发票.png
2025-07-10 07:08:05 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250710070805_发票.png
2025-07-10 07:08:05 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250710070805_发票.png, disposition=inline
2025-07-10 07:08:08 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250710070805_发票.png
2025-07-10 07:08:08 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710070805_发票.png
2025-07-10 07:08:08 | DEBUG | app.evidences.services:upload_file:74 - 文件上传成功: 发票.png, URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710070805_发票.png
2025-07-10 07:08:08 | DEBUG | app.evidences.services:batch_create:232 - 文件上传成功: 发票.png, URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710070805_发票.png
2025-07-10 07:08:08 | DEBUG | app.evidences.services:batch_create:246 - 证据对象创建成功: 发票.png
2025-07-10 07:08:08 | DEBUG | app.evidences.services:batch_create:228 - 处理第2个文件: 银行卡.jpg, 大小: 488408
2025-07-10 07:08:08 | DEBUG | app.evidences.services:upload_file:37 - 开始上传文件: 银行卡.jpg
2025-07-10 07:08:08 | DEBUG | app.evidences.services:upload_file:42 - 文件扩展名: jpg
2025-07-10 07:08:08 | DEBUG | app.evidences.services:upload_file:55 - 存储文件夹: images
2025-07-10 07:08:08 | DEBUG | app.evidences.services:upload_file:61 - 文件大小: 488408 字节
2025-07-10 07:08:08 | DEBUG | app.evidences.services:upload_file:72 - 开始上传文件到COS: 银行卡.jpg, disposition=inline
2025-07-10 07:08:08 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 银行卡.jpg, 文件夹: images
2025-07-10 07:08:08 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 488408 字节
2025-07-10 07:08:08 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250710070808_银行卡.jpg
2025-07-10 07:08:08 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250710070808_银行卡.jpg
2025-07-10 07:08:08 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250710070808_银行卡.jpg, disposition=inline
2025-07-10 07:08:08 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250710070808_银行卡.jpg
2025-07-10 07:08:08 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710070808_银行卡.jpg
2025-07-10 07:08:08 | DEBUG | app.evidences.services:upload_file:74 - 文件上传成功: 银行卡.jpg, URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710070808_银行卡.jpg
2025-07-10 07:08:08 | DEBUG | app.evidences.services:batch_create:232 - 文件上传成功: 银行卡.jpg, URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710070808_银行卡.jpg
2025-07-10 07:08:08 | DEBUG | app.evidences.services:batch_create:246 - 证据对象创建成功: 银行卡.jpg
2025-07-10 07:08:08 | INFO | app.evidences.services:batch_create:258 - 成功提交2个证据到数据库
2025-07-10 07:08:08 | INFO | app.evidences.routers:batch_create_evidences:186 - 批量创建证据成功: 成功数量=2
2025-07-10 07:08:08 | INFO | app.core.middleware:dispatch:62 - 完成请求: POST http://localhost:8000/api/v1/evidences/batch - 状态码: 201 - 耗时: 3.7523秒
2025-07-10 07:08:45 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/api/v1/evidences
2025-07-10 07:08:45 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/api/v1/evidences - 状态码: 307 - 耗时: 0.0094秒
2025-07-10 07:08:45 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/api/v1/evidences/
2025-07-10 07:08:45 | ERROR | app.core.middleware:dispatch:66 - 请求异常: GET http://localhost:8000/api/v1/evidences/ - 错误: name 'func' is not defined
2025-07-10 07:08:45 | ERROR | app.core.middleware:global_exception_handler:39 - Unhandled error: name 'func' is not defined
  + Exception Group Traceback (most recent call last):
  |
  |   File "/app/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 177, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                │     │                      └ <anyio._backends._asyncio.TaskGroup object at 0xffff80a9ad50>
  |                │     └ <function create_task_group at 0xffff84164f40>
  |                └ <module 'anyio' from '/app/.venv/lib/python3.12/site-packages/anyio/__init__.py'>
  |   File "/app/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  |
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |           │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff7da71c60>
    |           │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff80a...
    |           │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
    |           │    └ <app.core.middleware.LoggingMiddleware object at 0xffff80a6db80>
    |           └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff80a6dc40>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 176, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |          │            │            └ <function collapse_excgroups at 0xffff82d80f40>
    |          │            └ MemoryObjectSendStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_receive...
    |          └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
    |   File "/usr/local/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |     │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [NameError("name 'func' is not defined")])
    |     │    │   └ <method 'throw' of 'generator' objects>
    |     │    └ <generator object collapse_excgroups at 0xffff8098b440>
    |     └ <contextlib._GeneratorContextManager object at 0xffff80a981a0>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 178, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                      │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff7da70400>
    |                      │    │             └ <starlette.middleware.base._CachedRequest object at 0xffff80a988c0>
    |                      │    └ <bound method LoggingMiddleware.dispatch of <app.core.middleware.LoggingMiddleware object at 0xffff80a6db80>>
    |                      └ <app.core.middleware.LoggingMiddleware object at 0xffff80a6db80>
    |
    |   File "/app/app/core/middleware.py", line 57, in dispatch
    |     response = await call_next(request)
    |                      │         └ <starlette.middleware.base._CachedRequest object at 0xffff80a988c0>
    |                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff7da70400>
    |
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 156, in call_next
    |     raise app_exc
    |           └ NameError("name 'func' is not defined")
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 141, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |           │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff7da72b60>
    |           │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7da705e0>
    |           │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
    |           │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff80a6db20>
    |           └ <app.core.middleware.LoggingMiddleware object at 0xffff80a6db80>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |           │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff7da72b60>
    |           │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7da705e0>
    |           │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
    |           │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff80b3b290>
    |           └ <starlette.middleware.cors.CORSMiddleware object at 0xffff80a6db20>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |           │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff7da72b60>
    |           │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7da705e0>
    |           │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
    |           │                            │    │    └ <starlette.requests.Request object at 0xffff80a99bb0>
    |           │                            │    └ <fastapi.routing.APIRouter object at 0xffff82cccb00>
    |           │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff80b3b290>
    |           └ <function wrap_app_handling_exceptions at 0xffff82dfb100>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |           │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff7da71620>
    |           │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7da705e0>
    |           │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
    |           └ <fastapi.routing.APIRouter object at 0xffff82cccb00>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |           │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff7da71620>
    |           │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7da705e0>
    |           │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
    |           │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0xffff82cccb00>>
    |           └ <fastapi.routing.APIRouter object at 0xffff82cccb00>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |           │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff7da71620>
    |           │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7da705e0>
    |           │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
    |           │     └ <function Route.handle at 0xffff82cd45e0>
    |           └ APIRoute(path='/api/v1/evidences/', name='read_evidences', methods=['GET'])
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |           │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff7da71620>
    |           │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7da705e0>
    |           │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
    |           │    └ <function request_response.<locals>.app at 0xffff80994540>
    |           └ APIRoute(path='/api/v1/evidences/', name='read_evidences', methods=['GET'])
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |           │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff7da71620>
    |           │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7da705e0>
    |           │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
    |           │                            │    └ <starlette.requests.Request object at 0xffff80a98c80>
    |           │                            └ <function request_response.<locals>.app.<locals>.app at 0xffff7da72d40>
    |           └ <function wrap_app_handling_exceptions at 0xffff82dfb100>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |           │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff7da714e0>
    |           │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7da705e0>
    |           │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
    |           └ <function request_response.<locals>.app.<locals>.app at 0xffff7da72d40>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                      │ └ <starlette.requests.Request object at 0xffff80a98c80>
    |                      └ <function get_request_handler.<locals>.app at 0xffff809944a0>
    |   File "/app/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                          └ <function run_endpoint_function at 0xffff82dfaf20>
    |   File "/app/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |                  │         │      └ {'db': <sqlalchemy.ext.asyncio.session.AsyncSession object at 0xffff80a9a900>, 'current_staff': <app.staffs.models.Staff obje...
    |                  │         └ <function read_evidences at 0xffff80f62480>
    |                  └ Dependant(path_params=[], query_params=[ModelField(field_info=Query(0), name='skip', mode='validation'), ModelField(field_inf...
    |
    |   File "/app/app/evidences/routers.py", line 34, in read_evidences
    |     evidences, total = await evidence_service.get_multi_with_count(
    |                              │                └ <function get_multi_with_count at 0xffff80871260>
    |                              └ <module 'app.evidences.services' from '/app/app/evidences/services.py'>
    |
    |   File "/app/app/evidences/services.py", line 164, in get_multi_with_count
    |     count_query = select(func.count()).select_from(query.subquery())
    |                   │                                │     └ <function SelectBase.subquery at 0xffff81621d00>
    |                   │                                └ <sqlalchemy.sql.selectable.Select object at 0xffff80a97e60>
    |                   └ <function select at 0xffff8191f920>
    |
    | NameError: name 'func' is not defined
    +------------------------------------


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/app/.venv/bin/uvicorn", line 10, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/app/.venv/lib/python3.12/site-packages/click/core.py", line 1442, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffff8449d620>
           └ <Command main>
  File "/app/.venv/lib/python3.12/site-packages/click/core.py", line 1363, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffff852d52e0>
         │    └ <function Command.invoke at 0xffff8449d300>
         └ <Command main>
  File "/app/.venv/lib/python3.12/site-packages/click/core.py", line 1226, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffff852d52e0>
           │   │      │    └ <function main at 0xffff841c80e0>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffff8449c540>
           └ <click.core.Context object at 0xffff852d52e0>
  File "/app/.venv/lib/python3.12/site-packages/click/core.py", line 794, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffff841c80e0>
  File "/app/.venv/lib/python3.12/site-packages/uvicorn/main.py", line 413, in main
    run(
    └ <function run at 0xffff8449bb00>
  File "/app/.venv/lib/python3.12/site-packages/uvicorn/main.py", line 580, in run
    server.run()
    │      └ <function Server.run at 0xffff842a8180>
    └ <uvicorn.server.Server object at 0xffff850f0740>
  File "/app/.venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffff842a8220>
           │       │   └ <uvicorn.server.Server object at 0xffff850f0740>
           │       └ <function run at 0xffff8547c680>
           └ <module 'asyncio' from '/usr/local/lib/python3.12/asyncio/__init__.py'>
  File "/usr/local/lib/python3.12/asyncio/runners.py", line 195, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffff841d67a0>
           │      └ <function Runner.run at 0xffff847702c0>
           └ <asyncio.runners.Runner object at 0xffff851b9b50>
  File "/usr/local/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /app/.venv/lib/python3.12/site-packages/uvicorn/server.py:71> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffff841a8450>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffff851b9b50>
  File "/app/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff844bb800>
  File "/app/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff80a98f...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff80a...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffff841f0380>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff844bb800>
  File "/app/.venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff80a98f...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff80a...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
  File "/app/.venv/lib/python3.12/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff80a98f...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff80a...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff80a6dc40>
          └ <fastapi.applications.FastAPI object at 0xffff841f0380>
> File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff7da71c60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff80a...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
          │    └ <app.core.middleware.LoggingMiddleware object at 0xffff80a6db80>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff80a6dc40>
  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 176, in __call__
    with recv_stream, send_stream, collapse_excgroups():
         │            │            └ <function collapse_excgroups at 0xffff82d80f40>
         │            └ MemoryObjectSendStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_receive...
         └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [NameError("name 'func' is not defined")])
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0xffff8098b440>
    └ <contextlib._GeneratorContextManager object at 0xffff80a981a0>
  File "/app/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 178, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff7da70400>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0xffff80a988c0>
                     │    └ <bound method LoggingMiddleware.dispatch of <app.core.middleware.LoggingMiddleware object at 0xffff80a6db80>>
                     └ <app.core.middleware.LoggingMiddleware object at 0xffff80a6db80>

  File "/app/app/core/middleware.py", line 57, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0xffff80a988c0>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff7da70400>

  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 156, in call_next
    raise app_exc
          └ NameError("name 'func' is not defined")
  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff7da72b60>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7da705e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff80a6db20>
          └ <app.core.middleware.LoggingMiddleware object at 0xffff80a6db80>
  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff7da72b60>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7da705e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff80b3b290>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffff80a6db20>
  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff7da72b60>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7da705e0>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
          │                            │    │    └ <starlette.requests.Request object at 0xffff80a99bb0>
          │                            │    └ <fastapi.routing.APIRouter object at 0xffff82cccb00>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff80b3b290>
          └ <function wrap_app_handling_exceptions at 0xffff82dfb100>
  File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff7da71620>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7da705e0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
          └ <fastapi.routing.APIRouter object at 0xffff82cccb00>
  File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff7da71620>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7da705e0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0xffff82cccb00>>
          └ <fastapi.routing.APIRouter object at 0xffff82cccb00>
  File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff7da71620>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7da705e0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
          │     └ <function Route.handle at 0xffff82cd45e0>
          └ APIRoute(path='/api/v1/evidences/', name='read_evidences', methods=['GET'])
  File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff7da71620>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7da705e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffff80994540>
          └ APIRoute(path='/api/v1/evidences/', name='read_evidences', methods=['GET'])
  File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff7da71620>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7da705e0>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
          │                            │    └ <starlette.requests.Request object at 0xffff80a98c80>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0xffff7da72d40>
          └ <function wrap_app_handling_exceptions at 0xffff82dfb100>
  File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff7da714e0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7da705e0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
          └ <function request_response.<locals>.app.<locals>.app at 0xffff7da72d40>
  File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0xffff80a98c80>
                     └ <function get_request_handler.<locals>.app at 0xffff809944a0>
  File "/app/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xffff82dfaf20>
  File "/app/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.ext.asyncio.session.AsyncSession object at 0xffff80a9a900>, 'current_staff': <app.staffs.models.Staff obje...
                 │         └ <function read_evidences at 0xffff80f62480>
                 └ Dependant(path_params=[], query_params=[ModelField(field_info=Query(0), name='skip', mode='validation'), ModelField(field_inf...

  File "/app/app/evidences/routers.py", line 34, in read_evidences
    evidences, total = await evidence_service.get_multi_with_count(
                             │                └ <function get_multi_with_count at 0xffff80871260>
                             └ <module 'app.evidences.services' from '/app/app/evidences/services.py'>

  File "/app/app/evidences/services.py", line 164, in get_multi_with_count
    count_query = select(func.count()).select_from(query.subquery())
                  │                                │     └ <function SelectBase.subquery at 0xffff81621d00>
                  │                                └ <sqlalchemy.sql.selectable.Select object at 0xffff80a97e60>
                  └ <function select at 0xffff8191f920>

NameError: name 'func' is not defined
2025-07-10 07:09:57 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/api/v1/evidences
2025-07-10 07:09:57 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/api/v1/evidences - 状态码: 307 - 耗时: 0.0146秒
2025-07-10 07:09:57 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/api/v1/evidences/
2025-07-10 07:09:58 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/api/v1/evidences/ - 状态码: 200 - 耗时: 0.2096秒
2025-07-10 08:25:00 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/agentic/classification
2025-07-10 08:25:00 | ERROR | app.core.middleware:http_exception_handler:12 - HTTPException: 无法验证凭据 - POST /api/v1/agentic/classification
2025-07-10 08:25:00 | INFO | app.core.middleware:dispatch:62 - 完成请求: POST http://localhost:8000/api/v1/agentic/classification - 状态码: 401 - 耗时: 0.1228秒
2025-07-10 08:25:10 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/login/access-token
2025-07-10 08:25:10 | INFO | app.core.middleware:dispatch:62 - 完成请求: POST http://localhost:8000/api/v1/login/access-token - 状态码: 200 - 耗时: 0.4289秒
2025-07-10 08:27:31 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/login/access-token
2025-07-10 08:27:31 | ERROR | app.core.middleware:dispatch:66 - 请求异常: POST http://localhost:8000/api/v1/login/access-token - 错误: 2 validation errors:
  {'type': 'missing', 'loc': ('response', 'access_token'), 'msg': 'Field required', 'input': SingleResponse(code=200, message='success', timestamp='2025-07-10T16:27:31.922235+08:00', data={'access_token': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3NTIxMzc4NTEsInN1YiI6IjEifQ.aNgO3XDkOkovr6unm2JzkKuVlpk6ppLGLl2MHvyS5FY', 'token_type': 'bearer'})}
  {'type': 'missing', 'loc': ('response', 'token_type'), 'msg': 'Field required', 'input': SingleResponse(code=200, message='success', timestamp='2025-07-10T16:27:31.922235+08:00', data={'access_token': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3NTIxMzc4NTEsInN1YiI6IjEifQ.aNgO3XDkOkovr6unm2JzkKuVlpk6ppLGLl2MHvyS5FY', 'token_type': 'bearer'})}

2025-07-10 08:27:31 | ERROR | app.core.middleware:global_exception_handler:39 - Unhandled error: 2 validation errors:
  {'type': 'missing', 'loc': ('response', 'access_token'), 'msg': 'Field required', 'input': SingleResponse(code=200, message='success', timestamp='2025-07-10T16:27:31.922235+08:00', data={'access_token': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3NTIxMzc4NTEsInN1YiI6IjEifQ.aNgO3XDkOkovr6unm2JzkKuVlpk6ppLGLl2MHvyS5FY', 'token_type': 'bearer'})}
  {'type': 'missing', 'loc': ('response', 'token_type'), 'msg': 'Field required', 'input': SingleResponse(code=200, message='success', timestamp='2025-07-10T16:27:31.922235+08:00', data={'access_token': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3NTIxMzc4NTEsInN1YiI6IjEifQ.aNgO3XDkOkovr6unm2JzkKuVlpk6ppLGLl2MHvyS5FY', 'token_type': 'bearer'})}

  + Exception Group Traceback (most recent call last):
  |
  |   File "/app/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 177, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                │     │                      └ <anyio._backends._asyncio.TaskGroup object at 0xffff92a98fb0>
  |                │     └ <function create_task_group at 0xffffb7a44f40>
  |                └ <module 'anyio' from '/app/.venv/lib/python3.12/site-packages/anyio/__init__.py'>
  |   File "/app/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  |
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |           │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff92c2bec0>
    |           │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff92c...
    |           │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
    |           │    └ <app.core.middleware.LoggingMiddleware object at 0xffff92dfeae0>
    |           └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff92c7ed50>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 176, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |          │            │            └ <function collapse_excgroups at 0xffffb6660f40>
    |          │            └ MemoryObjectSendStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_receive...
    |          └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
    |   File "/usr/local/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |     │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ResponseValidationError()])
    |     │    │   └ <method 'throw' of 'generator' objects>
    |     │    └ <generator object collapse_excgroups at 0xffff92c33370>
    |     └ <contextlib._GeneratorContextManager object at 0xffff92dfac00>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 178, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                      │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff92c2bf60>
    |                      │    │             └ <starlette.middleware.base._CachedRequest object at 0xffff92c7ffb0>
    |                      │    └ <bound method LoggingMiddleware.dispatch of <app.core.middleware.LoggingMiddleware object at 0xffff92dfeae0>>
    |                      └ <app.core.middleware.LoggingMiddleware object at 0xffff92dfeae0>
    |
    |   File "/app/app/core/middleware.py", line 57, in dispatch
    |     response = await call_next(request)
    |                      │         └ <starlette.middleware.base._CachedRequest object at 0xffff92c7ffb0>
    |                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff92c2bf60>
    |
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 156, in call_next
    |     raise app_exc
    |           └ ResponseValidationError()
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 141, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |           │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff92a9d620>
    |           │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff92ab00e0>
    |           │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
    |           │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff92c7ec90>
    |           └ <app.core.middleware.LoggingMiddleware object at 0xffff92dfeae0>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |           │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff92a9d620>
    |           │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff92ab00e0>
    |           │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
    |           │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff92c7ecc0>
    |           └ <starlette.middleware.cors.CORSMiddleware object at 0xffff92c7ec90>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |           │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff92a9d620>
    |           │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff92ab00e0>
    |           │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
    |           │                            │    │    └ <starlette.requests.Request object at 0xffff92a992b0>
    |           │                            │    └ <fastapi.routing.APIRouter object at 0xffffb65ace60>
    |           │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff92c7ecc0>
    |           └ <function wrap_app_handling_exceptions at 0xffffb66db100>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |           │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff92ab7380>
    |           │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff92ab00e0>
    |           │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
    |           └ <fastapi.routing.APIRouter object at 0xffffb65ace60>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |           │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff92ab7380>
    |           │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff92ab00e0>
    |           │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
    |           │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0xffffb65ace60>>
    |           └ <fastapi.routing.APIRouter object at 0xffffb65ace60>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |           │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff92ab7380>
    |           │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff92ab00e0>
    |           │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
    |           │     └ <function Route.handle at 0xffffb65b05e0>
    |           └ APIRoute(path='/api/v1/login/access-token', name='login_access_token', methods=['POST'])
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |           │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff92ab7380>
    |           │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff92ab00e0>
    |           │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
    |           │    └ <function request_response.<locals>.app at 0xffff92c28540>
    |           └ APIRoute(path='/api/v1/login/access-token', name='login_access_token', methods=['POST'])
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |           │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff92ab7380>
    |           │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff92ab00e0>
    |           │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
    |           │                            │    └ <starlette.requests.Request object at 0xffff92a991c0>
    |           │                            └ <function request_response.<locals>.app.<locals>.app at 0xffff92ab72e0>
    |           └ <function wrap_app_handling_exceptions at 0xffffb66db100>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |           │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff92ab71a0>
    |           │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff92ab00e0>
    |           │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
    |           └ <function request_response.<locals>.app.<locals>.app at 0xffff92ab72e0>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                      │ └ <starlette.requests.Request object at 0xffff92a991c0>
    |                      └ <function get_request_handler.<locals>.app at 0xffff92c28680>
    |   File "/app/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 327, in app
    |     content = await serialize_response(
    |                     └ <function serialize_response at 0xffffb6bbcfe0>
    |   File "/app/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 176, in serialize_response
    |     raise ResponseValidationError(
    |           └ <class 'fastapi.exceptions.ResponseValidationError'>
    |
    | fastapi.exceptions.ResponseValidationError: 2 validation errors:
    |   {'type': 'missing', 'loc': ('response', 'access_token'), 'msg': 'Field required', 'input': SingleResponse(code=200, message='success', timestamp='2025-07-10T16:27:31.922235+08:00', data={'access_token': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3NTIxMzc4NTEsInN1YiI6IjEifQ.aNgO3XDkOkovr6unm2JzkKuVlpk6ppLGLl2MHvyS5FY', 'token_type': 'bearer'})}
    |   {'type': 'missing', 'loc': ('response', 'token_type'), 'msg': 'Field required', 'input': SingleResponse(code=200, message='success', timestamp='2025-07-10T16:27:31.922235+08:00', data={'access_token': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3NTIxMzc4NTEsInN1YiI6IjEifQ.aNgO3XDkOkovr6unm2JzkKuVlpk6ppLGLl2MHvyS5FY', 'token_type': 'bearer'})}
    |
    +------------------------------------


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/app/.venv/bin/uvicorn", line 10, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/app/.venv/lib/python3.12/site-packages/click/core.py", line 1442, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffb7d7d620>
           └ <Command main>
  File "/app/.venv/lib/python3.12/site-packages/click/core.py", line 1363, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffb8c91160>
         │    └ <function Command.invoke at 0xffffb7d7d300>
         └ <Command main>
  File "/app/.venv/lib/python3.12/site-packages/click/core.py", line 1226, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffb8c91160>
           │   │      │    └ <function main at 0xffffb7aa80e0>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffb7d7c540>
           └ <click.core.Context object at 0xffffb8c91160>
  File "/app/.venv/lib/python3.12/site-packages/click/core.py", line 794, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffb7aa80e0>
  File "/app/.venv/lib/python3.12/site-packages/uvicorn/main.py", line 413, in main
    run(
    └ <function run at 0xffffb7d7bb00>
  File "/app/.venv/lib/python3.12/site-packages/uvicorn/main.py", line 580, in run
    server.run()
    │      └ <function Server.run at 0xffffb7b88180>
    └ <uvicorn.server.Server object at 0xffffb80135f0>
  File "/app/.venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffb7b88220>
           │       │   └ <uvicorn.server.Server object at 0xffffb80135f0>
           │       └ <function run at 0xffffb8d5c680>
           └ <module 'asyncio' from '/usr/local/lib/python3.12/asyncio/__init__.py'>
  File "/usr/local/lib/python3.12/asyncio/runners.py", line 195, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffb7ab67a0>
           │      └ <function Runner.run at 0xffffb80502c0>
           └ <asyncio.runners.Runner object at 0xffffb8023a40>
  File "/usr/local/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /app/.venv/lib/python3.12/site-packages/uvicorn/server.py:71> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffb7a88450>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffb8023a40>
  File "/app/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff93ec3d70>
  File "/app/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff92c7fd...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff92c...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffffb6a284d0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff93ec3d70>
  File "/app/.venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff92c7fd...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff92c...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
  File "/app/.venv/lib/python3.12/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff92c7fd...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff92c...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff92c7ed50>
          └ <fastapi.applications.FastAPI object at 0xffffb6a284d0>
> File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff92c2bec0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff92c...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
          │    └ <app.core.middleware.LoggingMiddleware object at 0xffff92dfeae0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff92c7ed50>
  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 176, in __call__
    with recv_stream, send_stream, collapse_excgroups():
         │            │            └ <function collapse_excgroups at 0xffffb6660f40>
         │            └ MemoryObjectSendStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_receive...
         └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ResponseValidationError()])
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0xffff92c33370>
    └ <contextlib._GeneratorContextManager object at 0xffff92dfac00>
  File "/app/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 178, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff92c2bf60>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0xffff92c7ffb0>
                     │    └ <bound method LoggingMiddleware.dispatch of <app.core.middleware.LoggingMiddleware object at 0xffff92dfeae0>>
                     └ <app.core.middleware.LoggingMiddleware object at 0xffff92dfeae0>

  File "/app/app/core/middleware.py", line 57, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0xffff92c7ffb0>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff92c2bf60>

  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 156, in call_next
    raise app_exc
          └ ResponseValidationError()
  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff92a9d620>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff92ab00e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff92c7ec90>
          └ <app.core.middleware.LoggingMiddleware object at 0xffff92dfeae0>
  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff92a9d620>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff92ab00e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff92c7ecc0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffff92c7ec90>
  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff92a9d620>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff92ab00e0>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
          │                            │    │    └ <starlette.requests.Request object at 0xffff92a992b0>
          │                            │    └ <fastapi.routing.APIRouter object at 0xffffb65ace60>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff92c7ecc0>
          └ <function wrap_app_handling_exceptions at 0xffffb66db100>
  File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff92ab7380>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff92ab00e0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
          └ <fastapi.routing.APIRouter object at 0xffffb65ace60>
  File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff92ab7380>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff92ab00e0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0xffffb65ace60>>
          └ <fastapi.routing.APIRouter object at 0xffffb65ace60>
  File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff92ab7380>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff92ab00e0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
          │     └ <function Route.handle at 0xffffb65b05e0>
          └ APIRoute(path='/api/v1/login/access-token', name='login_access_token', methods=['POST'])
  File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff92ab7380>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff92ab00e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffff92c28540>
          └ APIRoute(path='/api/v1/login/access-token', name='login_access_token', methods=['POST'])
  File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff92ab7380>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff92ab00e0>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
          │                            │    └ <starlette.requests.Request object at 0xffff92a991c0>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0xffff92ab72e0>
          └ <function wrap_app_handling_exceptions at 0xffffb66db100>
  File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff92ab71a0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff92ab00e0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
          └ <function request_response.<locals>.app.<locals>.app at 0xffff92ab72e0>
  File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0xffff92a991c0>
                     └ <function get_request_handler.<locals>.app at 0xffff92c28680>
  File "/app/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 327, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffffb6bbcfe0>
  File "/app/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 176, in serialize_response
    raise ResponseValidationError(
          └ <class 'fastapi.exceptions.ResponseValidationError'>

fastapi.exceptions.ResponseValidationError: 2 validation errors:
  {'type': 'missing', 'loc': ('response', 'access_token'), 'msg': 'Field required', 'input': SingleResponse(code=200, message='success', timestamp='2025-07-10T16:27:31.922235+08:00', data={'access_token': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3NTIxMzc4NTEsInN1YiI6IjEifQ.aNgO3XDkOkovr6unm2JzkKuVlpk6ppLGLl2MHvyS5FY', 'token_type': 'bearer'})}
  {'type': 'missing', 'loc': ('response', 'token_type'), 'msg': 'Field required', 'input': SingleResponse(code=200, message='success', timestamp='2025-07-10T16:27:31.922235+08:00', data={'access_token': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3NTIxMzc4NTEsInN1YiI6IjEifQ.aNgO3XDkOkovr6unm2JzkKuVlpk6ppLGLl2MHvyS5FY', 'token_type': 'bearer'})}

2025-07-10 08:29:37 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/login/access-token
2025-07-10 08:29:38 | INFO | app.core.middleware:dispatch:62 - 完成请求: POST http://localhost:8000/api/v1/login/access-token - 状态码: 200 - 耗时: 0.5028秒
2025-07-10 08:29:50 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/api/v1/staffs/me
2025-07-10 08:29:50 | ERROR | app.core.middleware:http_exception_handler:12 - HTTPException: Not authenticated - GET /api/v1/staffs/me
2025-07-10 08:29:50 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/api/v1/staffs/me - 状态码: 401 - 耗时: 0.0237秒
2025-07-10 08:29:51 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/api/v1/staffs/me
2025-07-10 08:29:51 | ERROR | app.core.middleware:http_exception_handler:12 - HTTPException: Not authenticated - GET /api/v1/staffs/me
2025-07-10 08:29:51 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/api/v1/staffs/me - 状态码: 401 - 耗时: 0.0167秒
2025-07-10 08:29:56 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/login/access-token
2025-07-10 08:29:56 | INFO | app.core.middleware:dispatch:62 - 完成请求: POST http://localhost:8000/api/v1/login/access-token - 状态码: 200 - 耗时: 0.3354秒
2025-07-10 08:30:00 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/api/v1/staffs/me
2025-07-10 08:30:00 | ERROR | app.core.middleware:http_exception_handler:12 - HTTPException: Not authenticated - GET /api/v1/staffs/me
2025-07-10 08:30:00 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/api/v1/staffs/me - 状态码: 401 - 耗时: 0.0288秒
2025-07-10 08:31:23 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/login/access-token
2025-07-10 08:31:23 | INFO | app.core.middleware:dispatch:62 - 完成请求: POST http://localhost:8000/api/v1/login/access-token - 状态码: 200 - 耗时: 0.4443秒
2025-07-10 08:31:47 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/api/v1/staffs/me
2025-07-10 08:31:47 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/api/v1/staffs/me - 状态码: 200 - 耗时: 0.2149秒
2025-07-10 08:32:10 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/api/v1/staffs
2025-07-10 08:32:10 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/api/v1/staffs - 状态码: 307 - 耗时: 0.0125秒
2025-07-10 08:32:10 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/api/v1/staffs/
2025-07-10 08:32:10 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/api/v1/staffs/ - 状态码: 200 - 耗时: 0.2898秒
2025-07-10 08:32:25 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/agentic/classification
2025-07-10 08:32:25 | ERROR | app.core.middleware:validation_exception_handler:26 - Validation error: [{'type': 'missing', 'loc': ('body', 'files'), 'msg': 'Field required', 'input': None}] for request body: None
2025-07-10 08:32:25 | INFO | app.core.middleware:dispatch:62 - 完成请求: POST http://localhost:8000/api/v1/agentic/classification - 状态码: 422 - 耗时: 0.2745秒
2025-07-10 08:32:50 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/agentic/classification
2025-07-10 08:32:50 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 发票.png, 文件夹: images
2025-07-10 08:32:50 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 181542 字节
2025-07-10 08:32:50 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250710083250_发票.png
2025-07-10 08:32:50 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250710083250_发票.png
2025-07-10 08:32:50 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250710083250_发票.png, disposition=inline
2025-07-10 08:32:54 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250710083250_发票.png
2025-07-10 08:32:54 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710083250_发票.png
2025-07-10 08:32:54 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 银行卡.jpg, 文件夹: images
2025-07-10 08:32:54 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 488408 字节
2025-07-10 08:32:54 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250710083254_银行卡.jpg
2025-07-10 08:32:54 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250710083254_银行卡.jpg
2025-07-10 08:32:54 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250710083254_银行卡.jpg, disposition=inline
2025-07-10 08:32:56 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250710083254_银行卡.jpg
2025-07-10 08:32:56 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710083254_银行卡.jpg
2025-07-10 08:32:56 | ERROR | app.core.middleware:dispatch:66 - 请求异常: POST http://localhost:8000/api/v1/agentic/classification - 错误: 'Agent' object has no attribute 'get_response'
2025-07-10 08:32:56 | ERROR | app.core.middleware:global_exception_handler:39 - Unhandled error: 'Agent' object has no attribute 'get_response'
  + Exception Group Traceback (most recent call last):
  |
  |   File "/app/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 177, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                │     │                      └ <anyio._backends._asyncio.TaskGroup object at 0xffff597270b0>
  |                │     └ <function create_task_group at 0xffff7e664f40>
  |                └ <module 'anyio' from '/app/.venv/lib/python3.12/site-packages/anyio/__init__.py'>
  |   File "/app/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  |
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |           │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff597687c0>
    |           │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff597...
    |           │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
    |           │    └ <app.core.middleware.LoggingMiddleware object at 0xffff598a3950>
    |           └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff598a39b0>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 176, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |          │            │            └ <function collapse_excgroups at 0xffff7d280f40>
    |          │            └ MemoryObjectSendStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_receive...
    |          └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
    |   File "/usr/local/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |     │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [AttributeError("'Agent' object has no attribute 'get_response'")])
    |     │    │   └ <method 'throw' of 'generator' objects>
    |     │    └ <generator object collapse_excgroups at 0xffff59799630>
    |     └ <contextlib._GeneratorContextManager object at 0xffff59726ba0>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 178, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                      │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff596db1a0>
    |                      │    │             └ <starlette.middleware.base._CachedRequest object at 0xffff59724da0>
    |                      │    └ <bound method LoggingMiddleware.dispatch of <app.core.middleware.LoggingMiddleware object at 0xffff598a3950>>
    |                      └ <app.core.middleware.LoggingMiddleware object at 0xffff598a3950>
    |
    |   File "/app/app/core/middleware.py", line 57, in dispatch
    |     response = await call_next(request)
    |                      │         └ <starlette.middleware.base._CachedRequest object at 0xffff59724da0>
    |                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff596db1a0>
    |
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 156, in call_next
    |     raise app_exc
    |           └ AttributeError("'Agent' object has no attribute 'get_response'")
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 141, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |           │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff7d0dd120>
    |           │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7d0de0c0>
    |           │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
    |           │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff598a3920>
    |           └ <app.core.middleware.LoggingMiddleware object at 0xffff598a3950>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |           │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff7d0dd120>
    |           │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7d0de0c0>
    |           │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
    |           │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff5994b290>
    |           └ <starlette.middleware.cors.CORSMiddleware object at 0xffff598a3920>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |           │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff7d0dd120>
    |           │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7d0de0c0>
    |           │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
    |           │                            │    │    └ <starlette.requests.Request object at 0xffff59727230>
    |           │                            │    └ <fastapi.routing.APIRouter object at 0xffff7d180f20>
    |           │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff5994b290>
    |           └ <function wrap_app_handling_exceptions at 0xffff7d2fb100>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |           │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff7d0ddb20>
    |           │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7d0de0c0>
    |           │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
    |           └ <fastapi.routing.APIRouter object at 0xffff7d180f20>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |           │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff7d0ddb20>
    |           │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7d0de0c0>
    |           │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
    |           │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0xffff7d180f20>>
    |           └ <fastapi.routing.APIRouter object at 0xffff7d180f20>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |           │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff7d0ddb20>
    |           │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7d0de0c0>
    |           │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
    |           │     └ <function Route.handle at 0xffff7d1d05e0>
    |           └ APIRoute(path='/api/v1/agentic/classification', name='classify_evidence_endpoint', methods=['POST'])
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |           │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff7d0ddb20>
    |           │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7d0de0c0>
    |           │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
    |           │    └ <function request_response.<locals>.app at 0xffff5985bb00>
    |           └ APIRoute(path='/api/v1/agentic/classification', name='classify_evidence_endpoint', methods=['POST'])
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |           │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff7d0ddb20>
    |           │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7d0de0c0>
    |           │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
    |           │                            │    └ <starlette.requests.Request object at 0xffff59727500>
    |           │                            └ <function request_response.<locals>.app.<locals>.app at 0xffff7d0dd800>
    |           └ <function wrap_app_handling_exceptions at 0xffff7d2fb100>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |           │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff57655bc0>
    |           │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7d0de0c0>
    |           │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
    |           └ <function request_response.<locals>.app.<locals>.app at 0xffff7d0dd800>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                      │ └ <starlette.requests.Request object at 0xffff59727500>
    |                      └ <function get_request_handler.<locals>.app at 0xffff5985b9c0>
    |   File "/app/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                          └ <function run_endpoint_function at 0xffff7d2faf20>
    |   File "/app/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |                  │         │      └ {'db': <sqlalchemy.ext.asyncio.session.AsyncSession object at 0xffff59727bc0>, 'current_staff': <app.staffs.models.Staff obje...
    |                  │         └ <function classify_evidence_endpoint at 0xffff7ad7aac0>
    |                  └ Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[ModelField(field_info=File(Pydant...
    |
    |   File "/app/app/agentic/routers.py", line 21, in classify_evidence_endpoint
    |     result = await classify_evidence(files)
    |                    │                 └ [UploadFile(filename='发票.png', size=181542, headers=Headers({'content-disposition': 'form-data; name="files"; filename="å\x8f...
    |                    └ <function classify_evidence at 0xffff7ad7a700>
    |
    |   File "/app/app/agentic/services.py", line 33, in classify_evidence
    |     response = evidence_classifier.agent.get_response(
    |                │                   └ <unprintable Agent object>
    |                └ <app.agentic.agents.evidence_classifier.EvidenceClassifier object at 0xffff59853b00>
    |
    | AttributeError: 'Agent' object has no attribute 'get_response'. Did you mean: 'run_response'?
    +------------------------------------


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/app/.venv/bin/uvicorn", line 10, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/app/.venv/lib/python3.12/site-packages/click/core.py", line 1442, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffff7e99d620>
           └ <Command main>
  File "/app/.venv/lib/python3.12/site-packages/click/core.py", line 1363, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffff7ea90140>
         │    └ <function Command.invoke at 0xffff7e99d300>
         └ <Command main>
  File "/app/.venv/lib/python3.12/site-packages/click/core.py", line 1226, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffff7ea90140>
           │   │      │    └ <function main at 0xffff7e6c80e0>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffff7e99c540>
           └ <click.core.Context object at 0xffff7ea90140>
  File "/app/.venv/lib/python3.12/site-packages/click/core.py", line 794, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffff7e6c80e0>
  File "/app/.venv/lib/python3.12/site-packages/uvicorn/main.py", line 413, in main
    run(
    └ <function run at 0xffff7e99bb00>
  File "/app/.venv/lib/python3.12/site-packages/uvicorn/main.py", line 580, in run
    server.run()
    │      └ <function Server.run at 0xffff7e7a8180>
    └ <uvicorn.server.Server object at 0xffff7e9b2360>
  File "/app/.venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffff7e7a8220>
           │       │   └ <uvicorn.server.Server object at 0xffff7e9b2360>
           │       └ <function run at 0xffff7f97c680>
           └ <module 'asyncio' from '/usr/local/lib/python3.12/asyncio/__init__.py'>
  File "/usr/local/lib/python3.12/asyncio/runners.py", line 195, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffff7e6d67a0>
           │      └ <function Runner.run at 0xffff7ec702c0>
           └ <asyncio.runners.Runner object at 0xffff7eaacbf0>
  File "/usr/local/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /app/.venv/lib/python3.12/site-packages/uvicorn/server.py:71> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffff7e6a8450>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffff7eaacbf0>
  File "/app/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff7e9bb9e0>
  File "/app/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff59724c...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff597...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffff7eaae180>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff7e9bb9e0>
  File "/app/.venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff59724c...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff597...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
  File "/app/.venv/lib/python3.12/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff59724c...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff597...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff598a39b0>
          └ <fastapi.applications.FastAPI object at 0xffff7eaae180>
> File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff597687c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff597...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
          │    └ <app.core.middleware.LoggingMiddleware object at 0xffff598a3950>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff598a39b0>
  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 176, in __call__
    with recv_stream, send_stream, collapse_excgroups():
         │            │            └ <function collapse_excgroups at 0xffff7d280f40>
         │            └ MemoryObjectSendStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_receive...
         └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [AttributeError("'Agent' object has no attribute 'get_response'")])
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0xffff59799630>
    └ <contextlib._GeneratorContextManager object at 0xffff59726ba0>
  File "/app/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 178, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff596db1a0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0xffff59724da0>
                     │    └ <bound method LoggingMiddleware.dispatch of <app.core.middleware.LoggingMiddleware object at 0xffff598a3950>>
                     └ <app.core.middleware.LoggingMiddleware object at 0xffff598a3950>

  File "/app/app/core/middleware.py", line 57, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0xffff59724da0>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff596db1a0>

  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 156, in call_next
    raise app_exc
          └ AttributeError("'Agent' object has no attribute 'get_response'")
  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff7d0dd120>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7d0de0c0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff598a3920>
          └ <app.core.middleware.LoggingMiddleware object at 0xffff598a3950>
  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff7d0dd120>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7d0de0c0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff5994b290>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffff598a3920>
  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff7d0dd120>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7d0de0c0>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
          │                            │    │    └ <starlette.requests.Request object at 0xffff59727230>
          │                            │    └ <fastapi.routing.APIRouter object at 0xffff7d180f20>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff5994b290>
          └ <function wrap_app_handling_exceptions at 0xffff7d2fb100>
  File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff7d0ddb20>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7d0de0c0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
          └ <fastapi.routing.APIRouter object at 0xffff7d180f20>
  File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff7d0ddb20>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7d0de0c0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0xffff7d180f20>>
          └ <fastapi.routing.APIRouter object at 0xffff7d180f20>
  File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff7d0ddb20>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7d0de0c0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
          │     └ <function Route.handle at 0xffff7d1d05e0>
          └ APIRoute(path='/api/v1/agentic/classification', name='classify_evidence_endpoint', methods=['POST'])
  File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff7d0ddb20>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7d0de0c0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffff5985bb00>
          └ APIRoute(path='/api/v1/agentic/classification', name='classify_evidence_endpoint', methods=['POST'])
  File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff7d0ddb20>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7d0de0c0>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
          │                            │    └ <starlette.requests.Request object at 0xffff59727500>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0xffff7d0dd800>
          └ <function wrap_app_handling_exceptions at 0xffff7d2fb100>
  File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff57655bc0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7d0de0c0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
          └ <function request_response.<locals>.app.<locals>.app at 0xffff7d0dd800>
  File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0xffff59727500>
                     └ <function get_request_handler.<locals>.app at 0xffff5985b9c0>
  File "/app/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xffff7d2faf20>
  File "/app/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.ext.asyncio.session.AsyncSession object at 0xffff59727bc0>, 'current_staff': <app.staffs.models.Staff obje...
                 │         └ <function classify_evidence_endpoint at 0xffff7ad7aac0>
                 └ Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[ModelField(field_info=File(Pydant...

  File "/app/app/agentic/routers.py", line 21, in classify_evidence_endpoint
    result = await classify_evidence(files)
                   │                 └ [UploadFile(filename='发票.png', size=181542, headers=Headers({'content-disposition': 'form-data; name="files"; filename="å\x8f...
                   └ <function classify_evidence at 0xffff7ad7a700>

  File "/app/app/agentic/services.py", line 33, in classify_evidence
    response = evidence_classifier.agent.get_response(
               │                   └ <unprintable Agent object>
               └ <app.agentic.agents.evidence_classifier.EvidenceClassifier object at 0xffff59853b00>

AttributeError: 'Agent' object has no attribute 'get_response'. Did you mean: 'run_response'?
2025-07-10 08:34:27 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/agentic/classification
2025-07-10 08:34:27 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 发票.png, 文件夹: images
2025-07-10 08:34:27 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 181542 字节
2025-07-10 08:34:27 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250710083427_发票.png
2025-07-10 08:34:27 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250710083427_发票.png
2025-07-10 08:34:27 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250710083427_发票.png, disposition=inline
2025-07-10 08:34:30 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250710083427_发票.png
2025-07-10 08:34:30 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710083427_发票.png
2025-07-10 08:34:30 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 银行卡.jpg, 文件夹: images
2025-07-10 08:34:30 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 488408 字节
2025-07-10 08:34:30 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250710083430_银行卡.jpg
2025-07-10 08:34:30 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250710083430_银行卡.jpg
2025-07-10 08:34:30 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250710083430_银行卡.jpg, disposition=inline
2025-07-10 08:34:30 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250710083430_银行卡.jpg
2025-07-10 08:34:30 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710083430_银行卡.jpg
2025-07-10 08:35:04 | ERROR | app.core.middleware:dispatch:66 - 请求异常: POST http://localhost:8000/api/v1/agentic/classification - 错误: 1 validation errors:
  {'type': 'missing', 'loc': ('response', 'data', 'results'), 'msg': 'Field required', 'input': RunResponse(content=Results(results=[EvidenceClassificationResult(file_url='https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710083427_发票.png', category_id='invoice', category_name='发票', confidence=0.9, reason='该文件包含典型的发票特征，如发票代码、发票号码、开票日期、金额合计等。可以根据这些信息以及图片中的布局和印章确认其分类为发票。'), EvidenceClassificationResult(file_url='https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710083430_银行卡.jpg', category_id='unknown', category_name='unknown', confidence=0.0, reason='知识库中没有找到关于银行卡的相关分类信息，因此无法准确分类。')]), content_type='Results', thinking=None, reasoning_content=None, messages=[Message(role='system', content='<your_role>\n你是一个证据分类专家，你的目标是接收一组证据并将它们按照知识库中的分类指南进行准确的分类\n</your_role>\n\n<instructions>\n- 在响应之前永远要查询你的知识库\n- 确保分类是知识库中的,永远不要自行创造分类\n- 若分类不在知识库中被匹对,那么`category_id`和`category_name`应该为`unknown`\n- 确保使用中文输出`reason`\n</instructions>', name=None, tool_call_id=None, tool_calls=None, audio=None, images=None, videos=None, files=None, audio_output=None, image_output=None, thinking=None, redacted_thinking=None, provider_data=None, citations=None, reasoning_content=None, tool_name=None, tool_args=None, tool_call_error=None, stop_after_tool_call=False, add_to_agent_memory=True, from_history=False, metrics=MessageMetrics(input_tokens=0, output_tokens=0, total_tokens=0, audio_tokens=0, input_audio_tokens=0, output_audio_tokens=0, cached_tokens=0, cache_write_tokens=0, reasoning_tokens=0, prompt_tokens=0, completion_tokens=0, prompt_tokens_details=None, completion_tokens_details=None, additional_metrics=None, time=None, time_to_first_token=None, timer=None), references=None, created_at=1752136471), Message(role='user', content='请对以下证据进行分类：\n1. file_url: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710083427_发票.png\n2. file_url: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710083430_银行卡.jpg', name=None, tool_call_id=None, tool_calls=None, audio=None, images=[Image(url='https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710083427_发票.png', filepath=None, content=None, format=None, detail=None, id=None), Image(url='https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710083430_银行卡.jpg', filepath=None, content=None, format=None, detail=None, id=None)], videos=None, files=None, audio_output=None, image_output=None, thinking=None, redacted_thinking=None, provider_data=None, citations=None, reasoning_content=None, tool_name=None, tool_args=None, tool_call_error=None, stop_after_tool_call=False, add_to_agent_memory=True, from_history=False, metrics=MessageMetrics(input_tokens=0, output_tokens=0, total_tokens=0, audio_tokens=0, input_audio_tokens=0, output_audio_tokens=0, cached_tokens=0, cache_write_tokens=0, reasoning_tokens=0, prompt_tokens=0, completion_tokens=0, prompt_tokens_details=None, completion_tokens_details=None, additional_metrics=None, time=None, time_to_first_token=None, timer=None), references=None, created_at=1752136471), Message(role='assistant', content='', name=None, tool_call_id=None, tool_calls=[{'id': 'call_pLZjJiCMcCyyN0b1AAR6TZuU', 'function': {'arguments': '{"query": "发票"}', 'name': 'search_knowledge_base'}, 'type': 'function'}, {'id': 'call_o3sV7QJ3Hmu0MEHZpH1107JU', 'function': {'arguments': '{"query": "银行卡"}', 'name': 'search_knowledge_base'}, 'type': 'function'}], audio=None, images=None, videos=None, files=None, audio_output=None, image_output=None, thinking=None, redacted_thinking=None, provider_data=None, citations=None, reasoning_content=None, tool_name=None, tool_args=None, tool_call_error=None, stop_after_tool_call=False, add_to_agent_memory=True, from_history=False, metrics=MessageMetrics(input_tokens=2249, output_tokens=49, total_tokens=2298, audio_tokens=0, input_audio_tokens=0, output_audio_tokens=0, cached_tokens=0, cache_write_tokens=0, reasoning_tokens=0, prompt_tokens=2249, completion_tokens=49, prompt_tokens_details={'audio_tokens': 0, 'cached_tokens': 0}, completion_tokens_details={'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, additional_metrics=None, time=17.483665216015652, time_to_first_token=None, timer=<agno.utils.timer.Timer object at 0xffff6c17ec60>), references=None, created_at=1752136471), Message(role='tool', content='[\n  {\n    "name": "invoice",\n    "meta_data": {},\n    "content": "---\\ncategory_id: invoice\\ncategory_name: 发票\\nversion: 1.0\\n---\\n\\n# 证据分类指南：发票 (Invoice)\\n\\n本文档用于指导AI模型识别和分类发票类证据。\\n\\n## 核心定义\\n发票是指在购销商品、提供或者接受服务以及从事其他经营活动中，开具、收取的收付款凭证。\\n\\n## 主要特征\\n\\n### 文本特征\\n- **必须包含的关键词**: \\"发票\\"、\\"发票代码\\"、\\"发票号码\\"、\\"开票日期\\"、\\"收款方\\"、\\"付款方\\"、\\"金额合计\\"。\\n- **格式化的数据**: \\n  - **发票代码**: 通常是一串10位或12位的数字。\\n  - **发票号码**: 通常是一串8位的数字。\\n  - **日期**: 格式通常为 `YYYY年MM月DD日`。\\n  - **金额**: 通常包含 `¥` 符号，并有明确的大写金额和小写金额栏目。\\n\\n### 视觉和布局特征\\n- **整体布局**: \\n  - **页眉**: 通常包含开票方的名称和Logo。\\n  - **主体**: 以表格形式呈现，包含商品名称、数量、单价、金额等列。\\n  - **页脚**: 包含开票人、收款人、复核人等信息。\\n- **特定视觉元素**:\\n  - **印章**: 通常在右下角或中间位置盖有红色的公司发票专用章。\\n  - **二维码**: 近年的电子发票在左上角或右上角通常有一个二维码区域。\\n\\n## 示例\\n\\n### 正面示例\\n- 一张包含“增值税普通发票”字样，有清晰表格和红色印章的图片。\\n- 一张从税务局官方软件开具的，带有二维码的电子发票PDF截图。\\n\\n### 负面示例 (易混淆项)\\n- **收据 (Receipt)**: 只包含“收据”或“收款收据”字样，缺少“发票代码”和“发票号码”。\\n- **采购单 (Purchase Order)**: 包含“采购单”或“订单”字样，用于订购商品，而非最终付款凭证。\\n- **送货单 (Delivery Note)**: 仅列出配送的商品清单，不含税额和总金额等关键财务信息。"\n  },\n  {\n    "name": "company_business",\n    "meta_data": {},\n    "content": "---\\ntitle: Company Business\\ncompany_name: 汇ss智能AI律师\\n---\\n\\n# 公司业务\\n汇ss是一家专业的法律服务机构，在债务纠纷领域有着非常丰富的经验和案例。\\n\\n# 收费模式\\n汇ss在用户的诉讼案件胜诉后才会收费，承诺先诉讼，后收款。费用为500元。"\n  },\n  {\n    "name": "company_business",\n    "meta_data": {},\n    "content": "---\\ntitle: Company Business\\ncompany_name: 汇法律智能AI律师\\n---\\n\\n# 公司业务\\n汇法律是一家专业的法律服务机构，在债务纠纷领域有着非常丰富的经验和案例。\\n\\n# 收费模式\\n汇法律在用户的诉讼案件胜诉后才会收费，承诺先诉讼，后收款。费用为500元。"\n  }\n]', name=None, tool_call_id='call_pLZjJiCMcCyyN0b1AAR6TZuU', tool_calls=None, audio=None, images=None, videos=None, files=None, audio_output=None, image_output=None, thinking=None, redacted_thinking=None, provider_data=None, citations=None, reasoning_content=None, tool_name='search_knowledge_base', tool_args={'query': '发票'}, tool_call_error=False, stop_after_tool_call=False, add_to_agent_memory=True, from_history=False, metrics=MessageMetrics(input_tokens=0, output_tokens=0, total_tokens=0, audio_tokens=0, input_audio_tokens=0, output_audio_tokens=0, cached_tokens=0, cache_write_tokens=0, reasoning_tokens=0, prompt_tokens=0, completion_tokens=0, prompt_tokens_details=None, completion_tokens_details=None, additional_metrics=None, time=1.3844615429989062, time_to_first_token=None, timer=None), references=None, created_at=1752136489), Message(role='tool', content='[\n  {\n    "name": "invoice",\n    "meta_data": {},\n    "content": "---\\ncategory_id: invoice\\ncategory_name: 发票\\nversion: 1.0\\n---\\n\\n# 证据分类指南：发票 (Invoice)\\n\\n本文档用于指导AI模型识别和分类发票类证据。\\n\\n## 核心定义\\n发票是指在购销商品、提供或者接受服务以及从事其他经营活动中，开具、收取的收付款凭证。\\n\\n## 主要特征\\n\\n### 文本特征\\n- **必须包含的关键词**: \\"发票\\"、\\"发票代码\\"、\\"发票号码\\"、\\"开票日期\\"、\\"收款方\\"、\\"付款方\\"、\\"金额合计\\"。\\n- **格式化的数据**: \\n  - **发票代码**: 通常是一串10位或12位的数字。\\n  - **发票号码**: 通常是一串8位的数字。\\n  - **日期**: 格式通常为 `YYYY年MM月DD日`。\\n  - **金额**: 通常包含 `¥` 符号，并有明确的大写金额和小写金额栏目。\\n\\n### 视觉和布局特征\\n- **整体布局**: \\n  - **页眉**: 通常包含开票方的名称和Logo。\\n  - **主体**: 以表格形式呈现，包含商品名称、数量、单价、金额等列。\\n  - **页脚**: 包含开票人、收款人、复核人等信息。\\n- **特定视觉元素**:\\n  - **印章**: 通常在右下角或中间位置盖有红色的公司发票专用章。\\n  - **二维码**: 近年的电子发票在左上角或右上角通常有一个二维码区域。\\n\\n## 示例\\n\\n### 正面示例\\n- 一张包含“增值税普通发票”字样，有清晰表格和红色印章的图片。\\n- 一张从税务局官方软件开具的，带有二维码的电子发票PDF截图。\\n\\n### 负面示例 (易混淆项)\\n- **收据 (Receipt)**: 只包含“收据”或“收款收据”字样，缺少“发票代码”和“发票号码”。\\n- **采购单 (Purchase Order)**: 包含“采购单”或“订单”字样，用于订购商品，而非最终付款凭证。\\n- **送货单 (Delivery Note)**: 仅列出配送的商品清单，不含税额和总金额等关键财务信息。"\n  },\n  {\n    "name": "company_business",\n    "meta_data": {},\n    "content": "---\\ntitle: Company Business\\ncompany_name: 汇法律智能AI律师\\n---\\n\\n# 公司业务\\n汇法律是一家专业的法律服务机构，在债务纠纷领域有着非常丰富的经验和案例。\\n\\n# 收费模式\\n汇法律在用户的诉讼案件胜诉后才会收费，承诺先诉讼，后收款。费用为500元。"\n  },\n  {\n    "name": "company_business",\n    "meta_data": {},\n    "content": "---\\ntitle: Company Business\\ncompany_name: 汇ss智能AI律师\\n---\\n\\n# 公司业务\\n汇ss是一家专业的法律服务机构，在债务纠纷领域有着非常丰富的经验和案例。\\n\\n# 收费模式\\n汇ss在用户的诉讼案件胜诉后才会收费，承诺先诉讼，后收款。费用为500元。"\n  }\n]', name=None, tool_call_id='call_o3sV7QJ3Hmu0MEHZpH1107JU', tool_calls=None, audio=None, images=None, videos=None, files=None, audio_output=None, image_output=None, thinking=None, redacted_thinking=None, provider_data=None, citations=None, reasoning_content=None, tool_name='search_knowledge_base', tool_args={'query': '银行卡'}, tool_call_error=False, stop_after_tool_call=False, add_to_agent_memory=True, from_history=False, metrics=MessageMetrics(input_tokens=0, output_tokens=0, total_tokens=0, audio_tokens=0, input_audio_tokens=0, output_audio_tokens=0, cached_tokens=0, cache_write_tokens=0, reasoning_tokens=0, prompt_tokens=0, completion_tokens=0, prompt_tokens_details=None, completion_tokens_details=None, additional_metrics=None, time=0.5287035829969682, time_to_first_token=None, timer=None), references=None, created_at=1752136490), Message(role='assistant', content='{"results":[{"category_id":"invoice","category_name":"发票","confidence":0.9,"file_url":"https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710083427_发票.png","reason":"该文件包含典型的发票特征，如发票代码、发票号码、开票日期、金额合计等。可以根据这些信息以及图片中的布局和印章确认其分类为发票。"},{"category_id":"unknown","category_name":"unknown","confidence":0,"file_url":"https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710083430_银行卡.jpg","reason":"知识库中没有找到关于银行卡的相关分类信息，因此无法准确分类。"}]}', name=None, tool_call_id=None, tool_calls=None, audio=None, images=None, videos=None, files=None, audio_output=None, image_output=None, thinking=None, redacted_thinking=None, provider_data=None, citations=None, reasoning_content=None, tool_name=None, tool_args=None, tool_call_error=None, stop_after_tool_call=False, add_to_agent_memory=True, from_history=False, metrics=MessageMetrics(input_tokens=7686, output_tokens=177, total_tokens=7863, audio_tokens=0, input_audio_tokens=0, output_audio_tokens=0, cached_tokens=0, cache_write_tokens=0, reasoning_tokens=0, prompt_tokens=7686, completion_tokens=177, prompt_tokens_details={'audio_tokens': 0, 'cached_tokens': 0}, completion_tokens_details={'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, additional_metrics=None, time=11.989050256001065, time_to_first_token=None, timer=<agno.utils.timer.Timer object at 0xffff6c56e840>), references=None, created_at=1752136490)], metrics={'input_tokens': [2249, 7686], 'output_tokens': [49, 177], 'total_tokens': [2298, 7863], 'audio_tokens': [0, 0], 'input_audio_tokens': [0, 0], 'output_audio_tokens': [0, 0], 'cached_tokens': [0, 0], 'cache_write_tokens': [0, 0], 'reasoning_tokens': [0, 0], 'prompt_tokens': [2249, 7686], 'completion_tokens': [49, 177], 'prompt_tokens_details': [{'audio_tokens': 0, 'cached_tokens': 0}, {'audio_tokens': 0, 'cached_tokens': 0}], 'completion_tokens_details': [{'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}], 'time': [17.483665216015652, 11.989050256001065]}, model='gpt-4o', model_provider='OpenAI', run_id='da167b9b-87b0-4e3f-94de-311a52093cfb', agent_id='f28bb33a-2dd2-486e-bcc6-9b668334258e', agent_name='证据分类专家', session_id='61eb2abe-013e-4b62-9656-8dfaca8be851', team_session_id=None, workflow_id=None, tools=[ToolExecution(tool_call_id='call_pLZjJiCMcCyyN0b1AAR6TZuU', tool_name='search_knowledge_base', tool_args={'query': '发票'}, tool_call_error=False, result='[\n  {\n    "name": "invoice",\n    "meta_data": {},\n    "content": "---\\ncategory_id: invoice\\ncategory_name: 发票\\nversion: 1.0\\n---\\n\\n# 证据分类指南：发票 (Invoice)\\n\\n本文档用于指导AI模型识别和分类发票类证据。\\n\\n## 核心定义\\n发票是指在购销商品、提供或者接受服务以及从事其他经营活动中，开具、收取的收付款凭证。\\n\\n## 主要特征\\n\\n### 文本特征\\n- **必须包含的关键词**: \\"发票\\"、\\"发票代码\\"、\\"发票号码\\"、\\"开票日期\\"、\\"收款方\\"、\\"付款方\\"、\\"金额合计\\"。\\n- **格式化的数据**: \\n  - **发票代码**: 通常是一串10位或12位的数字。\\n  - **发票号码**: 通常是一串8位的数字。\\n  - **日期**: 格式通常为 `YYYY年MM月DD日`。\\n  - **金额**: 通常包含 `¥` 符号，并有明确的大写金额和小写金额栏目。\\n\\n### 视觉和布局特征\\n- **整体布局**: \\n  - **页眉**: 通常包含开票方的名称和Logo。\\n  - **主体**: 以表格形式呈现，包含商品名称、数量、单价、金额等列。\\n  - **页脚**: 包含开票人、收款人、复核人等信息。\\n- **特定视觉元素**:\\n  - **印章**: 通常在右下角或中间位置盖有红色的公司发票专用章。\\n  - **二维码**: 近年的电子发票在左上角或右上角通常有一个二维码区域。\\n\\n## 示例\\n\\n### 正面示例\\n- 一张包含“增值税普通发票”字样，有清晰表格和红色印章的图片。\\n- 一张从税务局官方软件开具的，带有二维码的电子发票PDF截图。\\n\\n### 负面示例 (易混淆项)\\n- **收据 (Receipt)**: 只包含“收据”或“收款收据”字样，缺少“发票代码”和“发票号码”。\\n- **采购单 (Purchase Order)**: 包含“采购单”或“订单”字样，用于订购商品，而非最终付款凭证。\\n- **送货单 (Delivery Note)**: 仅列出配送的商品清单，不含税额和总金额等关键财务信息。"\n  },\n  {\n    "name": "company_business",\n    "meta_data": {},\n    "content": "---\\ntitle: Company Business\\ncompany_name: 汇ss智能AI律师\\n---\\n\\n# 公司业务\\n汇ss是一家专业的法律服务机构，在债务纠纷领域有着非常丰富的经验和案例。\\n\\n# 收费模式\\n汇ss在用户的诉讼案件胜诉后才会收费，承诺先诉讼，后收款。费用为500元。"\n  },\n  {\n    "name": "company_business",\n    "meta_data": {},\n    "content": "---\\ntitle: Company Business\\ncompany_name: 汇法律智能AI律师\\n---\\n\\n# 公司业务\\n汇法律是一家专业的法律服务机构，在债务纠纷领域有着非常丰富的经验和案例。\\n\\n# 收费模式\\n汇法律在用户的诉讼案件胜诉后才会收费，承诺先诉讼，后收款。费用为500元。"\n  }\n]', metrics=MessageMetrics(input_tokens=0, output_tokens=0, total_tokens=0, audio_tokens=0, input_audio_tokens=0, output_audio_tokens=0, cached_tokens=0, cache_write_tokens=0, reasoning_tokens=0, prompt_tokens=0, completion_tokens=0, prompt_tokens_details=None, completion_tokens_details=None, additional_metrics=None, time=1.3844615429989062, time_to_first_token=None, timer=None), stop_after_tool_call=False, created_at=1752136446, requires_confirmation=None, confirmed=None, confirmation_note=None, requires_user_input=None, user_input_schema=None, answered=None, external_execution_required=None), ToolExecution(tool_call_id='call_o3sV7QJ3Hmu0MEHZpH1107JU', tool_name='search_knowledge_base', tool_args={'query': '银行卡'}, tool_call_error=False, result='[\n  {\n    "name": "invoice",\n    "meta_data": {},\n    "content": "---\\ncategory_id: invoice\\ncategory_name: 发票\\nversion: 1.0\\n---\\n\\n# 证据分类指南：发票 (Invoice)\\n\\n本文档用于指导AI模型识别和分类发票类证据。\\n\\n## 核心定义\\n发票是指在购销商品、提供或者接受服务以及从事其他经营活动中，开具、收取的收付款凭证。\\n\\n## 主要特征\\n\\n### 文本特征\\n- **必须包含的关键词**: \\"发票\\"、\\"发票代码\\"、\\"发票号码\\"、\\"开票日期\\"、\\"收款方\\"、\\"付款方\\"、\\"金额合计\\"。\\n- **格式化的数据**: \\n  - **发票代码**: 通常是一串10位或12位的数字。\\n  - **发票号码**: 通常是一串8位的数字。\\n  - **日期**: 格式通常为 `YYYY年MM月DD日`。\\n  - **金额**: 通常包含 `¥` 符号，并有明确的大写金额和小写金额栏目。\\n\\n### 视觉和布局特征\\n- **整体布局**: \\n  - **页眉**: 通常包含开票方的名称和Logo。\\n  - **主体**: 以表格形式呈现，包含商品名称、数量、单价、金额等列。\\n  - **页脚**: 包含开票人、收款人、复核人等信息。\\n- **特定视觉元素**:\\n  - **印章**: 通常在右下角或中间位置盖有红色的公司发票专用章。\\n  - **二维码**: 近年的电子发票在左上角或右上角通常有一个二维码区域。\\n\\n## 示例\\n\\n### 正面示例\\n- 一张包含“增值税普通发票”字样，有清晰表格和红色印章的图片。\\n- 一张从税务局官方软件开具的，带有二维码的电子发票PDF截图。\\n\\n### 负面示例 (易混淆项)\\n- **收据 (Receipt)**: 只包含“收据”或“收款收据”字样，缺少“发票代码”和“发票号码”。\\n- **采购单 (Purchase Order)**: 包含“采购单”或“订单”字样，用于订购商品，而非最终付款凭证。\\n- **送货单 (Delivery Note)**: 仅列出配送的商品清单，不含税额和总金额等关键财务信息。"\n  },\n  {\n    "name": "company_business",\n    "meta_data": {},\n    "content": "---\\ntitle: Company Business\\ncompany_name: 汇法律智能AI律师\\n---\\n\\n# 公司业务\\n汇法律是一家专业的法律服务机构，在债务纠纷领域有着非常丰富的经验和案例。\\n\\n# 收费模式\\n汇法律在用户的诉讼案件胜诉后才会收费，承诺先诉讼，后收款。费用为500元。"\n  },\n  {\n    "name": "company_business",\n    "meta_data": {},\n    "content": "---\\ntitle: Company Business\\ncompany_name: 汇ss智能AI律师\\n---\\n\\n# 公司业务\\n汇ss是一家专业的法律服务机构，在债务纠纷领域有着非常丰富的经验和案例。\\n\\n# 收费模式\\n汇ss在用户的诉讼案件胜诉后才会收费，承诺先诉讼，后收款。费用为500元。"\n  }\n]', metrics=MessageMetrics(input_tokens=0, output_tokens=0, total_tokens=0, audio_tokens=0, input_audio_tokens=0, output_audio_tokens=0, cached_tokens=0, cache_write_tokens=0, reasoning_tokens=0, prompt_tokens=0, completion_tokens=0, prompt_tokens_details=None, completion_tokens_details=None, additional_metrics=None, time=0.5287035829969682, time_to_first_token=None, timer=None), stop_after_tool_call=False, created_at=1752136446, requires_confirmation=None, confirmed=None, confirmation_note=None, requires_user_input=None, user_input_schema=None, answered=None, external_execution_required=None)], formatted_tool_calls=['search_knowledge_base(query=发票)', 'search_knowledge_base(query=银行卡)'], images=None, videos=None, audio=None, response_audio=None, citations=None, extra_data=RunResponseExtraData(references=[MessageReferences(query='发票', references=[{'name': 'invoice', 'meta_data': {}, 'content': '---\ncategory_id: invoice\ncategory_name: 发票\nversion: 1.0\n---\n\n# 证据分类指南：发票 (Invoice)\n\n本文档用于指导AI模型识别和分类发票类证据。\n\n## 核心定义\n发票是指在购销商品、提供或者接受服务以及从事其他经营活动中，开具、收取的收付款凭证。\n\n## 主要特征\n\n### 文本特征\n- **必须包含的关键词**: "发票"、"发票代码"、"发票号码"、"开票日期"、"收款方"、"付款方"、"金额合计"。\n- **格式化的数据**: \n  - **发票代码**: 通常是一串10位或12位的数字。\n  - **发票号码**: 通常是一串8位的数字。\n  - **日期**: 格式通常为 `YYYY年MM月DD日`。\n  - **金额**: 通常包含 `¥` 符号，并有明确的大写金额和小写金额栏目。\n\n### 视觉和布局特征\n- **整体布局**: \n  - **页眉**: 通常包含开票方的名称和Logo。\n  - **主体**: 以表格形式呈现，包含商品名称、数量、单价、金额等列。\n  - **页脚**: 包含开票人、收款人、复核人等信息。\n- **特定视觉元素**:\n  - **印章**: 通常在右下角或中间位置盖有红色的公司发票专用章。\n  - **二维码**: 近年的电子发票在左上角或右上角通常有一个二维码区域。\n\n## 示例\n\n### 正面示例\n- 一张包含“增值税普通发票”字样，有清晰表格和红色印章的图片。\n- 一张从税务局官方软件开具的，带有二维码的电子发票PDF截图。\n\n### 负面示例 (易混淆项)\n- **收据 (Receipt)**: 只包含“收据”或“收款收据”字样，缺少“发票代码”和“发票号码”。\n- **采购单 (Purchase Order)**: 包含“采购单”或“订单”字样，用于订购商品，而非最终付款凭证。\n- **送货单 (Delivery Note)**: 仅列出配送的商品清单，不含税额和总金额等关键财务信息。'}, {'name': 'company_business', 'meta_data': {}, 'content': '---\ntitle: Company Business\ncompany_name: 汇ss智能AI律师\n---\n\n# 公司业务\n汇ss是一家专业的法律服务机构，在债务纠纷领域有着非常丰富的经验和案例。\n\n# 收费模式\n汇ss在用户的诉讼案件胜诉后才会收费，承诺先诉讼，后收款。费用为500元。'}, {'name': 'company_business', 'meta_data': {}, 'content': '---\ntitle: Company Business\ncompany_name: 汇法律智能AI律师\n---\n\n# 公司业务\n汇法律是一家专业的法律服务机构，在债务纠纷领域有着非常丰富的经验和案例。\n\n# 收费模式\n汇法律在用户的诉讼案件胜诉后才会收费，承诺先诉讼，后收款。费用为500元。'}], time=1.3798), MessageReferences(query='银行卡', references=[{'name': 'invoice', 'meta_data': {}, 'content': '---\ncategory_id: invoice\ncategory_name: 发票\nversion: 1.0\n---\n\n# 证据分类指南：发票 (Invoice)\n\n本文档用于指导AI模型识别和分类发票类证据。\n\n## 核心定义\n发票是指在购销商品、提供或者接受服务以及从事其他经营活动中，开具、收取的收付款凭证。\n\n## 主要特征\n\n### 文本特征\n- **必须包含的关键词**: "发票"、"发票代码"、"发票号码"、"开票日期"、"收款方"、"付款方"、"金额合计"。\n- **格式化的数据**: \n  - **发票代码**: 通常是一串10位或12位的数字。\n  - **发票号码**: 通常是一串8位的数字。\n  - **日期**: 格式通常为 `YYYY年MM月DD日`。\n  - **金额**: 通常包含 `¥` 符号，并有明确的大写金额和小写金额栏目。\n\n### 视觉和布局特征\n- **整体布局**: \n  - **页眉**: 通常包含开票方的名称和Logo。\n  - **主体**: 以表格形式呈现，包含商品名称、数量、单价、金额等列。\n  - **页脚**: 包含开票人、收款人、复核人等信息。\n- **特定视觉元素**:\n  - **印章**: 通常在右下角或中间位置盖有红色的公司发票专用章。\n  - **二维码**: 近年的电子发票在左上角或右上角通常有一个二维码区域。\n\n## 示例\n\n### 正面示例\n- 一张包含“增值税普通发票”字样，有清晰表格和红色印章的图片。\n- 一张从税务局官方软件开具的，带有二维码的电子发票PDF截图。\n\n### 负面示例 (易混淆项)\n- **收据 (Receipt)**: 只包含“收据”或“收款收据”字样，缺少“发票代码”和“发票号码”。\n- **采购单 (Purchase Order)**: 包含“采购单”或“订单”字样，用于订购商品，而非最终付款凭证。\n- **送货单 (Delivery Note)**: 仅列出配送的商品清单，不含税额和总金额等关键财务信息。'}, {'name': 'company_business', 'meta_data': {}, 'content': '---\ntitle: Company Business\ncompany_name: 汇法律智能AI律师\n---\n\n# 公司业务\n汇法律是一家专业的法律服务机构，在债务纠纷领域有着非常丰富的经验和案例。\n\n# 收费模式\n汇法律在用户的诉讼案件胜诉后才会收费，承诺先诉讼，后收款。费用为500元。'}, {'name': 'company_business', 'meta_data': {}, 'content': '---\ntitle: Company Business\ncompany_name: 汇ss智能AI律师\n---\n\n# 公司业务\n汇ss是一家专业的法律服务机构，在债务纠纷领域有着非常丰富的经验和案例。\n\n# 收费模式\n汇ss在用户的诉讼案件胜诉后才会收费，承诺先诉讼，后收款。费用为500元。'}], time=0.5274)], add_messages=None, reasoning_steps=None, reasoning_messages=None), created_at=1752136446, events=None, status=<RunStatus.running: 'RUNNING'>)}

2025-07-10 08:35:04 | ERROR | app.core.middleware:global_exception_handler:39 - Unhandled error: 1 validation errors:
  {'type': 'missing', 'loc': ('response', 'data', 'results'), 'msg': 'Field required', 'input': RunResponse(content=Results(results=[EvidenceClassificationResult(file_url='https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710083427_发票.png', category_id='invoice', category_name='发票', confidence=0.9, reason='该文件包含典型的发票特征，如发票代码、发票号码、开票日期、金额合计等。可以根据这些信息以及图片中的布局和印章确认其分类为发票。'), EvidenceClassificationResult(file_url='https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710083430_银行卡.jpg', category_id='unknown', category_name='unknown', confidence=0.0, reason='知识库中没有找到关于银行卡的相关分类信息，因此无法准确分类。')]), content_type='Results', thinking=None, reasoning_content=None, messages=[Message(role='system', content='<your_role>\n你是一个证据分类专家，你的目标是接收一组证据并将它们按照知识库中的分类指南进行准确的分类\n</your_role>\n\n<instructions>\n- 在响应之前永远要查询你的知识库\n- 确保分类是知识库中的,永远不要自行创造分类\n- 若分类不在知识库中被匹对,那么`category_id`和`category_name`应该为`unknown`\n- 确保使用中文输出`reason`\n</instructions>', name=None, tool_call_id=None, tool_calls=None, audio=None, images=None, videos=None, files=None, audio_output=None, image_output=None, thinking=None, redacted_thinking=None, provider_data=None, citations=None, reasoning_content=None, tool_name=None, tool_args=None, tool_call_error=None, stop_after_tool_call=False, add_to_agent_memory=True, from_history=False, metrics=MessageMetrics(input_tokens=0, output_tokens=0, total_tokens=0, audio_tokens=0, input_audio_tokens=0, output_audio_tokens=0, cached_tokens=0, cache_write_tokens=0, reasoning_tokens=0, prompt_tokens=0, completion_tokens=0, prompt_tokens_details=None, completion_tokens_details=None, additional_metrics=None, time=None, time_to_first_token=None, timer=None), references=None, created_at=1752136471), Message(role='user', content='请对以下证据进行分类：\n1. file_url: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710083427_发票.png\n2. file_url: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710083430_银行卡.jpg', name=None, tool_call_id=None, tool_calls=None, audio=None, images=[Image(url='https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710083427_发票.png', filepath=None, content=None, format=None, detail=None, id=None), Image(url='https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710083430_银行卡.jpg', filepath=None, content=None, format=None, detail=None, id=None)], videos=None, files=None, audio_output=None, image_output=None, thinking=None, redacted_thinking=None, provider_data=None, citations=None, reasoning_content=None, tool_name=None, tool_args=None, tool_call_error=None, stop_after_tool_call=False, add_to_agent_memory=True, from_history=False, metrics=MessageMetrics(input_tokens=0, output_tokens=0, total_tokens=0, audio_tokens=0, input_audio_tokens=0, output_audio_tokens=0, cached_tokens=0, cache_write_tokens=0, reasoning_tokens=0, prompt_tokens=0, completion_tokens=0, prompt_tokens_details=None, completion_tokens_details=None, additional_metrics=None, time=None, time_to_first_token=None, timer=None), references=None, created_at=1752136471), Message(role='assistant', content='', name=None, tool_call_id=None, tool_calls=[{'id': 'call_pLZjJiCMcCyyN0b1AAR6TZuU', 'function': {'arguments': '{"query": "发票"}', 'name': 'search_knowledge_base'}, 'type': 'function'}, {'id': 'call_o3sV7QJ3Hmu0MEHZpH1107JU', 'function': {'arguments': '{"query": "银行卡"}', 'name': 'search_knowledge_base'}, 'type': 'function'}], audio=None, images=None, videos=None, files=None, audio_output=None, image_output=None, thinking=None, redacted_thinking=None, provider_data=None, citations=None, reasoning_content=None, tool_name=None, tool_args=None, tool_call_error=None, stop_after_tool_call=False, add_to_agent_memory=True, from_history=False, metrics=MessageMetrics(input_tokens=2249, output_tokens=49, total_tokens=2298, audio_tokens=0, input_audio_tokens=0, output_audio_tokens=0, cached_tokens=0, cache_write_tokens=0, reasoning_tokens=0, prompt_tokens=2249, completion_tokens=49, prompt_tokens_details={'audio_tokens': 0, 'cached_tokens': 0}, completion_tokens_details={'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, additional_metrics=None, time=17.483665216015652, time_to_first_token=None, timer=<agno.utils.timer.Timer object at 0xffff6c17ec60>), references=None, created_at=1752136471), Message(role='tool', content='[\n  {\n    "name": "invoice",\n    "meta_data": {},\n    "content": "---\\ncategory_id: invoice\\ncategory_name: 发票\\nversion: 1.0\\n---\\n\\n# 证据分类指南：发票 (Invoice)\\n\\n本文档用于指导AI模型识别和分类发票类证据。\\n\\n## 核心定义\\n发票是指在购销商品、提供或者接受服务以及从事其他经营活动中，开具、收取的收付款凭证。\\n\\n## 主要特征\\n\\n### 文本特征\\n- **必须包含的关键词**: \\"发票\\"、\\"发票代码\\"、\\"发票号码\\"、\\"开票日期\\"、\\"收款方\\"、\\"付款方\\"、\\"金额合计\\"。\\n- **格式化的数据**: \\n  - **发票代码**: 通常是一串10位或12位的数字。\\n  - **发票号码**: 通常是一串8位的数字。\\n  - **日期**: 格式通常为 `YYYY年MM月DD日`。\\n  - **金额**: 通常包含 `¥` 符号，并有明确的大写金额和小写金额栏目。\\n\\n### 视觉和布局特征\\n- **整体布局**: \\n  - **页眉**: 通常包含开票方的名称和Logo。\\n  - **主体**: 以表格形式呈现，包含商品名称、数量、单价、金额等列。\\n  - **页脚**: 包含开票人、收款人、复核人等信息。\\n- **特定视觉元素**:\\n  - **印章**: 通常在右下角或中间位置盖有红色的公司发票专用章。\\n  - **二维码**: 近年的电子发票在左上角或右上角通常有一个二维码区域。\\n\\n## 示例\\n\\n### 正面示例\\n- 一张包含“增值税普通发票”字样，有清晰表格和红色印章的图片。\\n- 一张从税务局官方软件开具的，带有二维码的电子发票PDF截图。\\n\\n### 负面示例 (易混淆项)\\n- **收据 (Receipt)**: 只包含“收据”或“收款收据”字样，缺少“发票代码”和“发票号码”。\\n- **采购单 (Purchase Order)**: 包含“采购单”或“订单”字样，用于订购商品，而非最终付款凭证。\\n- **送货单 (Delivery Note)**: 仅列出配送的商品清单，不含税额和总金额等关键财务信息。"\n  },\n  {\n    "name": "company_business",\n    "meta_data": {},\n    "content": "---\\ntitle: Company Business\\ncompany_name: 汇ss智能AI律师\\n---\\n\\n# 公司业务\\n汇ss是一家专业的法律服务机构，在债务纠纷领域有着非常丰富的经验和案例。\\n\\n# 收费模式\\n汇ss在用户的诉讼案件胜诉后才会收费，承诺先诉讼，后收款。费用为500元。"\n  },\n  {\n    "name": "company_business",\n    "meta_data": {},\n    "content": "---\\ntitle: Company Business\\ncompany_name: 汇法律智能AI律师\\n---\\n\\n# 公司业务\\n汇法律是一家专业的法律服务机构，在债务纠纷领域有着非常丰富的经验和案例。\\n\\n# 收费模式\\n汇法律在用户的诉讼案件胜诉后才会收费，承诺先诉讼，后收款。费用为500元。"\n  }\n]', name=None, tool_call_id='call_pLZjJiCMcCyyN0b1AAR6TZuU', tool_calls=None, audio=None, images=None, videos=None, files=None, audio_output=None, image_output=None, thinking=None, redacted_thinking=None, provider_data=None, citations=None, reasoning_content=None, tool_name='search_knowledge_base', tool_args={'query': '发票'}, tool_call_error=False, stop_after_tool_call=False, add_to_agent_memory=True, from_history=False, metrics=MessageMetrics(input_tokens=0, output_tokens=0, total_tokens=0, audio_tokens=0, input_audio_tokens=0, output_audio_tokens=0, cached_tokens=0, cache_write_tokens=0, reasoning_tokens=0, prompt_tokens=0, completion_tokens=0, prompt_tokens_details=None, completion_tokens_details=None, additional_metrics=None, time=1.3844615429989062, time_to_first_token=None, timer=None), references=None, created_at=1752136489), Message(role='tool', content='[\n  {\n    "name": "invoice",\n    "meta_data": {},\n    "content": "---\\ncategory_id: invoice\\ncategory_name: 发票\\nversion: 1.0\\n---\\n\\n# 证据分类指南：发票 (Invoice)\\n\\n本文档用于指导AI模型识别和分类发票类证据。\\n\\n## 核心定义\\n发票是指在购销商品、提供或者接受服务以及从事其他经营活动中，开具、收取的收付款凭证。\\n\\n## 主要特征\\n\\n### 文本特征\\n- **必须包含的关键词**: \\"发票\\"、\\"发票代码\\"、\\"发票号码\\"、\\"开票日期\\"、\\"收款方\\"、\\"付款方\\"、\\"金额合计\\"。\\n- **格式化的数据**: \\n  - **发票代码**: 通常是一串10位或12位的数字。\\n  - **发票号码**: 通常是一串8位的数字。\\n  - **日期**: 格式通常为 `YYYY年MM月DD日`。\\n  - **金额**: 通常包含 `¥` 符号，并有明确的大写金额和小写金额栏目。\\n\\n### 视觉和布局特征\\n- **整体布局**: \\n  - **页眉**: 通常包含开票方的名称和Logo。\\n  - **主体**: 以表格形式呈现，包含商品名称、数量、单价、金额等列。\\n  - **页脚**: 包含开票人、收款人、复核人等信息。\\n- **特定视觉元素**:\\n  - **印章**: 通常在右下角或中间位置盖有红色的公司发票专用章。\\n  - **二维码**: 近年的电子发票在左上角或右上角通常有一个二维码区域。\\n\\n## 示例\\n\\n### 正面示例\\n- 一张包含“增值税普通发票”字样，有清晰表格和红色印章的图片。\\n- 一张从税务局官方软件开具的，带有二维码的电子发票PDF截图。\\n\\n### 负面示例 (易混淆项)\\n- **收据 (Receipt)**: 只包含“收据”或“收款收据”字样，缺少“发票代码”和“发票号码”。\\n- **采购单 (Purchase Order)**: 包含“采购单”或“订单”字样，用于订购商品，而非最终付款凭证。\\n- **送货单 (Delivery Note)**: 仅列出配送的商品清单，不含税额和总金额等关键财务信息。"\n  },\n  {\n    "name": "company_business",\n    "meta_data": {},\n    "content": "---\\ntitle: Company Business\\ncompany_name: 汇法律智能AI律师\\n---\\n\\n# 公司业务\\n汇法律是一家专业的法律服务机构，在债务纠纷领域有着非常丰富的经验和案例。\\n\\n# 收费模式\\n汇法律在用户的诉讼案件胜诉后才会收费，承诺先诉讼，后收款。费用为500元。"\n  },\n  {\n    "name": "company_business",\n    "meta_data": {},\n    "content": "---\\ntitle: Company Business\\ncompany_name: 汇ss智能AI律师\\n---\\n\\n# 公司业务\\n汇ss是一家专业的法律服务机构，在债务纠纷领域有着非常丰富的经验和案例。\\n\\n# 收费模式\\n汇ss在用户的诉讼案件胜诉后才会收费，承诺先诉讼，后收款。费用为500元。"\n  }\n]', name=None, tool_call_id='call_o3sV7QJ3Hmu0MEHZpH1107JU', tool_calls=None, audio=None, images=None, videos=None, files=None, audio_output=None, image_output=None, thinking=None, redacted_thinking=None, provider_data=None, citations=None, reasoning_content=None, tool_name='search_knowledge_base', tool_args={'query': '银行卡'}, tool_call_error=False, stop_after_tool_call=False, add_to_agent_memory=True, from_history=False, metrics=MessageMetrics(input_tokens=0, output_tokens=0, total_tokens=0, audio_tokens=0, input_audio_tokens=0, output_audio_tokens=0, cached_tokens=0, cache_write_tokens=0, reasoning_tokens=0, prompt_tokens=0, completion_tokens=0, prompt_tokens_details=None, completion_tokens_details=None, additional_metrics=None, time=0.5287035829969682, time_to_first_token=None, timer=None), references=None, created_at=1752136490), Message(role='assistant', content='{"results":[{"category_id":"invoice","category_name":"发票","confidence":0.9,"file_url":"https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710083427_发票.png","reason":"该文件包含典型的发票特征，如发票代码、发票号码、开票日期、金额合计等。可以根据这些信息以及图片中的布局和印章确认其分类为发票。"},{"category_id":"unknown","category_name":"unknown","confidence":0,"file_url":"https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710083430_银行卡.jpg","reason":"知识库中没有找到关于银行卡的相关分类信息，因此无法准确分类。"}]}', name=None, tool_call_id=None, tool_calls=None, audio=None, images=None, videos=None, files=None, audio_output=None, image_output=None, thinking=None, redacted_thinking=None, provider_data=None, citations=None, reasoning_content=None, tool_name=None, tool_args=None, tool_call_error=None, stop_after_tool_call=False, add_to_agent_memory=True, from_history=False, metrics=MessageMetrics(input_tokens=7686, output_tokens=177, total_tokens=7863, audio_tokens=0, input_audio_tokens=0, output_audio_tokens=0, cached_tokens=0, cache_write_tokens=0, reasoning_tokens=0, prompt_tokens=7686, completion_tokens=177, prompt_tokens_details={'audio_tokens': 0, 'cached_tokens': 0}, completion_tokens_details={'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, additional_metrics=None, time=11.989050256001065, time_to_first_token=None, timer=<agno.utils.timer.Timer object at 0xffff6c56e840>), references=None, created_at=1752136490)], metrics={'input_tokens': [2249, 7686], 'output_tokens': [49, 177], 'total_tokens': [2298, 7863], 'audio_tokens': [0, 0], 'input_audio_tokens': [0, 0], 'output_audio_tokens': [0, 0], 'cached_tokens': [0, 0], 'cache_write_tokens': [0, 0], 'reasoning_tokens': [0, 0], 'prompt_tokens': [2249, 7686], 'completion_tokens': [49, 177], 'prompt_tokens_details': [{'audio_tokens': 0, 'cached_tokens': 0}, {'audio_tokens': 0, 'cached_tokens': 0}], 'completion_tokens_details': [{'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}], 'time': [17.483665216015652, 11.989050256001065]}, model='gpt-4o', model_provider='OpenAI', run_id='da167b9b-87b0-4e3f-94de-311a52093cfb', agent_id='f28bb33a-2dd2-486e-bcc6-9b668334258e', agent_name='证据分类专家', session_id='61eb2abe-013e-4b62-9656-8dfaca8be851', team_session_id=None, workflow_id=None, tools=[ToolExecution(tool_call_id='call_pLZjJiCMcCyyN0b1AAR6TZuU', tool_name='search_knowledge_base', tool_args={'query': '发票'}, tool_call_error=False, result='[\n  {\n    "name": "invoice",\n    "meta_data": {},\n    "content": "---\\ncategory_id: invoice\\ncategory_name: 发票\\nversion: 1.0\\n---\\n\\n# 证据分类指南：发票 (Invoice)\\n\\n本文档用于指导AI模型识别和分类发票类证据。\\n\\n## 核心定义\\n发票是指在购销商品、提供或者接受服务以及从事其他经营活动中，开具、收取的收付款凭证。\\n\\n## 主要特征\\n\\n### 文本特征\\n- **必须包含的关键词**: \\"发票\\"、\\"发票代码\\"、\\"发票号码\\"、\\"开票日期\\"、\\"收款方\\"、\\"付款方\\"、\\"金额合计\\"。\\n- **格式化的数据**: \\n  - **发票代码**: 通常是一串10位或12位的数字。\\n  - **发票号码**: 通常是一串8位的数字。\\n  - **日期**: 格式通常为 `YYYY年MM月DD日`。\\n  - **金额**: 通常包含 `¥` 符号，并有明确的大写金额和小写金额栏目。\\n\\n### 视觉和布局特征\\n- **整体布局**: \\n  - **页眉**: 通常包含开票方的名称和Logo。\\n  - **主体**: 以表格形式呈现，包含商品名称、数量、单价、金额等列。\\n  - **页脚**: 包含开票人、收款人、复核人等信息。\\n- **特定视觉元素**:\\n  - **印章**: 通常在右下角或中间位置盖有红色的公司发票专用章。\\n  - **二维码**: 近年的电子发票在左上角或右上角通常有一个二维码区域。\\n\\n## 示例\\n\\n### 正面示例\\n- 一张包含“增值税普通发票”字样，有清晰表格和红色印章的图片。\\n- 一张从税务局官方软件开具的，带有二维码的电子发票PDF截图。\\n\\n### 负面示例 (易混淆项)\\n- **收据 (Receipt)**: 只包含“收据”或“收款收据”字样，缺少“发票代码”和“发票号码”。\\n- **采购单 (Purchase Order)**: 包含“采购单”或“订单”字样，用于订购商品，而非最终付款凭证。\\n- **送货单 (Delivery Note)**: 仅列出配送的商品清单，不含税额和总金额等关键财务信息。"\n  },\n  {\n    "name": "company_business",\n    "meta_data": {},\n    "content": "---\\ntitle: Company Business\\ncompany_name: 汇ss智能AI律师\\n---\\n\\n# 公司业务\\n汇ss是一家专业的法律服务机构，在债务纠纷领域有着非常丰富的经验和案例。\\n\\n# 收费模式\\n汇ss在用户的诉讼案件胜诉后才会收费，承诺先诉讼，后收款。费用为500元。"\n  },\n  {\n    "name": "company_business",\n    "meta_data": {},\n    "content": "---\\ntitle: Company Business\\ncompany_name: 汇法律智能AI律师\\n---\\n\\n# 公司业务\\n汇法律是一家专业的法律服务机构，在债务纠纷领域有着非常丰富的经验和案例。\\n\\n# 收费模式\\n汇法律在用户的诉讼案件胜诉后才会收费，承诺先诉讼，后收款。费用为500元。"\n  }\n]', metrics=MessageMetrics(input_tokens=0, output_tokens=0, total_tokens=0, audio_tokens=0, input_audio_tokens=0, output_audio_tokens=0, cached_tokens=0, cache_write_tokens=0, reasoning_tokens=0, prompt_tokens=0, completion_tokens=0, prompt_tokens_details=None, completion_tokens_details=None, additional_metrics=None, time=1.3844615429989062, time_to_first_token=None, timer=None), stop_after_tool_call=False, created_at=1752136446, requires_confirmation=None, confirmed=None, confirmation_note=None, requires_user_input=None, user_input_schema=None, answered=None, external_execution_required=None), ToolExecution(tool_call_id='call_o3sV7QJ3Hmu0MEHZpH1107JU', tool_name='search_knowledge_base', tool_args={'query': '银行卡'}, tool_call_error=False, result='[\n  {\n    "name": "invoice",\n    "meta_data": {},\n    "content": "---\\ncategory_id: invoice\\ncategory_name: 发票\\nversion: 1.0\\n---\\n\\n# 证据分类指南：发票 (Invoice)\\n\\n本文档用于指导AI模型识别和分类发票类证据。\\n\\n## 核心定义\\n发票是指在购销商品、提供或者接受服务以及从事其他经营活动中，开具、收取的收付款凭证。\\n\\n## 主要特征\\n\\n### 文本特征\\n- **必须包含的关键词**: \\"发票\\"、\\"发票代码\\"、\\"发票号码\\"、\\"开票日期\\"、\\"收款方\\"、\\"付款方\\"、\\"金额合计\\"。\\n- **格式化的数据**: \\n  - **发票代码**: 通常是一串10位或12位的数字。\\n  - **发票号码**: 通常是一串8位的数字。\\n  - **日期**: 格式通常为 `YYYY年MM月DD日`。\\n  - **金额**: 通常包含 `¥` 符号，并有明确的大写金额和小写金额栏目。\\n\\n### 视觉和布局特征\\n- **整体布局**: \\n  - **页眉**: 通常包含开票方的名称和Logo。\\n  - **主体**: 以表格形式呈现，包含商品名称、数量、单价、金额等列。\\n  - **页脚**: 包含开票人、收款人、复核人等信息。\\n- **特定视觉元素**:\\n  - **印章**: 通常在右下角或中间位置盖有红色的公司发票专用章。\\n  - **二维码**: 近年的电子发票在左上角或右上角通常有一个二维码区域。\\n\\n## 示例\\n\\n### 正面示例\\n- 一张包含“增值税普通发票”字样，有清晰表格和红色印章的图片。\\n- 一张从税务局官方软件开具的，带有二维码的电子发票PDF截图。\\n\\n### 负面示例 (易混淆项)\\n- **收据 (Receipt)**: 只包含“收据”或“收款收据”字样，缺少“发票代码”和“发票号码”。\\n- **采购单 (Purchase Order)**: 包含“采购单”或“订单”字样，用于订购商品，而非最终付款凭证。\\n- **送货单 (Delivery Note)**: 仅列出配送的商品清单，不含税额和总金额等关键财务信息。"\n  },\n  {\n    "name": "company_business",\n    "meta_data": {},\n    "content": "---\\ntitle: Company Business\\ncompany_name: 汇法律智能AI律师\\n---\\n\\n# 公司业务\\n汇法律是一家专业的法律服务机构，在债务纠纷领域有着非常丰富的经验和案例。\\n\\n# 收费模式\\n汇法律在用户的诉讼案件胜诉后才会收费，承诺先诉讼，后收款。费用为500元。"\n  },\n  {\n    "name": "company_business",\n    "meta_data": {},\n    "content": "---\\ntitle: Company Business\\ncompany_name: 汇ss智能AI律师\\n---\\n\\n# 公司业务\\n汇ss是一家专业的法律服务机构，在债务纠纷领域有着非常丰富的经验和案例。\\n\\n# 收费模式\\n汇ss在用户的诉讼案件胜诉后才会收费，承诺先诉讼，后收款。费用为500元。"\n  }\n]', metrics=MessageMetrics(input_tokens=0, output_tokens=0, total_tokens=0, audio_tokens=0, input_audio_tokens=0, output_audio_tokens=0, cached_tokens=0, cache_write_tokens=0, reasoning_tokens=0, prompt_tokens=0, completion_tokens=0, prompt_tokens_details=None, completion_tokens_details=None, additional_metrics=None, time=0.5287035829969682, time_to_first_token=None, timer=None), stop_after_tool_call=False, created_at=1752136446, requires_confirmation=None, confirmed=None, confirmation_note=None, requires_user_input=None, user_input_schema=None, answered=None, external_execution_required=None)], formatted_tool_calls=['search_knowledge_base(query=发票)', 'search_knowledge_base(query=银行卡)'], images=None, videos=None, audio=None, response_audio=None, citations=None, extra_data=RunResponseExtraData(references=[MessageReferences(query='发票', references=[{'name': 'invoice', 'meta_data': {}, 'content': '---\ncategory_id: invoice\ncategory_name: 发票\nversion: 1.0\n---\n\n# 证据分类指南：发票 (Invoice)\n\n本文档用于指导AI模型识别和分类发票类证据。\n\n## 核心定义\n发票是指在购销商品、提供或者接受服务以及从事其他经营活动中，开具、收取的收付款凭证。\n\n## 主要特征\n\n### 文本特征\n- **必须包含的关键词**: "发票"、"发票代码"、"发票号码"、"开票日期"、"收款方"、"付款方"、"金额合计"。\n- **格式化的数据**: \n  - **发票代码**: 通常是一串10位或12位的数字。\n  - **发票号码**: 通常是一串8位的数字。\n  - **日期**: 格式通常为 `YYYY年MM月DD日`。\n  - **金额**: 通常包含 `¥` 符号，并有明确的大写金额和小写金额栏目。\n\n### 视觉和布局特征\n- **整体布局**: \n  - **页眉**: 通常包含开票方的名称和Logo。\n  - **主体**: 以表格形式呈现，包含商品名称、数量、单价、金额等列。\n  - **页脚**: 包含开票人、收款人、复核人等信息。\n- **特定视觉元素**:\n  - **印章**: 通常在右下角或中间位置盖有红色的公司发票专用章。\n  - **二维码**: 近年的电子发票在左上角或右上角通常有一个二维码区域。\n\n## 示例\n\n### 正面示例\n- 一张包含“增值税普通发票”字样，有清晰表格和红色印章的图片。\n- 一张从税务局官方软件开具的，带有二维码的电子发票PDF截图。\n\n### 负面示例 (易混淆项)\n- **收据 (Receipt)**: 只包含“收据”或“收款收据”字样，缺少“发票代码”和“发票号码”。\n- **采购单 (Purchase Order)**: 包含“采购单”或“订单”字样，用于订购商品，而非最终付款凭证。\n- **送货单 (Delivery Note)**: 仅列出配送的商品清单，不含税额和总金额等关键财务信息。'}, {'name': 'company_business', 'meta_data': {}, 'content': '---\ntitle: Company Business\ncompany_name: 汇ss智能AI律师\n---\n\n# 公司业务\n汇ss是一家专业的法律服务机构，在债务纠纷领域有着非常丰富的经验和案例。\n\n# 收费模式\n汇ss在用户的诉讼案件胜诉后才会收费，承诺先诉讼，后收款。费用为500元。'}, {'name': 'company_business', 'meta_data': {}, 'content': '---\ntitle: Company Business\ncompany_name: 汇法律智能AI律师\n---\n\n# 公司业务\n汇法律是一家专业的法律服务机构，在债务纠纷领域有着非常丰富的经验和案例。\n\n# 收费模式\n汇法律在用户的诉讼案件胜诉后才会收费，承诺先诉讼，后收款。费用为500元。'}], time=1.3798), MessageReferences(query='银行卡', references=[{'name': 'invoice', 'meta_data': {}, 'content': '---\ncategory_id: invoice\ncategory_name: 发票\nversion: 1.0\n---\n\n# 证据分类指南：发票 (Invoice)\n\n本文档用于指导AI模型识别和分类发票类证据。\n\n## 核心定义\n发票是指在购销商品、提供或者接受服务以及从事其他经营活动中，开具、收取的收付款凭证。\n\n## 主要特征\n\n### 文本特征\n- **必须包含的关键词**: "发票"、"发票代码"、"发票号码"、"开票日期"、"收款方"、"付款方"、"金额合计"。\n- **格式化的数据**: \n  - **发票代码**: 通常是一串10位或12位的数字。\n  - **发票号码**: 通常是一串8位的数字。\n  - **日期**: 格式通常为 `YYYY年MM月DD日`。\n  - **金额**: 通常包含 `¥` 符号，并有明确的大写金额和小写金额栏目。\n\n### 视觉和布局特征\n- **整体布局**: \n  - **页眉**: 通常包含开票方的名称和Logo。\n  - **主体**: 以表格形式呈现，包含商品名称、数量、单价、金额等列。\n  - **页脚**: 包含开票人、收款人、复核人等信息。\n- **特定视觉元素**:\n  - **印章**: 通常在右下角或中间位置盖有红色的公司发票专用章。\n  - **二维码**: 近年的电子发票在左上角或右上角通常有一个二维码区域。\n\n## 示例\n\n### 正面示例\n- 一张包含“增值税普通发票”字样，有清晰表格和红色印章的图片。\n- 一张从税务局官方软件开具的，带有二维码的电子发票PDF截图。\n\n### 负面示例 (易混淆项)\n- **收据 (Receipt)**: 只包含“收据”或“收款收据”字样，缺少“发票代码”和“发票号码”。\n- **采购单 (Purchase Order)**: 包含“采购单”或“订单”字样，用于订购商品，而非最终付款凭证。\n- **送货单 (Delivery Note)**: 仅列出配送的商品清单，不含税额和总金额等关键财务信息。'}, {'name': 'company_business', 'meta_data': {}, 'content': '---\ntitle: Company Business\ncompany_name: 汇法律智能AI律师\n---\n\n# 公司业务\n汇法律是一家专业的法律服务机构，在债务纠纷领域有着非常丰富的经验和案例。\n\n# 收费模式\n汇法律在用户的诉讼案件胜诉后才会收费，承诺先诉讼，后收款。费用为500元。'}, {'name': 'company_business', 'meta_data': {}, 'content': '---\ntitle: Company Business\ncompany_name: 汇ss智能AI律师\n---\n\n# 公司业务\n汇ss是一家专业的法律服务机构，在债务纠纷领域有着非常丰富的经验和案例。\n\n# 收费模式\n汇ss在用户的诉讼案件胜诉后才会收费，承诺先诉讼，后收款。费用为500元。'}], time=0.5274)], add_messages=None, reasoning_steps=None, reasoning_messages=None), created_at=1752136446, events=None, status=<RunStatus.running: 'RUNNING'>)}

  + Exception Group Traceback (most recent call last):
  |
  |   File "/app/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 177, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                │     │                      └ <anyio._backends._asyncio.TaskGroup object at 0xffff6c0d5670>
  |                │     └ <function create_task_group at 0xffff91074f40>
  |                └ <module 'anyio' from '/app/.venv/lib/python3.12/site-packages/anyio/__init__.py'>
  |   File "/app/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  |
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |           │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff6c26bf60>
    |           │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff6c0...
    |           │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
    |           │    └ <app.core.middleware.LoggingMiddleware object at 0xffff6c7acce0>
    |           └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff6c43af60>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 176, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |          │            │            └ <function collapse_excgroups at 0xffff8fc90f40>
    |          │            └ MemoryObjectSendStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_receive...
    |          └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
    |   File "/usr/local/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |     │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ResponseValidationError()])
    |     │    │   └ <method 'throw' of 'generator' objects>
    |     │    └ <generator object collapse_excgroups at 0xffff6c26f440>
    |     └ <contextlib._GeneratorContextManager object at 0xffff6c43ae40>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 178, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                      │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff6c0dc040>
    |                      │    │             └ <starlette.middleware.base._CachedRequest object at 0xffff6c0d47d0>
    |                      │    └ <bound method LoggingMiddleware.dispatch of <app.core.middleware.LoggingMiddleware object at 0xffff6c7acce0>>
    |                      └ <app.core.middleware.LoggingMiddleware object at 0xffff6c7acce0>
    |
    |   File "/app/app/core/middleware.py", line 57, in dispatch
    |     response = await call_next(request)
    |                      │         └ <starlette.middleware.base._CachedRequest object at 0xffff6c0d47d0>
    |                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff6c0dc040>
    |
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 156, in call_next
    |     raise app_exc
    |           └ ResponseValidationError()
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 141, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |           │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff6c0dd6c0>
    |           │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff6c0ec180>
    |           │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
    |           │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff6c2b3bf0>
    |           └ <app.core.middleware.LoggingMiddleware object at 0xffff6c7acce0>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |           │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff6c0dd6c0>
    |           │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff6c0ec180>
    |           │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
    |           │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff6c2b3bc0>
    |           └ <starlette.middleware.cors.CORSMiddleware object at 0xffff6c2b3bf0>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |           │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff6c0dd6c0>
    |           │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff6c0ec180>
    |           │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
    |           │                            │    │    └ <starlette.requests.Request object at 0xffff6c0d5910>
    |           │                            │    └ <fastapi.routing.APIRouter object at 0xffff8fbdc5c0>
    |           │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff6c2b3bc0>
    |           └ <function wrap_app_handling_exceptions at 0xffff8fd07100>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |           │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff6c0f3420>
    |           │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff6c0ec180>
    |           │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
    |           └ <fastapi.routing.APIRouter object at 0xffff8fbdc5c0>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |           │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff6c0f3420>
    |           │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff6c0ec180>
    |           │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
    |           │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0xffff8fbdc5c0>>
    |           └ <fastapi.routing.APIRouter object at 0xffff8fbdc5c0>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |           │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff6c0f3420>
    |           │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff6c0ec180>
    |           │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
    |           │     └ <function Route.handle at 0xffff8fbe45e0>
    |           └ APIRoute(path='/api/v1/agentic/classification', name='classify_evidence_endpoint', methods=['POST'])
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |           │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff6c0f3420>
    |           │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff6c0ec180>
    |           │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
    |           │    └ <function request_response.<locals>.app at 0xffff6c26bb00>
    |           └ APIRoute(path='/api/v1/agentic/classification', name='classify_evidence_endpoint', methods=['POST'])
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |           │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff6c0f3420>
    |           │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff6c0ec180>
    |           │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
    |           │                            │    └ <starlette.requests.Request object at 0xffff6c0d57c0>
    |           │                            └ <function request_response.<locals>.app.<locals>.app at 0xffff6c0f3380>
    |           └ <function wrap_app_handling_exceptions at 0xffff8fd07100>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |           │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff6c0f3240>
    |           │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff6c0ec180>
    |           │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
    |           └ <function request_response.<locals>.app.<locals>.app at 0xffff6c0f3380>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                      │ └ <starlette.requests.Request object at 0xffff6c0d57c0>
    |                      └ <function get_request_handler.<locals>.app at 0xffff6c26b9c0>
    |   File "/app/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 327, in app
    |     content = await serialize_response(
    |                     └ <function serialize_response at 0xffff901ecfe0>
    |   File "/app/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 176, in serialize_response
    |     raise ResponseValidationError(
    |           └ <class 'fastapi.exceptions.ResponseValidationError'>
    |
    | fastapi.exceptions.ResponseValidationError: 1 validation errors:
    |   {'type': 'missing', 'loc': ('response', 'data', 'results'), 'msg': 'Field required', 'input': RunResponse(content=Results(results=[EvidenceClassificationResult(file_url='https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710083427_发票.png', category_id='invoice', category_name='发票', confidence=0.9, reason='该文件包含典型的发票特征，如发票代码、发票号码、开票日期、金额合计等。可以根据这些信息以及图片中的布局和印章确认其分类为发票。'), EvidenceClassificationResult(file_url='https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710083430_银行卡.jpg', category_id='unknown', category_name='unknown', confidence=0.0, reason='知识库中没有找到关于银行卡的相关分类信息，因此无法准确分类。')]), content_type='Results', thinking=None, reasoning_content=None, messages=[Message(role='system', content='<your_role>\n你是一个证据分类专家，你的目标是接收一组证据并将它们按照知识库中的分类指南进行准确的分类\n</your_role>\n\n<instructions>\n- 在响应之前永远要查询你的知识库\n- 确保分类是知识库中的,永远不要自行创造分类\n- 若分类不在知识库中被匹对,那么`category_id`和`category_name`应该为`unknown`\n- 确保使用中文输出`reason`\n</instructions>', name=None, tool_call_id=None, tool_calls=None, audio=None, images=None, videos=None, files=None, audio_output=None, image_output=None, thinking=None, redacted_thinking=None, provider_data=None, citations=None, reasoning_content=None, tool_name=None, tool_args=None, tool_call_error=None, stop_after_tool_call=False, add_to_agent_memory=True, from_history=False, metrics=MessageMetrics(input_tokens=0, output_tokens=0, total_tokens=0, audio_tokens=0, input_audio_tokens=0, output_audio_tokens=0, cached_tokens=0, cache_write_tokens=0, reasoning_tokens=0, prompt_tokens=0, completion_tokens=0, prompt_tokens_details=None, completion_tokens_details=None, additional_metrics=None, time=None, time_to_first_token=None, timer=None), references=None, created_at=1752136471), Message(role='user', content='请对以下证据进行分类：\n1. file_url: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710083427_发票.png\n2. file_url: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710083430_银行卡.jpg', name=None, tool_call_id=None, tool_calls=None, audio=None, images=[Image(url='https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710083427_发票.png', filepath=None, content=None, format=None, detail=None, id=None), Image(url='https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710083430_银行卡.jpg', filepath=None, content=None, format=None, detail=None, id=None)], videos=None, files=None, audio_output=None, image_output=None, thinking=None, redacted_thinking=None, provider_data=None, citations=None, reasoning_content=None, tool_name=None, tool_args=None, tool_call_error=None, stop_after_tool_call=False, add_to_agent_memory=True, from_history=False, metrics=MessageMetrics(input_tokens=0, output_tokens=0, total_tokens=0, audio_tokens=0, input_audio_tokens=0, output_audio_tokens=0, cached_tokens=0, cache_write_tokens=0, reasoning_tokens=0, prompt_tokens=0, completion_tokens=0, prompt_tokens_details=None, completion_tokens_details=None, additional_metrics=None, time=None, time_to_first_token=None, timer=None), references=None, created_at=1752136471), Message(role='assistant', content='', name=None, tool_call_id=None, tool_calls=[{'id': 'call_pLZjJiCMcCyyN0b1AAR6TZuU', 'function': {'arguments': '{"query": "发票"}', 'name': 'search_knowledge_base'}, 'type': 'function'}, {'id': 'call_o3sV7QJ3Hmu0MEHZpH1107JU', 'function': {'arguments': '{"query": "银行卡"}', 'name': 'search_knowledge_base'}, 'type': 'function'}], audio=None, images=None, videos=None, files=None, audio_output=None, image_output=None, thinking=None, redacted_thinking=None, provider_data=None, citations=None, reasoning_content=None, tool_name=None, tool_args=None, tool_call_error=None, stop_after_tool_call=False, add_to_agent_memory=True, from_history=False, metrics=MessageMetrics(input_tokens=2249, output_tokens=49, total_tokens=2298, audio_tokens=0, input_audio_tokens=0, output_audio_tokens=0, cached_tokens=0, cache_write_tokens=0, reasoning_tokens=0, prompt_tokens=2249, completion_tokens=49, prompt_tokens_details={'audio_tokens': 0, 'cached_tokens': 0}, completion_tokens_details={'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, additional_metrics=None, time=17.483665216015652, time_to_first_token=None, timer=<agno.utils.timer.Timer object at 0xffff6c17ec60>), references=None, created_at=1752136471), Message(role='tool', content='[\n  {\n    "name": "invoice",\n    "meta_data": {},\n    "content": "---\\ncategory_id: invoice\\ncategory_name: 发票\\nversion: 1.0\\n---\\n\\n# 证据分类指南：发票 (Invoice)\\n\\n本文档用于指导AI模型识别和分类发票类证据。\\n\\n## 核心定义\\n发票是指在购销商品、提供或者接受服务以及从事其他经营活动中，开具、收取的收付款凭证。\\n\\n## 主要特征\\n\\n### 文本特征\\n- **必须包含的关键词**: \\"发票\\"、\\"发票代码\\"、\\"发票号码\\"、\\"开票日期\\"、\\"收款方\\"、\\"付款方\\"、\\"金额合计\\"。\\n- **格式化的数据**: \\n  - **发票代码**: 通常是一串10位或12位的数字。\\n  - **发票号码**: 通常是一串8位的数字。\\n  - **日期**: 格式通常为 `YYYY年MM月DD日`。\\n  - **金额**: 通常包含 `¥` 符号，并有明确的大写金额和小写金额栏目。\\n\\n### 视觉和布局特征\\n- **整体布局**: \\n  - **页眉**: 通常包含开票方的名称和Logo。\\n  - **主体**: 以表格形式呈现，包含商品名称、数量、单价、金额等列。\\n  - **页脚**: 包含开票人、收款人、复核人等信息。\\n- **特定视觉元素**:\\n  - **印章**: 通常在右下角或中间位置盖有红色的公司发票专用章。\\n  - **二维码**: 近年的电子发票在左上角或右上角通常有一个二维码区域。\\n\\n## 示例\\n\\n### 正面示例\\n- 一张包含“增值税普通发票”字样，有清晰表格和红色印章的图片。\\n- 一张从税务局官方软件开具的，带有二维码的电子发票PDF截图。\\n\\n### 负面示例 (易混淆项)\\n- **收据 (Receipt)**: 只包含“收据”或“收款收据”字样，缺少“发票代码”和“发票号码”。\\n- **采购单 (Purchase Order)**: 包含“采购单”或“订单”字样，用于订购商品，而非最终付款凭证。\\n- **送货单 (Delivery Note)**: 仅列出配送的商品清单，不含税额和总金额等关键财务信息。"\n  },\n  {\n    "name": "company_business",\n    "meta_data": {},\n    "content": "---\\ntitle: Company Business\\ncompany_name: 汇ss智能AI律师\\n---\\n\\n# 公司业务\\n汇ss是一家专业的法律服务机构，在债务纠纷领域有着非常丰富的经验和案例。\\n\\n# 收费模式\\n汇ss在用户的诉讼案件胜诉后才会收费，承诺先诉讼，后收款。费用为500元。"\n  },\n  {\n    "name": "company_business",\n    "meta_data": {},\n    "content": "---\\ntitle: Company Business\\ncompany_name: 汇法律智能AI律师\\n---\\n\\n# 公司业务\\n汇法律是一家专业的法律服务机构，在债务纠纷领域有着非常丰富的经验和案例。\\n\\n# 收费模式\\n汇法律在用户的诉讼案件胜诉后才会收费，承诺先诉讼，后收款。费用为500元。"\n  }\n]', name=None, tool_call_id='call_pLZjJiCMcCyyN0b1AAR6TZuU', tool_calls=None, audio=None, images=None, videos=None, files=None, audio_output=None, image_output=None, thinking=None, redacted_thinking=None, provider_data=None, citations=None, reasoning_content=None, tool_name='search_knowledge_base', tool_args={'query': '发票'}, tool_call_error=False, stop_after_tool_call=False, add_to_agent_memory=True, from_history=False, metrics=MessageMetrics(input_tokens=0, output_tokens=0, total_tokens=0, audio_tokens=0, input_audio_tokens=0, output_audio_tokens=0, cached_tokens=0, cache_write_tokens=0, reasoning_tokens=0, prompt_tokens=0, completion_tokens=0, prompt_tokens_details=None, completion_tokens_details=None, additional_metrics=None, time=1.3844615429989062, time_to_first_token=None, timer=None), references=None, created_at=1752136489), Message(role='tool', content='[\n  {\n    "name": "invoice",\n    "meta_data": {},\n    "content": "---\\ncategory_id: invoice\\ncategory_name: 发票\\nversion: 1.0\\n---\\n\\n# 证据分类指南：发票 (Invoice)\\n\\n本文档用于指导AI模型识别和分类发票类证据。\\n\\n## 核心定义\\n发票是指在购销商品、提供或者接受服务以及从事其他经营活动中，开具、收取的收付款凭证。\\n\\n## 主要特征\\n\\n### 文本特征\\n- **必须包含的关键词**: \\"发票\\"、\\"发票代码\\"、\\"发票号码\\"、\\"开票日期\\"、\\"收款方\\"、\\"付款方\\"、\\"金额合计\\"。\\n- **格式化的数据**: \\n  - **发票代码**: 通常是一串10位或12位的数字。\\n  - **发票号码**: 通常是一串8位的数字。\\n  - **日期**: 格式通常为 `YYYY年MM月DD日`。\\n  - **金额**: 通常包含 `¥` 符号，并有明确的大写金额和小写金额栏目。\\n\\n### 视觉和布局特征\\n- **整体布局**: \\n  - **页眉**: 通常包含开票方的名称和Logo。\\n  - **主体**: 以表格形式呈现，包含商品名称、数量、单价、金额等列。\\n  - **页脚**: 包含开票人、收款人、复核人等信息。\\n- **特定视觉元素**:\\n  - **印章**: 通常在右下角或中间位置盖有红色的公司发票专用章。\\n  - **二维码**: 近年的电子发票在左上角或右上角通常有一个二维码区域。\\n\\n## 示例\\n\\n### 正面示例\\n- 一张包含“增值税普通发票”字样，有清晰表格和红色印章的图片。\\n- 一张从税务局官方软件开具的，带有二维码的电子发票PDF截图。\\n\\n### 负面示例 (易混淆项)\\n- **收据 (Receipt)**: 只包含“收据”或“收款收据”字样，缺少“发票代码”和“发票号码”。\\n- **采购单 (Purchase Order)**: 包含“采购单”或“订单”字样，用于订购商品，而非最终付款凭证。\\n- **送货单 (Delivery Note)**: 仅列出配送的商品清单，不含税额和总金额等关键财务信息。"\n  },\n  {\n    "name": "company_business",\n    "meta_data": {},\n    "content": "---\\ntitle: Company Business\\ncompany_name: 汇法律智能AI律师\\n---\\n\\n# 公司业务\\n汇法律是一家专业的法律服务机构，在债务纠纷领域有着非常丰富的经验和案例。\\n\\n# 收费模式\\n汇法律在用户的诉讼案件胜诉后才会收费，承诺先诉讼，后收款。费用为500元。"\n  },\n  {\n    "name": "company_business",\n    "meta_data": {},\n    "content": "---\\ntitle: Company Business\\ncompany_name: 汇ss智能AI律师\\n---\\n\\n# 公司业务\\n汇ss是一家专业的法律服务机构，在债务纠纷领域有着非常丰富的经验和案例。\\n\\n# 收费模式\\n汇ss在用户的诉讼案件胜诉后才会收费，承诺先诉讼，后收款。费用为500元。"\n  }\n]', name=None, tool_call_id='call_o3sV7QJ3Hmu0MEHZpH1107JU', tool_calls=None, audio=None, images=None, videos=None, files=None, audio_output=None, image_output=None, thinking=None, redacted_thinking=None, provider_data=None, citations=None, reasoning_content=None, tool_name='search_knowledge_base', tool_args={'query': '银行卡'}, tool_call_error=False, stop_after_tool_call=False, add_to_agent_memory=True, from_history=False, metrics=MessageMetrics(input_tokens=0, output_tokens=0, total_tokens=0, audio_tokens=0, input_audio_tokens=0, output_audio_tokens=0, cached_tokens=0, cache_write_tokens=0, reasoning_tokens=0, prompt_tokens=0, completion_tokens=0, prompt_tokens_details=None, completion_tokens_details=None, additional_metrics=None, time=0.5287035829969682, time_to_first_token=None, timer=None), references=None, created_at=1752136490), Message(role='assistant', content='{"results":[{"category_id":"invoice","category_name":"发票","confidence":0.9,"file_url":"https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710083427_发票.png","reason":"该文件包含典型的发票特征，如发票代码、发票号码、开票日期、金额合计等。可以根据这些信息以及图片中的布局和印章确认其分类为发票。"},{"category_id":"unknown","category_name":"unknown","confidence":0,"file_url":"https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710083430_银行卡.jpg","reason":"知识库中没有找到关于银行卡的相关分类信息，因此无法准确分类。"}]}', name=None, tool_call_id=None, tool_calls=None, audio=None, images=None, videos=None, files=None, audio_output=None, image_output=None, thinking=None, redacted_thinking=None, provider_data=None, citations=None, reasoning_content=None, tool_name=None, tool_args=None, tool_call_error=None, stop_after_tool_call=False, add_to_agent_memory=True, from_history=False, metrics=MessageMetrics(input_tokens=7686, output_tokens=177, total_tokens=7863, audio_tokens=0, input_audio_tokens=0, output_audio_tokens=0, cached_tokens=0, cache_write_tokens=0, reasoning_tokens=0, prompt_tokens=7686, completion_tokens=177, prompt_tokens_details={'audio_tokens': 0, 'cached_tokens': 0}, completion_tokens_details={'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, additional_metrics=None, time=11.989050256001065, time_to_first_token=None, timer=<agno.utils.timer.Timer object at 0xffff6c56e840>), references=None, created_at=1752136490)], metrics={'input_tokens': [2249, 7686], 'output_tokens': [49, 177], 'total_tokens': [2298, 7863], 'audio_tokens': [0, 0], 'input_audio_tokens': [0, 0], 'output_audio_tokens': [0, 0], 'cached_tokens': [0, 0], 'cache_write_tokens': [0, 0], 'reasoning_tokens': [0, 0], 'prompt_tokens': [2249, 7686], 'completion_tokens': [49, 177], 'prompt_tokens_details': [{'audio_tokens': 0, 'cached_tokens': 0}, {'audio_tokens': 0, 'cached_tokens': 0}], 'completion_tokens_details': [{'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}], 'time': [17.483665216015652, 11.989050256001065]}, model='gpt-4o', model_provider='OpenAI', run_id='da167b9b-87b0-4e3f-94de-311a52093cfb', agent_id='f28bb33a-2dd2-486e-bcc6-9b668334258e', agent_name='证据分类专家', session_id='61eb2abe-013e-4b62-9656-8dfaca8be851', team_session_id=None, workflow_id=None, tools=[ToolExecution(tool_call_id='call_pLZjJiCMcCyyN0b1AAR6TZuU', tool_name='search_knowledge_base', tool_args={'query': '发票'}, tool_call_error=False, result='[\n  {\n    "name": "invoice",\n    "meta_data": {},\n    "content": "---\\ncategory_id: invoice\\ncategory_name: 发票\\nversion: 1.0\\n---\\n\\n# 证据分类指南：发票 (Invoice)\\n\\n本文档用于指导AI模型识别和分类发票类证据。\\n\\n## 核心定义\\n发票是指在购销商品、提供或者接受服务以及从事其他经营活动中，开具、收取的收付款凭证。\\n\\n## 主要特征\\n\\n### 文本特征\\n- **必须包含的关键词**: \\"发票\\"、\\"发票代码\\"、\\"发票号码\\"、\\"开票日期\\"、\\"收款方\\"、\\"付款方\\"、\\"金额合计\\"。\\n- **格式化的数据**: \\n  - **发票代码**: 通常是一串10位或12位的数字。\\n  - **发票号码**: 通常是一串8位的数字。\\n  - **日期**: 格式通常为 `YYYY年MM月DD日`。\\n  - **金额**: 通常包含 `¥` 符号，并有明确的大写金额和小写金额栏目。\\n\\n### 视觉和布局特征\\n- **整体布局**: \\n  - **页眉**: 通常包含开票方的名称和Logo。\\n  - **主体**: 以表格形式呈现，包含商品名称、数量、单价、金额等列。\\n  - **页脚**: 包含开票人、收款人、复核人等信息。\\n- **特定视觉元素**:\\n  - **印章**: 通常在右下角或中间位置盖有红色的公司发票专用章。\\n  - **二维码**: 近年的电子发票在左上角或右上角通常有一个二维码区域。\\n\\n## 示例\\n\\n### 正面示例\\n- 一张包含“增值税普通发票”字样，有清晰表格和红色印章的图片。\\n- 一张从税务局官方软件开具的，带有二维码的电子发票PDF截图。\\n\\n### 负面示例 (易混淆项)\\n- **收据 (Receipt)**: 只包含“收据”或“收款收据”字样，缺少“发票代码”和“发票号码”。\\n- **采购单 (Purchase Order)**: 包含“采购单”或“订单”字样，用于订购商品，而非最终付款凭证。\\n- **送货单 (Delivery Note)**: 仅列出配送的商品清单，不含税额和总金额等关键财务信息。"\n  },\n  {\n    "name": "company_business",\n    "meta_data": {},\n    "content": "---\\ntitle: Company Business\\ncompany_name: 汇ss智能AI律师\\n---\\n\\n# 公司业务\\n汇ss是一家专业的法律服务机构，在债务纠纷领域有着非常丰富的经验和案例。\\n\\n# 收费模式\\n汇ss在用户的诉讼案件胜诉后才会收费，承诺先诉讼，后收款。费用为500元。"\n  },\n  {\n    "name": "company_business",\n    "meta_data": {},\n    "content": "---\\ntitle: Company Business\\ncompany_name: 汇法律智能AI律师\\n---\\n\\n# 公司业务\\n汇法律是一家专业的法律服务机构，在债务纠纷领域有着非常丰富的经验和案例。\\n\\n# 收费模式\\n汇法律在用户的诉讼案件胜诉后才会收费，承诺先诉讼，后收款。费用为500元。"\n  }\n]', metrics=MessageMetrics(input_tokens=0, output_tokens=0, total_tokens=0, audio_tokens=0, input_audio_tokens=0, output_audio_tokens=0, cached_tokens=0, cache_write_tokens=0, reasoning_tokens=0, prompt_tokens=0, completion_tokens=0, prompt_tokens_details=None, completion_tokens_details=None, additional_metrics=None, time=1.3844615429989062, time_to_first_token=None, timer=None), stop_after_tool_call=False, created_at=1752136446, requires_confirmation=None, confirmed=None, confirmation_note=None, requires_user_input=None, user_input_schema=None, answered=None, external_execution_required=None), ToolExecution(tool_call_id='call_o3sV7QJ3Hmu0MEHZpH1107JU', tool_name='search_knowledge_base', tool_args={'query': '银行卡'}, tool_call_error=False, result='[\n  {\n    "name": "invoice",\n    "meta_data": {},\n    "content": "---\\ncategory_id: invoice\\ncategory_name: 发票\\nversion: 1.0\\n---\\n\\n# 证据分类指南：发票 (Invoice)\\n\\n本文档用于指导AI模型识别和分类发票类证据。\\n\\n## 核心定义\\n发票是指在购销商品、提供或者接受服务以及从事其他经营活动中，开具、收取的收付款凭证。\\n\\n## 主要特征\\n\\n### 文本特征\\n- **必须包含的关键词**: \\"发票\\"、\\"发票代码\\"、\\"发票号码\\"、\\"开票日期\\"、\\"收款方\\"、\\"付款方\\"、\\"金额合计\\"。\\n- **格式化的数据**: \\n  - **发票代码**: 通常是一串10位或12位的数字。\\n  - **发票号码**: 通常是一串8位的数字。\\n  - **日期**: 格式通常为 `YYYY年MM月DD日`。\\n  - **金额**: 通常包含 `¥` 符号，并有明确的大写金额和小写金额栏目。\\n\\n### 视觉和布局特征\\n- **整体布局**: \\n  - **页眉**: 通常包含开票方的名称和Logo。\\n  - **主体**: 以表格形式呈现，包含商品名称、数量、单价、金额等列。\\n  - **页脚**: 包含开票人、收款人、复核人等信息。\\n- **特定视觉元素**:\\n  - **印章**: 通常在右下角或中间位置盖有红色的公司发票专用章。\\n  - **二维码**: 近年的电子发票在左上角或右上角通常有一个二维码区域。\\n\\n## 示例\\n\\n### 正面示例\\n- 一张包含“增值税普通发票”字样，有清晰表格和红色印章的图片。\\n- 一张从税务局官方软件开具的，带有二维码的电子发票PDF截图。\\n\\n### 负面示例 (易混淆项)\\n- **收据 (Receipt)**: 只包含“收据”或“收款收据”字样，缺少“发票代码”和“发票号码”。\\n- **采购单 (Purchase Order)**: 包含“采购单”或“订单”字样，用于订购商品，而非最终付款凭证。\\n- **送货单 (Delivery Note)**: 仅列出配送的商品清单，不含税额和总金额等关键财务信息。"\n  },\n  {\n    "name": "company_business",\n    "meta_data": {},\n    "content": "---\\ntitle: Company Business\\ncompany_name: 汇法律智能AI律师\\n---\\n\\n# 公司业务\\n汇法律是一家专业的法律服务机构，在债务纠纷领域有着非常丰富的经验和案例。\\n\\n# 收费模式\\n汇法律在用户的诉讼案件胜诉后才会收费，承诺先诉讼，后收款。费用为500元。"\n  },\n  {\n    "name": "company_business",\n    "meta_data": {},\n    "content": "---\\ntitle: Company Business\\ncompany_name: 汇ss智能AI律师\\n---\\n\\n# 公司业务\\n汇ss是一家专业的法律服务机构，在债务纠纷领域有着非常丰富的经验和案例。\\n\\n# 收费模式\\n汇ss在用户的诉讼案件胜诉后才会收费，承诺先诉讼，后收款。费用为500元。"\n  }\n]', metrics=MessageMetrics(input_tokens=0, output_tokens=0, total_tokens=0, audio_tokens=0, input_audio_tokens=0, output_audio_tokens=0, cached_tokens=0, cache_write_tokens=0, reasoning_tokens=0, prompt_tokens=0, completion_tokens=0, prompt_tokens_details=None, completion_tokens_details=None, additional_metrics=None, time=0.5287035829969682, time_to_first_token=None, timer=None), stop_after_tool_call=False, created_at=1752136446, requires_confirmation=None, confirmed=None, confirmation_note=None, requires_user_input=None, user_input_schema=None, answered=None, external_execution_required=None)], formatted_tool_calls=['search_knowledge_base(query=发票)', 'search_knowledge_base(query=银行卡)'], images=None, videos=None, audio=None, response_audio=None, citations=None, extra_data=RunResponseExtraData(references=[MessageReferences(query='发票', references=[{'name': 'invoice', 'meta_data': {}, 'content': '---\ncategory_id: invoice\ncategory_name: 发票\nversion: 1.0\n---\n\n# 证据分类指南：发票 (Invoice)\n\n本文档用于指导AI模型识别和分类发票类证据。\n\n## 核心定义\n发票是指在购销商品、提供或者接受服务以及从事其他经营活动中，开具、收取的收付款凭证。\n\n## 主要特征\n\n### 文本特征\n- **必须包含的关键词**: "发票"、"发票代码"、"发票号码"、"开票日期"、"收款方"、"付款方"、"金额合计"。\n- **格式化的数据**: \n  - **发票代码**: 通常是一串10位或12位的数字。\n  - **发票号码**: 通常是一串8位的数字。\n  - **日期**: 格式通常为 `YYYY年MM月DD日`。\n  - **金额**: 通常包含 `¥` 符号，并有明确的大写金额和小写金额栏目。\n\n### 视觉和布局特征\n- **整体布局**: \n  - **页眉**: 通常包含开票方的名称和Logo。\n  - **主体**: 以表格形式呈现，包含商品名称、数量、单价、金额等列。\n  - **页脚**: 包含开票人、收款人、复核人等信息。\n- **特定视觉元素**:\n  - **印章**: 通常在右下角或中间位置盖有红色的公司发票专用章。\n  - **二维码**: 近年的电子发票在左上角或右上角通常有一个二维码区域。\n\n## 示例\n\n### 正面示例\n- 一张包含“增值税普通发票”字样，有清晰表格和红色印章的图片。\n- 一张从税务局官方软件开具的，带有二维码的电子发票PDF截图。\n\n### 负面示例 (易混淆项)\n- **收据 (Receipt)**: 只包含“收据”或“收款收据”字样，缺少“发票代码”和“发票号码”。\n- **采购单 (Purchase Order)**: 包含“采购单”或“订单”字样，用于订购商品，而非最终付款凭证。\n- **送货单 (Delivery Note)**: 仅列出配送的商品清单，不含税额和总金额等关键财务信息。'}, {'name': 'company_business', 'meta_data': {}, 'content': '---\ntitle: Company Business\ncompany_name: 汇ss智能AI律师\n---\n\n# 公司业务\n汇ss是一家专业的法律服务机构，在债务纠纷领域有着非常丰富的经验和案例。\n\n# 收费模式\n汇ss在用户的诉讼案件胜诉后才会收费，承诺先诉讼，后收款。费用为500元。'}, {'name': 'company_business', 'meta_data': {}, 'content': '---\ntitle: Company Business\ncompany_name: 汇法律智能AI律师\n---\n\n# 公司业务\n汇法律是一家专业的法律服务机构，在债务纠纷领域有着非常丰富的经验和案例。\n\n# 收费模式\n汇法律在用户的诉讼案件胜诉后才会收费，承诺先诉讼，后收款。费用为500元。'}], time=1.3798), MessageReferences(query='银行卡', references=[{'name': 'invoice', 'meta_data': {}, 'content': '---\ncategory_id: invoice\ncategory_name: 发票\nversion: 1.0\n---\n\n# 证据分类指南：发票 (Invoice)\n\n本文档用于指导AI模型识别和分类发票类证据。\n\n## 核心定义\n发票是指在购销商品、提供或者接受服务以及从事其他经营活动中，开具、收取的收付款凭证。\n\n## 主要特征\n\n### 文本特征\n- **必须包含的关键词**: "发票"、"发票代码"、"发票号码"、"开票日期"、"收款方"、"付款方"、"金额合计"。\n- **格式化的数据**: \n  - **发票代码**: 通常是一串10位或12位的数字。\n  - **发票号码**: 通常是一串8位的数字。\n  - **日期**: 格式通常为 `YYYY年MM月DD日`。\n  - **金额**: 通常包含 `¥` 符号，并有明确的大写金额和小写金额栏目。\n\n### 视觉和布局特征\n- **整体布局**: \n  - **页眉**: 通常包含开票方的名称和Logo。\n  - **主体**: 以表格形式呈现，包含商品名称、数量、单价、金额等列。\n  - **页脚**: 包含开票人、收款人、复核人等信息。\n- **特定视觉元素**:\n  - **印章**: 通常在右下角或中间位置盖有红色的公司发票专用章。\n  - **二维码**: 近年的电子发票在左上角或右上角通常有一个二维码区域。\n\n## 示例\n\n### 正面示例\n- 一张包含“增值税普通发票”字样，有清晰表格和红色印章的图片。\n- 一张从税务局官方软件开具的，带有二维码的电子发票PDF截图。\n\n### 负面示例 (易混淆项)\n- **收据 (Receipt)**: 只包含“收据”或“收款收据”字样，缺少“发票代码”和“发票号码”。\n- **采购单 (Purchase Order)**: 包含“采购单”或“订单”字样，用于订购商品，而非最终付款凭证。\n- **送货单 (Delivery Note)**: 仅列出配送的商品清单，不含税额和总金额等关键财务信息。'}, {'name': 'company_business', 'meta_data': {}, 'content': '---\ntitle: Company Business\ncompany_name: 汇法律智能AI律师\n---\n\n# 公司业务\n汇法律是一家专业的法律服务机构，在债务纠纷领域有着非常丰富的经验和案例。\n\n# 收费模式\n汇法律在用户的诉讼案件胜诉后才会收费，承诺先诉讼，后收款。费用为500元。'}, {'name': 'company_business', 'meta_data': {}, 'content': '---\ntitle: Company Business\ncompany_name: 汇ss智能AI律师\n---\n\n# 公司业务\n汇ss是一家专业的法律服务机构，在债务纠纷领域有着非常丰富的经验和案例。\n\n# 收费模式\n汇ss在用户的诉讼案件胜诉后才会收费，承诺先诉讼，后收款。费用为500元。'}], time=0.5274)], add_messages=None, reasoning_steps=None, reasoning_messages=None), created_at=1752136446, events=None, status=<RunStatus.running: 'RUNNING'>)}
    |
    +------------------------------------


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/app/.venv/bin/uvicorn", line 10, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/app/.venv/lib/python3.12/site-packages/click/core.py", line 1442, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffff913ad620>
           └ <Command main>
  File "/app/.venv/lib/python3.12/site-packages/click/core.py", line 1363, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffff920c9ee0>
         │    └ <function Command.invoke at 0xffff913ad300>
         └ <Command main>
  File "/app/.venv/lib/python3.12/site-packages/click/core.py", line 1226, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffff920c9ee0>
           │   │      │    └ <function main at 0xffff911380e0>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffff913ac540>
           └ <click.core.Context object at 0xffff920c9ee0>
  File "/app/.venv/lib/python3.12/site-packages/click/core.py", line 794, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffff911380e0>
  File "/app/.venv/lib/python3.12/site-packages/uvicorn/main.py", line 413, in main
    run(
    └ <function run at 0xffff913abb00>
  File "/app/.venv/lib/python3.12/site-packages/uvicorn/main.py", line 580, in run
    server.run()
    │      └ <function Server.run at 0xffff911b8180>
    └ <uvicorn.server.Server object at 0xffff916432c0>
  File "/app/.venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffff911b8220>
           │       │   └ <uvicorn.server.Server object at 0xffff916432c0>
           │       └ <function run at 0xffff9238c680>
           └ <module 'asyncio' from '/usr/local/lib/python3.12/asyncio/__init__.py'>
  File "/usr/local/lib/python3.12/asyncio/runners.py", line 195, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffff910e67a0>
           │      └ <function Runner.run at 0xffff916802c0>
           └ <asyncio.runners.Runner object at 0xffff92000740>
  File "/usr/local/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /app/.venv/lib/python3.12/site-packages/uvicorn/server.py:71> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffff910b8450>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffff92000740>
  File "/app/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff91265d30>
  File "/app/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff6c0d45...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff6c0...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
                 │    └ <fastapi.applications.FastAPI object at 0xffff9128f3b0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff91265d30>
  File "/app/.venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff6c0d45...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff6c0...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
  File "/app/.venv/lib/python3.12/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff6c0d45...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff6c0...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff6c43af60>
          └ <fastapi.applications.FastAPI object at 0xffff9128f3b0>
> File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff6c26bf60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff6c0...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
          │    └ <app.core.middleware.LoggingMiddleware object at 0xffff6c7acce0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff6c43af60>
  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 176, in __call__
    with recv_stream, send_stream, collapse_excgroups():
         │            │            └ <function collapse_excgroups at 0xffff8fc90f40>
         │            └ MemoryObjectSendStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_receive...
         └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ResponseValidationError()])
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0xffff6c26f440>
    └ <contextlib._GeneratorContextManager object at 0xffff6c43ae40>
  File "/app/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 178, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff6c0dc040>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0xffff6c0d47d0>
                     │    └ <bound method LoggingMiddleware.dispatch of <app.core.middleware.LoggingMiddleware object at 0xffff6c7acce0>>
                     └ <app.core.middleware.LoggingMiddleware object at 0xffff6c7acce0>

  File "/app/app/core/middleware.py", line 57, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0xffff6c0d47d0>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff6c0dc040>

  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 156, in call_next
    raise app_exc
          └ ResponseValidationError()
  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff6c0dd6c0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff6c0ec180>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff6c2b3bf0>
          └ <app.core.middleware.LoggingMiddleware object at 0xffff6c7acce0>
  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff6c0dd6c0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff6c0ec180>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff6c2b3bc0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffff6c2b3bf0>
  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff6c0dd6c0>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff6c0ec180>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
          │                            │    │    └ <starlette.requests.Request object at 0xffff6c0d5910>
          │                            │    └ <fastapi.routing.APIRouter object at 0xffff8fbdc5c0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff6c2b3bc0>
          └ <function wrap_app_handling_exceptions at 0xffff8fd07100>
  File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff6c0f3420>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff6c0ec180>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
          └ <fastapi.routing.APIRouter object at 0xffff8fbdc5c0>
  File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff6c0f3420>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff6c0ec180>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0xffff8fbdc5c0>>
          └ <fastapi.routing.APIRouter object at 0xffff8fbdc5c0>
  File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff6c0f3420>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff6c0ec180>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
          │     └ <function Route.handle at 0xffff8fbe45e0>
          └ APIRoute(path='/api/v1/agentic/classification', name='classify_evidence_endpoint', methods=['POST'])
  File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff6c0f3420>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff6c0ec180>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
          │    └ <function request_response.<locals>.app at 0xffff6c26bb00>
          └ APIRoute(path='/api/v1/agentic/classification', name='classify_evidence_endpoint', methods=['POST'])
  File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff6c0f3420>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff6c0ec180>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
          │                            │    └ <starlette.requests.Request object at 0xffff6c0d57c0>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0xffff6c0f3380>
          └ <function wrap_app_handling_exceptions at 0xffff8fd07100>
  File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff6c0f3240>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff6c0ec180>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('172.29.0.3', 8000), 'c...
          └ <function request_response.<locals>.app.<locals>.app at 0xffff6c0f3380>
  File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0xffff6c0d57c0>
                     └ <function get_request_handler.<locals>.app at 0xffff6c26b9c0>
  File "/app/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 327, in app
    content = await serialize_response(
                    └ <function serialize_response at 0xffff901ecfe0>
  File "/app/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 176, in serialize_response
    raise ResponseValidationError(
          └ <class 'fastapi.exceptions.ResponseValidationError'>

fastapi.exceptions.ResponseValidationError: 1 validation errors:
  {'type': 'missing', 'loc': ('response', 'data', 'results'), 'msg': 'Field required', 'input': RunResponse(content=Results(results=[EvidenceClassificationResult(file_url='https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710083427_发票.png', category_id='invoice', category_name='发票', confidence=0.9, reason='该文件包含典型的发票特征，如发票代码、发票号码、开票日期、金额合计等。可以根据这些信息以及图片中的布局和印章确认其分类为发票。'), EvidenceClassificationResult(file_url='https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710083430_银行卡.jpg', category_id='unknown', category_name='unknown', confidence=0.0, reason='知识库中没有找到关于银行卡的相关分类信息，因此无法准确分类。')]), content_type='Results', thinking=None, reasoning_content=None, messages=[Message(role='system', content='<your_role>\n你是一个证据分类专家，你的目标是接收一组证据并将它们按照知识库中的分类指南进行准确的分类\n</your_role>\n\n<instructions>\n- 在响应之前永远要查询你的知识库\n- 确保分类是知识库中的,永远不要自行创造分类\n- 若分类不在知识库中被匹对,那么`category_id`和`category_name`应该为`unknown`\n- 确保使用中文输出`reason`\n</instructions>', name=None, tool_call_id=None, tool_calls=None, audio=None, images=None, videos=None, files=None, audio_output=None, image_output=None, thinking=None, redacted_thinking=None, provider_data=None, citations=None, reasoning_content=None, tool_name=None, tool_args=None, tool_call_error=None, stop_after_tool_call=False, add_to_agent_memory=True, from_history=False, metrics=MessageMetrics(input_tokens=0, output_tokens=0, total_tokens=0, audio_tokens=0, input_audio_tokens=0, output_audio_tokens=0, cached_tokens=0, cache_write_tokens=0, reasoning_tokens=0, prompt_tokens=0, completion_tokens=0, prompt_tokens_details=None, completion_tokens_details=None, additional_metrics=None, time=None, time_to_first_token=None, timer=None), references=None, created_at=1752136471), Message(role='user', content='请对以下证据进行分类：\n1. file_url: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710083427_发票.png\n2. file_url: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710083430_银行卡.jpg', name=None, tool_call_id=None, tool_calls=None, audio=None, images=[Image(url='https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710083427_发票.png', filepath=None, content=None, format=None, detail=None, id=None), Image(url='https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710083430_银行卡.jpg', filepath=None, content=None, format=None, detail=None, id=None)], videos=None, files=None, audio_output=None, image_output=None, thinking=None, redacted_thinking=None, provider_data=None, citations=None, reasoning_content=None, tool_name=None, tool_args=None, tool_call_error=None, stop_after_tool_call=False, add_to_agent_memory=True, from_history=False, metrics=MessageMetrics(input_tokens=0, output_tokens=0, total_tokens=0, audio_tokens=0, input_audio_tokens=0, output_audio_tokens=0, cached_tokens=0, cache_write_tokens=0, reasoning_tokens=0, prompt_tokens=0, completion_tokens=0, prompt_tokens_details=None, completion_tokens_details=None, additional_metrics=None, time=None, time_to_first_token=None, timer=None), references=None, created_at=1752136471), Message(role='assistant', content='', name=None, tool_call_id=None, tool_calls=[{'id': 'call_pLZjJiCMcCyyN0b1AAR6TZuU', 'function': {'arguments': '{"query": "发票"}', 'name': 'search_knowledge_base'}, 'type': 'function'}, {'id': 'call_o3sV7QJ3Hmu0MEHZpH1107JU', 'function': {'arguments': '{"query": "银行卡"}', 'name': 'search_knowledge_base'}, 'type': 'function'}], audio=None, images=None, videos=None, files=None, audio_output=None, image_output=None, thinking=None, redacted_thinking=None, provider_data=None, citations=None, reasoning_content=None, tool_name=None, tool_args=None, tool_call_error=None, stop_after_tool_call=False, add_to_agent_memory=True, from_history=False, metrics=MessageMetrics(input_tokens=2249, output_tokens=49, total_tokens=2298, audio_tokens=0, input_audio_tokens=0, output_audio_tokens=0, cached_tokens=0, cache_write_tokens=0, reasoning_tokens=0, prompt_tokens=2249, completion_tokens=49, prompt_tokens_details={'audio_tokens': 0, 'cached_tokens': 0}, completion_tokens_details={'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, additional_metrics=None, time=17.483665216015652, time_to_first_token=None, timer=<agno.utils.timer.Timer object at 0xffff6c17ec60>), references=None, created_at=1752136471), Message(role='tool', content='[\n  {\n    "name": "invoice",\n    "meta_data": {},\n    "content": "---\\ncategory_id: invoice\\ncategory_name: 发票\\nversion: 1.0\\n---\\n\\n# 证据分类指南：发票 (Invoice)\\n\\n本文档用于指导AI模型识别和分类发票类证据。\\n\\n## 核心定义\\n发票是指在购销商品、提供或者接受服务以及从事其他经营活动中，开具、收取的收付款凭证。\\n\\n## 主要特征\\n\\n### 文本特征\\n- **必须包含的关键词**: \\"发票\\"、\\"发票代码\\"、\\"发票号码\\"、\\"开票日期\\"、\\"收款方\\"、\\"付款方\\"、\\"金额合计\\"。\\n- **格式化的数据**: \\n  - **发票代码**: 通常是一串10位或12位的数字。\\n  - **发票号码**: 通常是一串8位的数字。\\n  - **日期**: 格式通常为 `YYYY年MM月DD日`。\\n  - **金额**: 通常包含 `¥` 符号，并有明确的大写金额和小写金额栏目。\\n\\n### 视觉和布局特征\\n- **整体布局**: \\n  - **页眉**: 通常包含开票方的名称和Logo。\\n  - **主体**: 以表格形式呈现，包含商品名称、数量、单价、金额等列。\\n  - **页脚**: 包含开票人、收款人、复核人等信息。\\n- **特定视觉元素**:\\n  - **印章**: 通常在右下角或中间位置盖有红色的公司发票专用章。\\n  - **二维码**: 近年的电子发票在左上角或右上角通常有一个二维码区域。\\n\\n## 示例\\n\\n### 正面示例\\n- 一张包含“增值税普通发票”字样，有清晰表格和红色印章的图片。\\n- 一张从税务局官方软件开具的，带有二维码的电子发票PDF截图。\\n\\n### 负面示例 (易混淆项)\\n- **收据 (Receipt)**: 只包含“收据”或“收款收据”字样，缺少“发票代码”和“发票号码”。\\n- **采购单 (Purchase Order)**: 包含“采购单”或“订单”字样，用于订购商品，而非最终付款凭证。\\n- **送货单 (Delivery Note)**: 仅列出配送的商品清单，不含税额和总金额等关键财务信息。"\n  },\n  {\n    "name": "company_business",\n    "meta_data": {},\n    "content": "---\\ntitle: Company Business\\ncompany_name: 汇ss智能AI律师\\n---\\n\\n# 公司业务\\n汇ss是一家专业的法律服务机构，在债务纠纷领域有着非常丰富的经验和案例。\\n\\n# 收费模式\\n汇ss在用户的诉讼案件胜诉后才会收费，承诺先诉讼，后收款。费用为500元。"\n  },\n  {\n    "name": "company_business",\n    "meta_data": {},\n    "content": "---\\ntitle: Company Business\\ncompany_name: 汇法律智能AI律师\\n---\\n\\n# 公司业务\\n汇法律是一家专业的法律服务机构，在债务纠纷领域有着非常丰富的经验和案例。\\n\\n# 收费模式\\n汇法律在用户的诉讼案件胜诉后才会收费，承诺先诉讼，后收款。费用为500元。"\n  }\n]', name=None, tool_call_id='call_pLZjJiCMcCyyN0b1AAR6TZuU', tool_calls=None, audio=None, images=None, videos=None, files=None, audio_output=None, image_output=None, thinking=None, redacted_thinking=None, provider_data=None, citations=None, reasoning_content=None, tool_name='search_knowledge_base', tool_args={'query': '发票'}, tool_call_error=False, stop_after_tool_call=False, add_to_agent_memory=True, from_history=False, metrics=MessageMetrics(input_tokens=0, output_tokens=0, total_tokens=0, audio_tokens=0, input_audio_tokens=0, output_audio_tokens=0, cached_tokens=0, cache_write_tokens=0, reasoning_tokens=0, prompt_tokens=0, completion_tokens=0, prompt_tokens_details=None, completion_tokens_details=None, additional_metrics=None, time=1.3844615429989062, time_to_first_token=None, timer=None), references=None, created_at=1752136489), Message(role='tool', content='[\n  {\n    "name": "invoice",\n    "meta_data": {},\n    "content": "---\\ncategory_id: invoice\\ncategory_name: 发票\\nversion: 1.0\\n---\\n\\n# 证据分类指南：发票 (Invoice)\\n\\n本文档用于指导AI模型识别和分类发票类证据。\\n\\n## 核心定义\\n发票是指在购销商品、提供或者接受服务以及从事其他经营活动中，开具、收取的收付款凭证。\\n\\n## 主要特征\\n\\n### 文本特征\\n- **必须包含的关键词**: \\"发票\\"、\\"发票代码\\"、\\"发票号码\\"、\\"开票日期\\"、\\"收款方\\"、\\"付款方\\"、\\"金额合计\\"。\\n- **格式化的数据**: \\n  - **发票代码**: 通常是一串10位或12位的数字。\\n  - **发票号码**: 通常是一串8位的数字。\\n  - **日期**: 格式通常为 `YYYY年MM月DD日`。\\n  - **金额**: 通常包含 `¥` 符号，并有明确的大写金额和小写金额栏目。\\n\\n### 视觉和布局特征\\n- **整体布局**: \\n  - **页眉**: 通常包含开票方的名称和Logo。\\n  - **主体**: 以表格形式呈现，包含商品名称、数量、单价、金额等列。\\n  - **页脚**: 包含开票人、收款人、复核人等信息。\\n- **特定视觉元素**:\\n  - **印章**: 通常在右下角或中间位置盖有红色的公司发票专用章。\\n  - **二维码**: 近年的电子发票在左上角或右上角通常有一个二维码区域。\\n\\n## 示例\\n\\n### 正面示例\\n- 一张包含“增值税普通发票”字样，有清晰表格和红色印章的图片。\\n- 一张从税务局官方软件开具的，带有二维码的电子发票PDF截图。\\n\\n### 负面示例 (易混淆项)\\n- **收据 (Receipt)**: 只包含“收据”或“收款收据”字样，缺少“发票代码”和“发票号码”。\\n- **采购单 (Purchase Order)**: 包含“采购单”或“订单”字样，用于订购商品，而非最终付款凭证。\\n- **送货单 (Delivery Note)**: 仅列出配送的商品清单，不含税额和总金额等关键财务信息。"\n  },\n  {\n    "name": "company_business",\n    "meta_data": {},\n    "content": "---\\ntitle: Company Business\\ncompany_name: 汇法律智能AI律师\\n---\\n\\n# 公司业务\\n汇法律是一家专业的法律服务机构，在债务纠纷领域有着非常丰富的经验和案例。\\n\\n# 收费模式\\n汇法律在用户的诉讼案件胜诉后才会收费，承诺先诉讼，后收款。费用为500元。"\n  },\n  {\n    "name": "company_business",\n    "meta_data": {},\n    "content": "---\\ntitle: Company Business\\ncompany_name: 汇ss智能AI律师\\n---\\n\\n# 公司业务\\n汇ss是一家专业的法律服务机构，在债务纠纷领域有着非常丰富的经验和案例。\\n\\n# 收费模式\\n汇ss在用户的诉讼案件胜诉后才会收费，承诺先诉讼，后收款。费用为500元。"\n  }\n]', name=None, tool_call_id='call_o3sV7QJ3Hmu0MEHZpH1107JU', tool_calls=None, audio=None, images=None, videos=None, files=None, audio_output=None, image_output=None, thinking=None, redacted_thinking=None, provider_data=None, citations=None, reasoning_content=None, tool_name='search_knowledge_base', tool_args={'query': '银行卡'}, tool_call_error=False, stop_after_tool_call=False, add_to_agent_memory=True, from_history=False, metrics=MessageMetrics(input_tokens=0, output_tokens=0, total_tokens=0, audio_tokens=0, input_audio_tokens=0, output_audio_tokens=0, cached_tokens=0, cache_write_tokens=0, reasoning_tokens=0, prompt_tokens=0, completion_tokens=0, prompt_tokens_details=None, completion_tokens_details=None, additional_metrics=None, time=0.5287035829969682, time_to_first_token=None, timer=None), references=None, created_at=1752136490), Message(role='assistant', content='{"results":[{"category_id":"invoice","category_name":"发票","confidence":0.9,"file_url":"https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710083427_发票.png","reason":"该文件包含典型的发票特征，如发票代码、发票号码、开票日期、金额合计等。可以根据这些信息以及图片中的布局和印章确认其分类为发票。"},{"category_id":"unknown","category_name":"unknown","confidence":0,"file_url":"https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710083430_银行卡.jpg","reason":"知识库中没有找到关于银行卡的相关分类信息，因此无法准确分类。"}]}', name=None, tool_call_id=None, tool_calls=None, audio=None, images=None, videos=None, files=None, audio_output=None, image_output=None, thinking=None, redacted_thinking=None, provider_data=None, citations=None, reasoning_content=None, tool_name=None, tool_args=None, tool_call_error=None, stop_after_tool_call=False, add_to_agent_memory=True, from_history=False, metrics=MessageMetrics(input_tokens=7686, output_tokens=177, total_tokens=7863, audio_tokens=0, input_audio_tokens=0, output_audio_tokens=0, cached_tokens=0, cache_write_tokens=0, reasoning_tokens=0, prompt_tokens=7686, completion_tokens=177, prompt_tokens_details={'audio_tokens': 0, 'cached_tokens': 0}, completion_tokens_details={'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, additional_metrics=None, time=11.989050256001065, time_to_first_token=None, timer=<agno.utils.timer.Timer object at 0xffff6c56e840>), references=None, created_at=1752136490)], metrics={'input_tokens': [2249, 7686], 'output_tokens': [49, 177], 'total_tokens': [2298, 7863], 'audio_tokens': [0, 0], 'input_audio_tokens': [0, 0], 'output_audio_tokens': [0, 0], 'cached_tokens': [0, 0], 'cache_write_tokens': [0, 0], 'reasoning_tokens': [0, 0], 'prompt_tokens': [2249, 7686], 'completion_tokens': [49, 177], 'prompt_tokens_details': [{'audio_tokens': 0, 'cached_tokens': 0}, {'audio_tokens': 0, 'cached_tokens': 0}], 'completion_tokens_details': [{'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}], 'time': [17.483665216015652, 11.989050256001065]}, model='gpt-4o', model_provider='OpenAI', run_id='da167b9b-87b0-4e3f-94de-311a52093cfb', agent_id='f28bb33a-2dd2-486e-bcc6-9b668334258e', agent_name='证据分类专家', session_id='61eb2abe-013e-4b62-9656-8dfaca8be851', team_session_id=None, workflow_id=None, tools=[ToolExecution(tool_call_id='call_pLZjJiCMcCyyN0b1AAR6TZuU', tool_name='search_knowledge_base', tool_args={'query': '发票'}, tool_call_error=False, result='[\n  {\n    "name": "invoice",\n    "meta_data": {},\n    "content": "---\\ncategory_id: invoice\\ncategory_name: 发票\\nversion: 1.0\\n---\\n\\n# 证据分类指南：发票 (Invoice)\\n\\n本文档用于指导AI模型识别和分类发票类证据。\\n\\n## 核心定义\\n发票是指在购销商品、提供或者接受服务以及从事其他经营活动中，开具、收取的收付款凭证。\\n\\n## 主要特征\\n\\n### 文本特征\\n- **必须包含的关键词**: \\"发票\\"、\\"发票代码\\"、\\"发票号码\\"、\\"开票日期\\"、\\"收款方\\"、\\"付款方\\"、\\"金额合计\\"。\\n- **格式化的数据**: \\n  - **发票代码**: 通常是一串10位或12位的数字。\\n  - **发票号码**: 通常是一串8位的数字。\\n  - **日期**: 格式通常为 `YYYY年MM月DD日`。\\n  - **金额**: 通常包含 `¥` 符号，并有明确的大写金额和小写金额栏目。\\n\\n### 视觉和布局特征\\n- **整体布局**: \\n  - **页眉**: 通常包含开票方的名称和Logo。\\n  - **主体**: 以表格形式呈现，包含商品名称、数量、单价、金额等列。\\n  - **页脚**: 包含开票人、收款人、复核人等信息。\\n- **特定视觉元素**:\\n  - **印章**: 通常在右下角或中间位置盖有红色的公司发票专用章。\\n  - **二维码**: 近年的电子发票在左上角或右上角通常有一个二维码区域。\\n\\n## 示例\\n\\n### 正面示例\\n- 一张包含“增值税普通发票”字样，有清晰表格和红色印章的图片。\\n- 一张从税务局官方软件开具的，带有二维码的电子发票PDF截图。\\n\\n### 负面示例 (易混淆项)\\n- **收据 (Receipt)**: 只包含“收据”或“收款收据”字样，缺少“发票代码”和“发票号码”。\\n- **采购单 (Purchase Order)**: 包含“采购单”或“订单”字样，用于订购商品，而非最终付款凭证。\\n- **送货单 (Delivery Note)**: 仅列出配送的商品清单，不含税额和总金额等关键财务信息。"\n  },\n  {\n    "name": "company_business",\n    "meta_data": {},\n    "content": "---\\ntitle: Company Business\\ncompany_name: 汇ss智能AI律师\\n---\\n\\n# 公司业务\\n汇ss是一家专业的法律服务机构，在债务纠纷领域有着非常丰富的经验和案例。\\n\\n# 收费模式\\n汇ss在用户的诉讼案件胜诉后才会收费，承诺先诉讼，后收款。费用为500元。"\n  },\n  {\n    "name": "company_business",\n    "meta_data": {},\n    "content": "---\\ntitle: Company Business\\ncompany_name: 汇法律智能AI律师\\n---\\n\\n# 公司业务\\n汇法律是一家专业的法律服务机构，在债务纠纷领域有着非常丰富的经验和案例。\\n\\n# 收费模式\\n汇法律在用户的诉讼案件胜诉后才会收费，承诺先诉讼，后收款。费用为500元。"\n  }\n]', metrics=MessageMetrics(input_tokens=0, output_tokens=0, total_tokens=0, audio_tokens=0, input_audio_tokens=0, output_audio_tokens=0, cached_tokens=0, cache_write_tokens=0, reasoning_tokens=0, prompt_tokens=0, completion_tokens=0, prompt_tokens_details=None, completion_tokens_details=None, additional_metrics=None, time=1.3844615429989062, time_to_first_token=None, timer=None), stop_after_tool_call=False, created_at=1752136446, requires_confirmation=None, confirmed=None, confirmation_note=None, requires_user_input=None, user_input_schema=None, answered=None, external_execution_required=None), ToolExecution(tool_call_id='call_o3sV7QJ3Hmu0MEHZpH1107JU', tool_name='search_knowledge_base', tool_args={'query': '银行卡'}, tool_call_error=False, result='[\n  {\n    "name": "invoice",\n    "meta_data": {},\n    "content": "---\\ncategory_id: invoice\\ncategory_name: 发票\\nversion: 1.0\\n---\\n\\n# 证据分类指南：发票 (Invoice)\\n\\n本文档用于指导AI模型识别和分类发票类证据。\\n\\n## 核心定义\\n发票是指在购销商品、提供或者接受服务以及从事其他经营活动中，开具、收取的收付款凭证。\\n\\n## 主要特征\\n\\n### 文本特征\\n- **必须包含的关键词**: \\"发票\\"、\\"发票代码\\"、\\"发票号码\\"、\\"开票日期\\"、\\"收款方\\"、\\"付款方\\"、\\"金额合计\\"。\\n- **格式化的数据**: \\n  - **发票代码**: 通常是一串10位或12位的数字。\\n  - **发票号码**: 通常是一串8位的数字。\\n  - **日期**: 格式通常为 `YYYY年MM月DD日`。\\n  - **金额**: 通常包含 `¥` 符号，并有明确的大写金额和小写金额栏目。\\n\\n### 视觉和布局特征\\n- **整体布局**: \\n  - **页眉**: 通常包含开票方的名称和Logo。\\n  - **主体**: 以表格形式呈现，包含商品名称、数量、单价、金额等列。\\n  - **页脚**: 包含开票人、收款人、复核人等信息。\\n- **特定视觉元素**:\\n  - **印章**: 通常在右下角或中间位置盖有红色的公司发票专用章。\\n  - **二维码**: 近年的电子发票在左上角或右上角通常有一个二维码区域。\\n\\n## 示例\\n\\n### 正面示例\\n- 一张包含“增值税普通发票”字样，有清晰表格和红色印章的图片。\\n- 一张从税务局官方软件开具的，带有二维码的电子发票PDF截图。\\n\\n### 负面示例 (易混淆项)\\n- **收据 (Receipt)**: 只包含“收据”或“收款收据”字样，缺少“发票代码”和“发票号码”。\\n- **采购单 (Purchase Order)**: 包含“采购单”或“订单”字样，用于订购商品，而非最终付款凭证。\\n- **送货单 (Delivery Note)**: 仅列出配送的商品清单，不含税额和总金额等关键财务信息。"\n  },\n  {\n    "name": "company_business",\n    "meta_data": {},\n    "content": "---\\ntitle: Company Business\\ncompany_name: 汇法律智能AI律师\\n---\\n\\n# 公司业务\\n汇法律是一家专业的法律服务机构，在债务纠纷领域有着非常丰富的经验和案例。\\n\\n# 收费模式\\n汇法律在用户的诉讼案件胜诉后才会收费，承诺先诉讼，后收款。费用为500元。"\n  },\n  {\n    "name": "company_business",\n    "meta_data": {},\n    "content": "---\\ntitle: Company Business\\ncompany_name: 汇ss智能AI律师\\n---\\n\\n# 公司业务\\n汇ss是一家专业的法律服务机构，在债务纠纷领域有着非常丰富的经验和案例。\\n\\n# 收费模式\\n汇ss在用户的诉讼案件胜诉后才会收费，承诺先诉讼，后收款。费用为500元。"\n  }\n]', metrics=MessageMetrics(input_tokens=0, output_tokens=0, total_tokens=0, audio_tokens=0, input_audio_tokens=0, output_audio_tokens=0, cached_tokens=0, cache_write_tokens=0, reasoning_tokens=0, prompt_tokens=0, completion_tokens=0, prompt_tokens_details=None, completion_tokens_details=None, additional_metrics=None, time=0.5287035829969682, time_to_first_token=None, timer=None), stop_after_tool_call=False, created_at=1752136446, requires_confirmation=None, confirmed=None, confirmation_note=None, requires_user_input=None, user_input_schema=None, answered=None, external_execution_required=None)], formatted_tool_calls=['search_knowledge_base(query=发票)', 'search_knowledge_base(query=银行卡)'], images=None, videos=None, audio=None, response_audio=None, citations=None, extra_data=RunResponseExtraData(references=[MessageReferences(query='发票', references=[{'name': 'invoice', 'meta_data': {}, 'content': '---\ncategory_id: invoice\ncategory_name: 发票\nversion: 1.0\n---\n\n# 证据分类指南：发票 (Invoice)\n\n本文档用于指导AI模型识别和分类发票类证据。\n\n## 核心定义\n发票是指在购销商品、提供或者接受服务以及从事其他经营活动中，开具、收取的收付款凭证。\n\n## 主要特征\n\n### 文本特征\n- **必须包含的关键词**: "发票"、"发票代码"、"发票号码"、"开票日期"、"收款方"、"付款方"、"金额合计"。\n- **格式化的数据**: \n  - **发票代码**: 通常是一串10位或12位的数字。\n  - **发票号码**: 通常是一串8位的数字。\n  - **日期**: 格式通常为 `YYYY年MM月DD日`。\n  - **金额**: 通常包含 `¥` 符号，并有明确的大写金额和小写金额栏目。\n\n### 视觉和布局特征\n- **整体布局**: \n  - **页眉**: 通常包含开票方的名称和Logo。\n  - **主体**: 以表格形式呈现，包含商品名称、数量、单价、金额等列。\n  - **页脚**: 包含开票人、收款人、复核人等信息。\n- **特定视觉元素**:\n  - **印章**: 通常在右下角或中间位置盖有红色的公司发票专用章。\n  - **二维码**: 近年的电子发票在左上角或右上角通常有一个二维码区域。\n\n## 示例\n\n### 正面示例\n- 一张包含“增值税普通发票”字样，有清晰表格和红色印章的图片。\n- 一张从税务局官方软件开具的，带有二维码的电子发票PDF截图。\n\n### 负面示例 (易混淆项)\n- **收据 (Receipt)**: 只包含“收据”或“收款收据”字样，缺少“发票代码”和“发票号码”。\n- **采购单 (Purchase Order)**: 包含“采购单”或“订单”字样，用于订购商品，而非最终付款凭证。\n- **送货单 (Delivery Note)**: 仅列出配送的商品清单，不含税额和总金额等关键财务信息。'}, {'name': 'company_business', 'meta_data': {}, 'content': '---\ntitle: Company Business\ncompany_name: 汇ss智能AI律师\n---\n\n# 公司业务\n汇ss是一家专业的法律服务机构，在债务纠纷领域有着非常丰富的经验和案例。\n\n# 收费模式\n汇ss在用户的诉讼案件胜诉后才会收费，承诺先诉讼，后收款。费用为500元。'}, {'name': 'company_business', 'meta_data': {}, 'content': '---\ntitle: Company Business\ncompany_name: 汇法律智能AI律师\n---\n\n# 公司业务\n汇法律是一家专业的法律服务机构，在债务纠纷领域有着非常丰富的经验和案例。\n\n# 收费模式\n汇法律在用户的诉讼案件胜诉后才会收费，承诺先诉讼，后收款。费用为500元。'}], time=1.3798), MessageReferences(query='银行卡', references=[{'name': 'invoice', 'meta_data': {}, 'content': '---\ncategory_id: invoice\ncategory_name: 发票\nversion: 1.0\n---\n\n# 证据分类指南：发票 (Invoice)\n\n本文档用于指导AI模型识别和分类发票类证据。\n\n## 核心定义\n发票是指在购销商品、提供或者接受服务以及从事其他经营活动中，开具、收取的收付款凭证。\n\n## 主要特征\n\n### 文本特征\n- **必须包含的关键词**: "发票"、"发票代码"、"发票号码"、"开票日期"、"收款方"、"付款方"、"金额合计"。\n- **格式化的数据**: \n  - **发票代码**: 通常是一串10位或12位的数字。\n  - **发票号码**: 通常是一串8位的数字。\n  - **日期**: 格式通常为 `YYYY年MM月DD日`。\n  - **金额**: 通常包含 `¥` 符号，并有明确的大写金额和小写金额栏目。\n\n### 视觉和布局特征\n- **整体布局**: \n  - **页眉**: 通常包含开票方的名称和Logo。\n  - **主体**: 以表格形式呈现，包含商品名称、数量、单价、金额等列。\n  - **页脚**: 包含开票人、收款人、复核人等信息。\n- **特定视觉元素**:\n  - **印章**: 通常在右下角或中间位置盖有红色的公司发票专用章。\n  - **二维码**: 近年的电子发票在左上角或右上角通常有一个二维码区域。\n\n## 示例\n\n### 正面示例\n- 一张包含“增值税普通发票”字样，有清晰表格和红色印章的图片。\n- 一张从税务局官方软件开具的，带有二维码的电子发票PDF截图。\n\n### 负面示例 (易混淆项)\n- **收据 (Receipt)**: 只包含“收据”或“收款收据”字样，缺少“发票代码”和“发票号码”。\n- **采购单 (Purchase Order)**: 包含“采购单”或“订单”字样，用于订购商品，而非最终付款凭证。\n- **送货单 (Delivery Note)**: 仅列出配送的商品清单，不含税额和总金额等关键财务信息。'}, {'name': 'company_business', 'meta_data': {}, 'content': '---\ntitle: Company Business\ncompany_name: 汇法律智能AI律师\n---\n\n# 公司业务\n汇法律是一家专业的法律服务机构，在债务纠纷领域有着非常丰富的经验和案例。\n\n# 收费模式\n汇法律在用户的诉讼案件胜诉后才会收费，承诺先诉讼，后收款。费用为500元。'}, {'name': 'company_business', 'meta_data': {}, 'content': '---\ntitle: Company Business\ncompany_name: 汇ss智能AI律师\n---\n\n# 公司业务\n汇ss是一家专业的法律服务机构，在债务纠纷领域有着非常丰富的经验和案例。\n\n# 收费模式\n汇ss在用户的诉讼案件胜诉后才会收费，承诺先诉讼，后收款。费用为500元。'}], time=0.5274)], add_messages=None, reasoning_steps=None, reasoning_messages=None), created_at=1752136446, events=None, status=<RunStatus.running: 'RUNNING'>)}

2025-07-10 08:37:25 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/agentic/classification
2025-07-10 08:37:25 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 发票.png, 文件夹: images
2025-07-10 08:37:25 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 181542 字节
2025-07-10 08:37:25 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250710083725_发票.png
2025-07-10 08:37:25 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250710083725_发票.png
2025-07-10 08:37:25 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250710083725_发票.png, disposition=inline
2025-07-10 08:37:27 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250710083725_发票.png
2025-07-10 08:37:27 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710083725_发票.png
2025-07-10 08:37:27 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 银行卡.jpg, 文件夹: images
2025-07-10 08:37:27 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 488408 字节
2025-07-10 08:37:27 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250710083727_银行卡.jpg
2025-07-10 08:37:27 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250710083727_银行卡.jpg
2025-07-10 08:37:27 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250710083727_银行卡.jpg, disposition=inline
2025-07-10 08:37:28 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250710083727_银行卡.jpg
2025-07-10 08:37:28 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710083727_银行卡.jpg
2025-07-10 08:37:59 | INFO | app.core.middleware:dispatch:62 - 完成请求: POST http://localhost:8000/api/v1/agentic/classification - 状态码: 200 - 耗时: 34.0161秒
2025-07-10 09:24:29 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/agentic/classification
2025-07-10 09:24:29 | ERROR | app.core.middleware:http_exception_handler:12 - HTTPException: 无法验证凭据 - POST /api/v1/agentic/classification
2025-07-10 09:24:29 | INFO | app.core.middleware:dispatch:62 - 完成请求: POST http://localhost:8000/api/v1/agentic/classification - 状态码: 401 - 耗时: 0.0916秒
2025-07-10 09:29:18 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/agentic/classification
2025-07-10 09:29:18 | ERROR | app.core.middleware:http_exception_handler:12 - HTTPException: 无法验证凭据 - POST /api/v1/agentic/classification
2025-07-10 09:29:18 | INFO | app.core.middleware:dispatch:62 - 完成请求: POST http://localhost:8000/api/v1/agentic/classification - 状态码: 401 - 耗时: 0.2548秒
2025-07-10 09:29:40 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/agentic/classification
2025-07-10 09:29:40 | ERROR | app.core.middleware:http_exception_handler:12 - HTTPException: 无法验证凭据 - POST /api/v1/agentic/classification
2025-07-10 09:29:40 | INFO | app.core.middleware:dispatch:62 - 完成请求: POST http://localhost:8000/api/v1/agentic/classification - 状态码: 401 - 耗时: 0.4961秒
2025-07-10 09:29:52 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/login/access-token
2025-07-10 09:29:54 | INFO | app.core.middleware:dispatch:62 - 完成请求: POST http://localhost:8000/api/v1/login/access-token - 状态码: 200 - 耗时: 2.1116秒
2025-07-10 09:29:59 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/api/v1/staffs/me
2025-07-10 09:29:59 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/api/v1/staffs/me - 状态码: 200 - 耗时: 0.4250秒
2025-07-10 09:30:11 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/agentic/classification
2025-07-10 09:30:11 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 发票.png, 文件夹: images
2025-07-10 09:30:11 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 181542 字节
2025-07-10 09:30:11 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250710093011_发票.png
2025-07-10 09:30:11 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250710093011_发票.png
2025-07-10 09:30:11 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250710093011_发票.png, disposition=inline
2025-07-10 09:30:14 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250710093011_发票.png
2025-07-10 09:30:14 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710093011_发票.png
2025-07-10 09:30:14 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 银行卡.jpg, 文件夹: images
2025-07-10 09:30:14 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 488408 字节
2025-07-10 09:30:14 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250710093014_银行卡.jpg
2025-07-10 09:30:14 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250710093014_银行卡.jpg
2025-07-10 09:30:14 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250710093014_银行卡.jpg, disposition=inline
2025-07-10 09:30:15 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250710093014_银行卡.jpg
2025-07-10 09:30:15 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710093014_银行卡.jpg
2025-07-10 09:30:15 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 营业执照.png, 文件夹: images
2025-07-10 09:30:15 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 369499 字节
2025-07-10 09:30:15 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250710093015_营业执照.png
2025-07-10 09:30:15 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250710093015_营业执照.png
2025-07-10 09:30:15 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250710093015_营业执照.png, disposition=inline
2025-07-10 09:30:16 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250710093015_营业执照.png
2025-07-10 09:30:16 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710093015_营业执照.png
2025-07-10 09:31:10 | INFO | app.core.middleware:dispatch:62 - 完成请求: POST http://localhost:8000/api/v1/agentic/classification - 状态码: 200 - 耗时: 58.6635秒
2025-07-10 09:39:56 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/agentic/classification
2025-07-10 09:39:56 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 发票.png, 文件夹: images
2025-07-10 09:39:56 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 181542 字节
2025-07-10 09:39:56 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250710093956_发票.png
2025-07-10 09:39:56 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250710093956_发票.png
2025-07-10 09:39:56 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250710093956_发票.png, disposition=inline
2025-07-10 09:39:59 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250710093956_发票.png
2025-07-10 09:39:59 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710093956_发票.png
2025-07-10 09:39:59 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 银行卡.jpg, 文件夹: images
2025-07-10 09:39:59 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 488408 字节
2025-07-10 09:39:59 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250710093959_银行卡.jpg
2025-07-10 09:39:59 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250710093959_银行卡.jpg
2025-07-10 09:39:59 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250710093959_银行卡.jpg, disposition=inline
2025-07-10 09:40:00 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250710093959_银行卡.jpg
2025-07-10 09:40:00 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710093959_银行卡.jpg
2025-07-10 09:40:00 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 营业执照.png, 文件夹: images
2025-07-10 09:40:00 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 369499 字节
2025-07-10 09:40:00 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250710094000_营业执照.png
2025-07-10 09:40:00 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250710094000_营业执照.png
2025-07-10 09:40:00 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250710094000_营业执照.png, disposition=inline
2025-07-10 09:40:02 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250710094000_营业执照.png
2025-07-10 09:40:02 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710094000_营业执照.png
2025-07-10 09:40:55 | INFO | app.core.middleware:dispatch:62 - 完成请求: POST http://localhost:8000/api/v1/agentic/classification - 状态码: 200 - 耗时: 59.3158秒
2025-07-10 09:42:00 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/agentic/classification
2025-07-10 09:42:00 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 1.jpg, 文件夹: images
2025-07-10 09:42:00 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 5558278 字节
2025-07-10 09:42:00 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250710094200_1.jpg
2025-07-10 09:42:00 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250710094200_1.jpg
2025-07-10 09:42:00 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250710094200_1.jpg, disposition=inline
2025-07-10 09:42:06 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250710094200_1.jpg
2025-07-10 09:42:06 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710094200_1.jpg
2025-07-10 09:42:07 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 2.png, 文件夹: images
2025-07-10 09:42:07 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 814248 字节
2025-07-10 09:42:07 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250710094207_2.png
2025-07-10 09:42:07 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250710094207_2.png
2025-07-10 09:42:07 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250710094207_2.png, disposition=inline
2025-07-10 09:42:08 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250710094207_2.png
2025-07-10 09:42:08 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710094207_2.png
2025-07-10 09:42:08 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 3.png, 文件夹: images
2025-07-10 09:42:08 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 603343 字节
2025-07-10 09:42:08 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250710094208_3.png
2025-07-10 09:42:08 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250710094208_3.png
2025-07-10 09:42:08 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250710094208_3.png, disposition=inline
2025-07-10 09:42:09 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250710094208_3.png
2025-07-10 09:42:09 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710094208_3.png
2025-07-10 09:43:06 | INFO | app.core.middleware:dispatch:62 - 完成请求: POST http://localhost:8000/api/v1/agentic/classification - 状态码: 200 - 耗时: 66.6987秒
2025-07-10 10:32:07 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/agentic/classification
2025-07-10 10:32:08 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 1.jpg, 文件夹: images
2025-07-10 10:32:08 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 5558278 字节
2025-07-10 10:32:08 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250710103208_1.jpg
2025-07-10 10:32:08 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250710103208_1.jpg
2025-07-10 10:32:08 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250710103208_1.jpg, disposition=inline
2025-07-10 10:32:12 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250710103208_1.jpg
2025-07-10 10:32:12 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710103208_1.jpg
2025-07-10 10:32:12 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 2.png, 文件夹: images
2025-07-10 10:32:12 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 814248 字节
2025-07-10 10:32:12 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250710103212_2.png
2025-07-10 10:32:12 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250710103212_2.png
2025-07-10 10:32:12 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250710103212_2.png, disposition=inline
2025-07-10 10:32:13 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250710103212_2.png
2025-07-10 10:32:13 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710103212_2.png
2025-07-10 10:32:13 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 3.png, 文件夹: images
2025-07-10 10:32:13 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 603343 字节
2025-07-10 10:32:13 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250710103213_3.png
2025-07-10 10:32:13 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250710103213_3.png
2025-07-10 10:32:13 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250710103213_3.png, disposition=inline
2025-07-10 10:32:13 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250710103213_3.png
2025-07-10 10:32:13 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250710103213_3.png
2025-07-10 10:33:11 | INFO | app.core.middleware:dispatch:62 - 完成请求: POST http://localhost:8000/api/v1/agentic/classification - 状态码: 200 - 耗时: 63.6531秒
