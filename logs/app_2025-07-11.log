2025-07-11 07:23:42 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/evidences/batch
2025-07-11 07:23:43 | ERROR | app.core.middleware:http_exception_handler:12 - HTTPException: 无法验证凭据 - POST /api/v1/evidences/batch
2025-07-11 07:23:43 | INFO | app.core.middleware:dispatch:62 - 完成请求: POST http://localhost:8000/api/v1/evidences/batch - 状态码: 401 - 耗时: 0.5706秒
2025-07-11 07:23:47 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/login/access-token
2025-07-11 07:23:48 | INFO | app.core.middleware:dispatch:62 - 完成请求: POST http://localhost:8000/api/v1/login/access-token - 状态码: 200 - 耗时: 0.6358秒
2025-07-11 07:23:51 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/evidences/batch
2025-07-11 07:23:51 | ERROR | app.core.middleware:http_exception_handler:12 - HTTPException: 无法验证凭据 - POST /api/v1/evidences/batch
2025-07-11 07:23:51 | INFO | app.core.middleware:dispatch:62 - 完成请求: POST http://localhost:8000/api/v1/evidences/batch - 状态码: 401 - 耗时: 0.1613秒
2025-07-11 07:24:01 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/api/v1/staffs/me
2025-07-11 07:24:01 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/api/v1/staffs/me - 状态码: 200 - 耗时: 0.5105秒
2025-07-11 07:24:14 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/evidences/batch
2025-07-11 07:24:14 | INFO | app.evidences.routers:batch_create_evidences:106 - 接收批量创建证据请求: 案件ID=1, 文件数量=3
2025-07-11 07:24:14 | DEBUG | app.evidences.routers:batch_create_evidences:117 - 文件1: 名称=1.jpg, 内容类型=image/jpeg, 大小=5558278
2025-07-11 07:24:14 | DEBUG | app.evidences.routers:batch_create_evidences:117 - 文件2: 名称=2.png, 内容类型=image/png, 大小=814248
2025-07-11 07:24:14 | DEBUG | app.evidences.routers:batch_create_evidences:117 - 文件3: 名称=3.png, 内容类型=image/png, 大小=603343
2025-07-11 07:24:14 | DEBUG | app.evidences.routers:batch_create_evidences:143 - 案件存在: ID=1, 名称=李磊vs小米
2025-07-11 07:24:14 | INFO | app.evidences.routers:batch_create_evidences:147 - 开始批量创建证据: 案件ID=1, 文件数量=3
2025-07-11 07:24:14 | INFO | app.evidences.services:batch_create:223 - 开始批量创建证据: 案件ID=1, 文件数量=3
2025-07-11 07:24:14 | DEBUG | app.evidences.services:batch_create:228 - 处理第1个文件: 1.jpg, 大小: 5558278
2025-07-11 07:24:14 | DEBUG | app.evidences.services:upload_file:37 - 开始上传文件: 1.jpg
2025-07-11 07:24:14 | DEBUG | app.evidences.services:upload_file:42 - 文件扩展名: jpg
2025-07-11 07:24:14 | DEBUG | app.evidences.services:upload_file:55 - 存储文件夹: images
2025-07-11 07:24:14 | DEBUG | app.evidences.services:upload_file:61 - 文件大小: 5558278 字节
2025-07-11 07:24:14 | DEBUG | app.evidences.services:upload_file:72 - 开始上传文件到COS: 1.jpg, disposition=inline
2025-07-11 07:24:14 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 1.jpg, 文件夹: images
2025-07-11 07:24:14 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 5558278 字节
2025-07-11 07:24:14 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250711072414_1.jpg
2025-07-11 07:24:14 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250711072414_1.jpg
2025-07-11 07:24:14 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250711072414_1.jpg, disposition=inline
2025-07-11 07:24:15 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250711072414_1.jpg
2025-07-11 07:24:15 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250711072414_1.jpg
2025-07-11 07:24:15 | DEBUG | app.evidences.services:upload_file:74 - 文件上传成功: 1.jpg, URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250711072414_1.jpg
2025-07-11 07:24:15 | DEBUG | app.evidences.services:batch_create:232 - 文件上传成功: 1.jpg, URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250711072414_1.jpg
2025-07-11 07:24:15 | DEBUG | app.evidences.services:batch_create:246 - 证据对象创建成功: 1.jpg
2025-07-11 07:24:15 | DEBUG | app.evidences.services:batch_create:228 - 处理第2个文件: 2.png, 大小: 814248
2025-07-11 07:24:15 | DEBUG | app.evidences.services:upload_file:37 - 开始上传文件: 2.png
2025-07-11 07:24:15 | DEBUG | app.evidences.services:upload_file:42 - 文件扩展名: png
2025-07-11 07:24:15 | DEBUG | app.evidences.services:upload_file:55 - 存储文件夹: images
2025-07-11 07:24:15 | DEBUG | app.evidences.services:upload_file:61 - 文件大小: 814248 字节
2025-07-11 07:24:15 | DEBUG | app.evidences.services:upload_file:72 - 开始上传文件到COS: 2.png, disposition=inline
2025-07-11 07:24:15 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 2.png, 文件夹: images
2025-07-11 07:24:15 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 814248 字节
2025-07-11 07:24:15 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250711072415_2.png
2025-07-11 07:24:15 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250711072415_2.png
2025-07-11 07:24:15 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250711072415_2.png, disposition=inline
2025-07-11 07:24:15 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250711072415_2.png
2025-07-11 07:24:15 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250711072415_2.png
2025-07-11 07:24:15 | DEBUG | app.evidences.services:upload_file:74 - 文件上传成功: 2.png, URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250711072415_2.png
2025-07-11 07:24:15 | DEBUG | app.evidences.services:batch_create:232 - 文件上传成功: 2.png, URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250711072415_2.png
2025-07-11 07:24:15 | DEBUG | app.evidences.services:batch_create:246 - 证据对象创建成功: 2.png
2025-07-11 07:24:15 | DEBUG | app.evidences.services:batch_create:228 - 处理第3个文件: 3.png, 大小: 603343
2025-07-11 07:24:15 | DEBUG | app.evidences.services:upload_file:37 - 开始上传文件: 3.png
2025-07-11 07:24:15 | DEBUG | app.evidences.services:upload_file:42 - 文件扩展名: png
2025-07-11 07:24:15 | DEBUG | app.evidences.services:upload_file:55 - 存储文件夹: images
2025-07-11 07:24:15 | DEBUG | app.evidences.services:upload_file:61 - 文件大小: 603343 字节
2025-07-11 07:24:15 | DEBUG | app.evidences.services:upload_file:72 - 开始上传文件到COS: 3.png, disposition=inline
2025-07-11 07:24:15 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 3.png, 文件夹: images
2025-07-11 07:24:15 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 603343 字节
2025-07-11 07:24:15 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250711072415_3.png
2025-07-11 07:24:15 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250711072415_3.png
2025-07-11 07:24:15 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250711072415_3.png, disposition=inline
2025-07-11 07:24:15 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250711072415_3.png
2025-07-11 07:24:15 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250711072415_3.png
2025-07-11 07:24:15 | DEBUG | app.evidences.services:upload_file:74 - 文件上传成功: 3.png, URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250711072415_3.png
2025-07-11 07:24:15 | DEBUG | app.evidences.services:batch_create:232 - 文件上传成功: 3.png, URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250711072415_3.png
2025-07-11 07:24:15 | DEBUG | app.evidences.services:batch_create:246 - 证据对象创建成功: 3.png
2025-07-11 07:24:15 | INFO | app.evidences.services:batch_create:258 - 成功提交3个证据到数据库
2025-07-11 07:24:15 | INFO | app.evidences.routers:batch_create_evidences:186 - 批量创建证据成功: 成功数量=3
2025-07-11 07:24:15 | INFO | app.core.middleware:dispatch:62 - 完成请求: POST http://localhost:8000/api/v1/evidences/batch - 状态码: 201 - 耗时: 1.7883秒
2025-07-11 07:52:29 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/agentic/classification
2025-07-11 07:52:29 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 1.jpg, 文件夹: images
2025-07-11 07:52:29 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 5558278 字节
2025-07-11 07:52:29 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250711075229_1.jpg
2025-07-11 07:52:29 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250711075229_1.jpg
2025-07-11 07:52:29 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250711075229_1.jpg, disposition=inline
2025-07-11 07:52:30 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250711075229_1.jpg
2025-07-11 07:52:30 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250711075229_1.jpg
2025-07-11 07:52:30 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 2.png, 文件夹: images
2025-07-11 07:52:30 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 814248 字节
2025-07-11 07:52:30 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250711075230_2.png
2025-07-11 07:52:30 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250711075230_2.png
2025-07-11 07:52:30 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250711075230_2.png, disposition=inline
2025-07-11 07:52:30 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250711075230_2.png
2025-07-11 07:52:30 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250711075230_2.png
2025-07-11 07:52:30 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 3.png, 文件夹: images
2025-07-11 07:52:30 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 603343 字节
2025-07-11 07:52:30 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250711075230_3.png
2025-07-11 07:52:30 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250711075230_3.png
2025-07-11 07:52:30 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250711075230_3.png, disposition=inline
2025-07-11 07:52:30 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250711075230_3.png
2025-07-11 07:52:30 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250711075230_3.png
2025-07-11 07:53:06 | INFO | app.core.middleware:dispatch:62 - 完成请求: POST http://localhost:8000/api/v1/agentic/classification - 状态码: 200 - 耗时: 36.7312秒
2025-07-11 07:54:22 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/agentic/classification
2025-07-11 07:54:23 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 4.jpg, 文件夹: images
2025-07-11 07:54:23 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 474010 字节
2025-07-11 07:54:23 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250711075423_4.jpg
2025-07-11 07:54:23 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250711075423_4.jpg
2025-07-11 07:54:23 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250711075423_4.jpg, disposition=inline
2025-07-11 07:54:23 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250711075423_4.jpg
2025-07-11 07:54:23 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250711075423_4.jpg
2025-07-11 07:54:23 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 5.jpg, 文件夹: images
2025-07-11 07:54:23 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 195296 字节
2025-07-11 07:54:23 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250711075423_5.jpg
2025-07-11 07:54:23 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250711075423_5.jpg
2025-07-11 07:54:23 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250711075423_5.jpg, disposition=inline
2025-07-11 07:54:24 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250711075423_5.jpg
2025-07-11 07:54:24 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250711075423_5.jpg
2025-07-11 07:54:47 | INFO | app.core.middleware:dispatch:62 - 完成请求: POST http://localhost:8000/api/v1/agentic/classification - 状态码: 200 - 耗时: 24.7779秒
2025-07-11 07:55:39 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/agentic/classification
2025-07-11 07:55:39 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 4.jpg, 文件夹: images
2025-07-11 07:55:39 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 474010 字节
2025-07-11 07:55:39 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250711075539_4.jpg
2025-07-11 07:55:39 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250711075539_4.jpg
2025-07-11 07:55:39 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250711075539_4.jpg, disposition=inline
2025-07-11 07:55:39 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250711075539_4.jpg
2025-07-11 07:55:39 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250711075539_4.jpg
2025-07-11 07:55:39 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 5.jpg, 文件夹: images
2025-07-11 07:55:39 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 195296 字节
2025-07-11 07:55:39 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250711075539_5.jpg
2025-07-11 07:55:39 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250711075539_5.jpg
2025-07-11 07:55:39 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250711075539_5.jpg, disposition=inline
2025-07-11 07:55:39 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250711075539_5.jpg
2025-07-11 07:55:39 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250711075539_5.jpg
2025-07-11 07:55:59 | INFO | app.core.middleware:dispatch:62 - 完成请求: POST http://localhost:8000/api/v1/agentic/classification - 状态码: 200 - 耗时: 20.8016秒
2025-07-11 07:56:43 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/agentic/classification
2025-07-11 07:56:44 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 4.jpg, 文件夹: images
2025-07-11 07:56:44 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 474010 字节
2025-07-11 07:56:44 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250711075644_4.jpg
2025-07-11 07:56:44 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250711075644_4.jpg
2025-07-11 07:56:44 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250711075644_4.jpg, disposition=inline
2025-07-11 07:56:44 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250711075644_4.jpg
2025-07-11 07:56:44 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250711075644_4.jpg
2025-07-11 07:56:57 | INFO | app.core.middleware:dispatch:62 - 完成请求: POST http://localhost:8000/api/v1/agentic/classification - 状态码: 200 - 耗时: 14.0844秒
2025-07-11 07:57:10 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/agentic/classification
2025-07-11 07:57:10 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 4.jpg, 文件夹: images
2025-07-11 07:57:10 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 474010 字节
2025-07-11 07:57:10 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250711075710_4.jpg
2025-07-11 07:57:10 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250711075710_4.jpg
2025-07-11 07:57:10 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250711075710_4.jpg, disposition=inline
2025-07-11 07:57:10 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250711075710_4.jpg
2025-07-11 07:57:10 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250711075710_4.jpg
2025-07-11 07:57:10 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 5.jpg, 文件夹: images
2025-07-11 07:57:10 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 195296 字节
2025-07-11 07:57:10 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250711075710_5.jpg
2025-07-11 07:57:10 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250711075710_5.jpg
2025-07-11 07:57:10 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250711075710_5.jpg, disposition=inline
2025-07-11 07:57:10 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250711075710_5.jpg
2025-07-11 07:57:10 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250711075710_5.jpg
2025-07-11 07:57:28 | INFO | app.core.middleware:dispatch:62 - 完成请求: POST http://localhost:8000/api/v1/agentic/classification - 状态码: 200 - 耗时: 18.3662秒
2025-07-11 08:59:11 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/agentic/classification
2025-07-11 08:59:12 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 发票.png, 文件夹: images
2025-07-11 08:59:12 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 181542 字节
2025-07-11 08:59:12 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250711085912_发票.png
2025-07-11 08:59:12 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250711085912_发票.png
2025-07-11 08:59:12 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250711085912_发票.png, disposition=inline
2025-07-11 08:59:13 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250711085912_发票.png
2025-07-11 08:59:13 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250711085912_发票.png
2025-07-11 08:59:13 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: kefu.png, 文件夹: images
2025-07-11 08:59:13 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 173268 字节
2025-07-11 08:59:13 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250711085913_kefu.png
2025-07-11 08:59:13 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250711085913_kefu.png
2025-07-11 08:59:13 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250711085913_kefu.png, disposition=inline
2025-07-11 08:59:13 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250711085913_kefu.png
2025-07-11 08:59:13 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250711085913_kefu.png
2025-07-11 08:59:37 | INFO | app.core.middleware:dispatch:62 - 完成请求: POST http://localhost:8000/api/v1/agentic/classification - 状态码: 200 - 耗时: 25.8542秒
2025-07-11 09:01:10 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/agentic/classification
2025-07-11 09:01:10 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 1 (1).jpg, 文件夹: images
2025-07-11 09:01:10 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 601101 字节
2025-07-11 09:01:10 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250711090110_1 (1).jpg
2025-07-11 09:01:10 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250711090110_1 (1).jpg
2025-07-11 09:01:10 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250711090110_1 (1).jpg, disposition=inline
2025-07-11 09:01:11 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250711090110_1 (1).jpg
2025-07-11 09:01:11 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250711090110_1 (1).jpg
2025-07-11 09:01:11 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 90bbd8dd-1953-426f-abd5-deddf85e8c12.jpg, 文件夹: images
2025-07-11 09:01:11 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 164557 字节
2025-07-11 09:01:11 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250711090111_90bbd8dd-1953-426f-abd5-deddf85e8c12.jpg
2025-07-11 09:01:11 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250711090111_90bbd8dd-1953-426f-abd5-deddf85e8c12.jpg
2025-07-11 09:01:11 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250711090111_90bbd8dd-1953-426f-abd5-deddf85e8c12.jpg, disposition=inline
2025-07-11 09:01:11 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250711090111_90bbd8dd-1953-426f-abd5-deddf85e8c12.jpg
2025-07-11 09:01:11 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250711090111_90bbd8dd-1953-426f-abd5-deddf85e8c12.jpg
2025-07-11 09:01:36 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/agentic/classification
2025-07-11 09:01:36 | INFO | app.core.middleware:dispatch:62 - 完成请求: POST http://localhost:8000/api/v1/agentic/classification - 状态码: 200 - 耗时: 26.1716秒
2025-07-11 09:01:36 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 发票.png, 文件夹: images
2025-07-11 09:01:36 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 181542 字节
2025-07-11 09:01:36 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250711090136_发票.png
2025-07-11 09:01:36 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250711090136_发票.png
2025-07-11 09:01:36 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250711090136_发票.png, disposition=inline
2025-07-11 09:01:36 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250711090136_发票.png
2025-07-11 09:01:36 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250711090136_发票.png
2025-07-11 09:01:36 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: kefu.png, 文件夹: images
2025-07-11 09:01:36 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 173268 字节
2025-07-11 09:01:36 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250711090136_kefu.png
2025-07-11 09:01:36 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250711090136_kefu.png
2025-07-11 09:01:36 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250711090136_kefu.png, disposition=inline
2025-07-11 09:01:37 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250711090136_kefu.png
2025-07-11 09:01:37 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250711090136_kefu.png
2025-07-11 09:01:58 | INFO | app.core.middleware:dispatch:62 - 完成请求: POST http://localhost:8000/api/v1/agentic/classification - 状态码: 200 - 耗时: 21.8540秒
2025-07-11 09:03:52 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/agentic/classification
2025-07-11 09:03:53 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 发票.png, 文件夹: images
2025-07-11 09:03:53 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 181542 字节
2025-07-11 09:03:53 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250711090353_发票.png
2025-07-11 09:03:53 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250711090353_发票.png
2025-07-11 09:03:53 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250711090353_发票.png, disposition=inline
2025-07-11 09:03:53 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250711090353_发票.png
2025-07-11 09:03:53 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250711090353_发票.png
2025-07-11 09:03:53 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: kefu.png, 文件夹: images
2025-07-11 09:03:53 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 173268 字节
2025-07-11 09:03:53 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250711090353_kefu.png
2025-07-11 09:03:53 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250711090353_kefu.png
2025-07-11 09:03:53 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250711090353_kefu.png, disposition=inline
2025-07-11 09:03:53 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250711090353_kefu.png
2025-07-11 09:03:53 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250711090353_kefu.png
2025-07-11 09:03:57 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/agentic/classification
2025-07-11 09:03:57 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 1 (1).jpg, 文件夹: images
2025-07-11 09:03:57 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 601101 字节
2025-07-11 09:03:57 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250711090357_1 (1).jpg
2025-07-11 09:03:57 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250711090357_1 (1).jpg
2025-07-11 09:03:57 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250711090357_1 (1).jpg, disposition=inline
2025-07-11 09:03:57 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250711090357_1 (1).jpg
2025-07-11 09:03:57 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250711090357_1 (1).jpg
2025-07-11 09:03:57 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 90bbd8dd-1953-426f-abd5-deddf85e8c12.jpg, 文件夹: images
2025-07-11 09:03:57 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 164557 字节
2025-07-11 09:03:57 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250711090357_90bbd8dd-1953-426f-abd5-deddf85e8c12.jpg
2025-07-11 09:03:57 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250711090357_90bbd8dd-1953-426f-abd5-deddf85e8c12.jpg
2025-07-11 09:03:57 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250711090357_90bbd8dd-1953-426f-abd5-deddf85e8c12.jpg, disposition=inline
2025-07-11 09:03:57 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250711090357_90bbd8dd-1953-426f-abd5-deddf85e8c12.jpg
2025-07-11 09:03:57 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250711090357_90bbd8dd-1953-426f-abd5-deddf85e8c12.jpg
2025-07-11 09:04:14 | INFO | app.core.middleware:dispatch:62 - 完成请求: POST http://localhost:8000/api/v1/agentic/classification - 状态码: 200 - 耗时: 21.6727秒
2025-07-11 09:04:19 | INFO | app.core.middleware:dispatch:62 - 完成请求: POST http://localhost:8000/api/v1/agentic/classification - 状态码: 200 - 耗时: 22.7110秒
2025-07-11 09:19:11 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/agentic/classification
2025-07-11 09:19:11 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 微信截图_20240527214324.png, 文件夹: images
2025-07-11 09:19:11 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 374958 字节
2025-07-11 09:19:11 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250711091911_微信截图_20240527214324.png
2025-07-11 09:19:11 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250711091911_微信截图_20240527214324.png
2025-07-11 09:19:11 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250711091911_微信截图_20240527214324.png, disposition=inline
2025-07-11 09:19:13 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250711091911_微信截图_20240527214324.png
2025-07-11 09:19:13 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250711091911_微信截图_20240527214324.png
2025-07-11 09:19:13 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/agentic/classification
2025-07-11 09:19:13 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 借条.png, 文件夹: images
2025-07-11 09:19:13 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 302845 字节
2025-07-11 09:19:13 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250711091913_借条.png
2025-07-11 09:19:13 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250711091913_借条.png
2025-07-11 09:19:13 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250711091913_借条.png, disposition=inline
2025-07-11 09:19:13 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250711091913_借条.png
2025-07-11 09:19:13 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250711091913_借条.png
2025-07-11 09:19:29 | INFO | app.core.middleware:dispatch:62 - 完成请求: POST http://localhost:8000/api/v1/agentic/classification - 状态码: 200 - 耗时: 18.2875秒
2025-07-11 09:19:30 | INFO | app.core.middleware:dispatch:62 - 完成请求: POST http://localhost:8000/api/v1/agentic/classification - 状态码: 200 - 耗时: 17.2555秒
2025-07-11 09:23:35 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/agentic/classification
2025-07-11 09:23:35 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 发票.png, 文件夹: images
2025-07-11 09:23:35 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 181542 字节
2025-07-11 09:23:35 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250711092335_发票.png
2025-07-11 09:23:35 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250711092335_发票.png
2025-07-11 09:23:35 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250711092335_发票.png, disposition=inline
2025-07-11 09:23:36 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250711092335_发票.png
2025-07-11 09:23:36 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250711092335_发票.png
2025-07-11 09:23:36 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 身份证正面.png, 文件夹: images
2025-07-11 09:23:36 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 347913 字节
2025-07-11 09:23:36 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250711092336_身份证正面.png
2025-07-11 09:23:36 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250711092336_身份证正面.png
2025-07-11 09:23:36 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250711092336_身份证正面.png, disposition=inline
2025-07-11 09:23:36 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250711092336_身份证正面.png
2025-07-11 09:23:36 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250711092336_身份证正面.png
2025-07-11 09:23:36 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 银行卡.jpg, 文件夹: images
2025-07-11 09:23:36 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 488408 字节
2025-07-11 09:23:36 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250711092336_银行卡.jpg
2025-07-11 09:23:36 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250711092336_银行卡.jpg
2025-07-11 09:23:36 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250711092336_银行卡.jpg, disposition=inline
2025-07-11 09:23:36 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250711092336_银行卡.jpg
2025-07-11 09:23:36 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250711092336_银行卡.jpg
2025-07-11 09:24:18 | INFO | app.core.middleware:dispatch:62 - 完成请求: POST http://localhost:8000/api/v1/agentic/classification - 状态码: 200 - 耗时: 42.7039秒
2025-07-11 09:40:42 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/
2025-07-11 09:40:42 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/ - 状态码: 200 - 耗时: 0.0138秒
2025-07-11 09:40:42 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/static/style.css
2025-07-11 09:40:42 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/static/script.js
2025-07-11 09:40:42 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/static/style.css - 状态码: 200 - 耗时: 0.0523秒
2025-07-11 09:40:42 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/static/script.js - 状态码: 200 - 耗时: 0.0336秒
2025-07-11 09:40:42 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/favicon.ico
2025-07-11 09:40:42 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/favicon.ico - 状态码: 404 - 耗时: 0.0022秒
2025-07-11 09:41:00 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/agentic/classification
2025-07-11 09:41:01 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 4.jpg, 文件夹: images
2025-07-11 09:41:01 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 474010 字节
2025-07-11 09:41:01 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250711094101_4.jpg
2025-07-11 09:41:01 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250711094101_4.jpg
2025-07-11 09:41:01 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250711094101_4.jpg, disposition=inline
2025-07-11 09:41:02 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250711094101_4.jpg
2025-07-11 09:41:02 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250711094101_4.jpg
2025-07-11 09:41:02 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 5.jpg, 文件夹: images
2025-07-11 09:41:02 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 195296 字节
2025-07-11 09:41:02 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250711094102_5.jpg
2025-07-11 09:41:02 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250711094102_5.jpg
2025-07-11 09:41:02 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250711094102_5.jpg, disposition=inline
2025-07-11 09:41:02 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250711094102_5.jpg
2025-07-11 09:41:02 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250711094102_5.jpg
2025-07-11 09:41:25 | INFO | app.core.middleware:dispatch:62 - 完成请求: POST http://localhost:8000/api/v1/agentic/classification - 状态码: 200 - 耗时: 24.6518秒
2025-07-11 09:45:16 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/
2025-07-11 09:45:16 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/ - 状态码: 200 - 耗时: 0.0113秒
2025-07-11 09:45:16 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/static/style.css
2025-07-11 09:45:16 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/static/script.js
2025-07-11 09:45:16 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/static/style.css - 状态码: 200 - 耗时: 0.0140秒
2025-07-11 09:45:16 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/static/script.js - 状态码: 200 - 耗时: 0.0084秒
2025-07-11 09:45:17 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/favicon.ico
2025-07-11 09:45:17 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/favicon.ico - 状态码: 404 - 耗时: 0.0088秒
2025-07-11 09:46:41 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/
2025-07-11 09:46:41 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/ - 状态码: 200 - 耗时: 0.0052秒
2025-07-11 09:46:41 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/static/style.css
2025-07-11 09:46:41 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/static/script.js
2025-07-11 09:46:41 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/static/style.css - 状态码: 200 - 耗时: 0.0243秒
2025-07-11 09:46:41 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/static/script.js - 状态码: 200 - 耗时: 0.0234秒
2025-07-11 09:51:26 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/agentic/classification
2025-07-11 09:51:27 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: 发票.png, 文件夹: images
2025-07-11 09:51:27 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 181542 字节
2025-07-11 09:51:27 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250711095127_发票.png
2025-07-11 09:51:27 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250711095127_发票.png
2025-07-11 09:51:27 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250711095127_发票.png, disposition=inline
2025-07-11 09:51:27 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250711095127_发票.png
2025-07-11 09:51:27 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250711095127_发票.png
2025-07-11 09:51:53 | INFO | app.core.middleware:dispatch:62 - 完成请求: POST http://localhost:8000/api/v1/agentic/classification - 状态码: 200 - 耗时: 26.2017秒
2025-07-11 09:56:54 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/
2025-07-11 09:56:54 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/ - 状态码: 200 - 耗时: 0.0328秒
2025-07-11 09:56:54 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/static/style.css
2025-07-11 09:56:54 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/static/script.js
2025-07-11 09:56:54 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/static/style.css - 状态码: 200 - 耗时: 0.0334秒
2025-07-11 09:56:54 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/static/script.js - 状态码: 200 - 耗时: 0.0301秒
2025-07-11 09:56:54 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/favicon.ico
2025-07-11 09:56:54 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/favicon.ico - 状态码: 404 - 耗时: 0.0143秒
2025-07-11 09:57:18 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: temp_file_187650862511808.jpg, 文件夹: images
2025-07-11 09:57:18 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 814248 字节
2025-07-11 09:57:18 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250711095718_temp_file_187650862511808.jpg
2025-07-11 09:57:18 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250711095718_temp_file_187650862511808.jpg
2025-07-11 09:57:18 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250711095718_temp_file_187650862511808.jpg, disposition=inline
2025-07-11 09:57:19 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250711095718_temp_file_187650862511808.jpg
2025-07-11 09:57:19 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250711095718_temp_file_187650862511808.jpg
2025-07-11 09:57:19 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: temp_file_281473302667280.jpg, 文件夹: images
2025-07-11 09:57:19 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 5558278 字节
2025-07-11 09:57:19 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250711095719_temp_file_281473302667280.jpg
2025-07-11 09:57:19 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250711095719_temp_file_281473302667280.jpg
2025-07-11 09:57:19 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250711095719_temp_file_281473302667280.jpg, disposition=inline
2025-07-11 09:57:19 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250711095719_temp_file_281473302667280.jpg
2025-07-11 09:57:19 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250711095719_temp_file_281473302667280.jpg
2025-07-11 10:01:18 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/
2025-07-11 10:01:18 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/ - 状态码: 200 - 耗时: 0.0222秒
2025-07-11 10:01:18 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/static/style.css
2025-07-11 10:01:18 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/static/script.js
2025-07-11 10:01:18 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/static/script.js - 状态码: 200 - 耗时: 0.0803秒
2025-07-11 10:01:18 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/static/style.css - 状态码: 200 - 耗时: 0.0833秒
2025-07-11 10:01:19 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/favicon.ico
2025-07-11 10:01:19 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/favicon.ico - 状态码: 404 - 耗时: 0.0088秒
2025-07-11 10:01:28 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: temp_file_187651542147040.jpg, 文件夹: images
2025-07-11 10:01:28 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 814248 字节
2025-07-11 10:01:28 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250711100128_temp_file_187651542147040.jpg
2025-07-11 10:01:28 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250711100128_temp_file_187651542147040.jpg
2025-07-11 10:01:28 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250711100128_temp_file_187651542147040.jpg, disposition=inline
2025-07-11 10:01:29 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250711100128_temp_file_187651542147040.jpg
2025-07-11 10:01:29 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250711100128_temp_file_187651542147040.jpg
2025-07-11 10:01:29 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: temp_file_281472784605200.jpg, 文件夹: images
2025-07-11 10:01:29 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 5558278 字节
2025-07-11 10:01:29 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250711100129_temp_file_281472784605200.jpg
2025-07-11 10:01:29 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250711100129_temp_file_281472784605200.jpg
2025-07-11 10:01:29 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250711100129_temp_file_281472784605200.jpg, disposition=inline
2025-07-11 10:01:29 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250711100129_temp_file_281472784605200.jpg
2025-07-11 10:01:29 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250711100129_temp_file_281472784605200.jpg
2025-07-11 10:01:29 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: temp_file_187651538188912.jpg, 文件夹: images
2025-07-11 10:01:29 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 603343 字节
2025-07-11 10:01:29 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250711100129_temp_file_187651538188912.jpg
2025-07-11 10:01:29 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250711100129_temp_file_187651538188912.jpg
2025-07-11 10:01:29 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250711100129_temp_file_187651538188912.jpg, disposition=inline
2025-07-11 10:01:29 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250711100129_temp_file_187651538188912.jpg
2025-07-11 10:01:29 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250711100129_temp_file_187651538188912.jpg
2025-07-11 10:04:41 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/
2025-07-11 10:04:41 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/ - 状态码: 200 - 耗时: 0.0553秒
2025-07-11 10:04:41 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/static/style.css
2025-07-11 10:04:41 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/static/script.js
2025-07-11 10:04:41 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/static/script.js - 状态码: 200 - 耗时: 0.0114秒
2025-07-11 10:04:41 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/static/style.css - 状态码: 304 - 耗时: 0.0174秒
2025-07-11 10:04:42 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/favicon.ico
2025-07-11 10:04:42 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/favicon.ico - 状态码: 404 - 耗时: 0.0239秒
2025-07-11 10:06:00 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/
2025-07-11 10:06:00 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/ - 状态码: 200 - 耗时: 0.0332秒
2025-07-11 10:06:00 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/static/script.js
2025-07-11 10:06:00 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/static/style.css
2025-07-11 10:06:00 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/static/style.css - 状态码: 200 - 耗时: 0.0121秒
2025-07-11 10:06:00 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/static/script.js - 状态码: 200 - 耗时: 0.0163秒
2025-07-11 10:06:00 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/favicon.ico
2025-07-11 10:06:00 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/favicon.ico - 状态码: 404 - 耗时: 0.0190秒
2025-07-11 10:06:09 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: temp_file_187651507696592.jpg, 文件夹: images
2025-07-11 10:06:09 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 181542 字节
2025-07-11 10:06:09 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250711100609_temp_file_187651507696592.jpg
2025-07-11 10:06:09 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250711100609_temp_file_187651507696592.jpg
2025-07-11 10:06:09 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250711100609_temp_file_187651507696592.jpg, disposition=inline
2025-07-11 10:06:10 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250711100609_temp_file_187651507696592.jpg
2025-07-11 10:06:10 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250711100609_temp_file_187651507696592.jpg
2025-07-11 10:06:23 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: temp_file_187651534191488.jpg, 文件夹: images
2025-07-11 10:06:23 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 347913 字节
2025-07-11 10:06:23 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250711100623_temp_file_187651534191488.jpg
2025-07-11 10:06:23 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250711100623_temp_file_187651534191488.jpg
2025-07-11 10:06:23 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250711100623_temp_file_187651534191488.jpg, disposition=inline
2025-07-11 10:06:23 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250711100623_temp_file_187651534191488.jpg
2025-07-11 10:06:23 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250711100623_temp_file_187651534191488.jpg
2025-07-11 10:12:02 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/
2025-07-11 10:12:02 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/ - 状态码: 200 - 耗时: 0.0329秒
2025-07-11 10:12:02 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/static/style.css
2025-07-11 10:12:02 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/static/script.js
2025-07-11 10:12:02 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/static/script.js - 状态码: 200 - 耗时: 0.0644秒
2025-07-11 10:12:02 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/static/style.css - 状态码: 304 - 耗时: 0.0744秒
2025-07-11 10:12:02 | INFO | app.core.middleware:dispatch:54 - 开始请求: GET http://localhost:8000/favicon.ico
2025-07-11 10:12:02 | INFO | app.core.middleware:dispatch:62 - 完成请求: GET http://localhost:8000/favicon.ico - 状态码: 404 - 耗时: 0.0068秒
2025-07-11 10:12:13 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: temp_file_187651213942144.jpg, 文件夹: images
2025-07-11 10:12:13 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 181542 字节
2025-07-11 10:12:13 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250711101213_temp_file_187651213942144.jpg
2025-07-11 10:12:13 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250711101213_temp_file_187651213942144.jpg
2025-07-11 10:12:13 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250711101213_temp_file_187651213942144.jpg, disposition=inline
2025-07-11 10:12:13 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250711101213_temp_file_187651213942144.jpg
2025-07-11 10:12:13 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250711101213_temp_file_187651213942144.jpg
2025-07-11 10:12:13 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: temp_file_187651215714288.jpg, 文件夹: images
2025-07-11 10:12:13 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 347913 字节
2025-07-11 10:12:13 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250711101213_temp_file_187651215714288.jpg
2025-07-11 10:12:13 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250711101213_temp_file_187651215714288.jpg
2025-07-11 10:12:13 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250711101213_temp_file_187651215714288.jpg, disposition=inline
2025-07-11 10:12:13 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250711101213_temp_file_187651215714288.jpg
2025-07-11 10:12:13 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250711101213_temp_file_187651215714288.jpg
2025-07-11 10:12:14 | DEBUG | app.integrations.cos:upload_file:39 - COS服务开始上传文件: temp_file_187651217306464.jpg, 文件夹: images
2025-07-11 10:12:14 | DEBUG | app.integrations.cos:upload_file:57 - 文件大小: 488408 字节
2025-07-11 10:12:14 | DEBUG | app.integrations.cos:upload_file:81 - 生成唯一文件名: 20250711101214_temp_file_187651217306464.jpg
2025-07-11 10:12:14 | DEBUG | app.integrations.cos:upload_file:88 - 对象键: images/20250711101214_temp_file_187651217306464.jpg
2025-07-11 10:12:14 | DEBUG | app.integrations.cos:upload_file:95 - 开始上传到COS: Bucket=hui-ai-lawyer-1309488351, Key=images/20250711101214_temp_file_187651217306464.jpg, disposition=inline
2025-07-11 10:12:14 | DEBUG | app.integrations.cos:upload_file:105 - COS上传成功: images/20250711101214_temp_file_187651217306464.jpg
2025-07-11 10:12:14 | DEBUG | app.integrations.cos:upload_file:109 - 生成文件URL: https://hui-ai-lawyer-1309488351.cos.ap-guangzhou.myqcloud.com/images/20250711101214_temp_file_187651217306464.jpg
2025-07-11 10:21:58 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/agentic/classification
2025-07-11 10:21:59 | ERROR | app.core.middleware:dispatch:66 - 请求异常: POST http://localhost:8000/api/v1/agentic/classification - 错误: object NoneType can't be used in 'await' expression
2025-07-11 10:21:59 | ERROR | app.core.middleware:global_exception_handler:39 - Unhandled error: object NoneType can't be used in 'await' expression
  + Exception Group Traceback (most recent call last):
  |
  |   File "/app/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 177, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                │     │                      └ <anyio._backends._asyncio.TaskGroup object at 0xffff9d1392b0>
  |                │     └ <function create_task_group at 0xffffa4380f40>
  |                └ <module 'anyio' from '/app/.venv/lib/python3.12/site-packages/anyio/__init__.py'>
  |   File "/app/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  |
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |           │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffa0834900>
    |           │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff9f2...
    |           │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.112.3', 8000),...
    |           │    └ <app.core.middleware.LoggingMiddleware object at 0xffff9f2459d0>
    |           └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff9f245a30>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 176, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |          │            │            └ <function collapse_excgroups at 0xffffa3010f40>
    |          │            └ MemoryObjectSendStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_receive...
    |          └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
    |   File "/usr/local/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |     │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [TypeError("object NoneType can't be used in 'await' expression")])
    |     │    │   └ <method 'throw' of 'generator' objects>
    |     │    └ <generator object collapse_excgroups at 0xffff9f2c6e90>
    |     └ <contextlib._GeneratorContextManager object at 0xffff9d1392e0>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 178, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                      │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff9f27ab60>
    |                      │    │             └ <starlette.middleware.base._CachedRequest object at 0xffff9d138710>
    |                      │    └ <bound method LoggingMiddleware.dispatch of <app.core.middleware.LoggingMiddleware object at 0xffff9f2459d0>>
    |                      └ <app.core.middleware.LoggingMiddleware object at 0xffff9f2459d0>
    |
    |   File "/app/app/core/middleware.py", line 57, in dispatch
    |     response = await call_next(request)
    |                      │         └ <starlette.middleware.base._CachedRequest object at 0xffff9d138710>
    |                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff9f27ab60>
    |
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 156, in call_next
    |     raise app_exc
    |           └ TypeError("object NoneType can't be used in 'await' expression")
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 141, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |           │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff9f27af20>
    |           │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff9f27a840>
    |           │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.112.3', 8000),...
    |           │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff9f245730>
    |           └ <app.core.middleware.LoggingMiddleware object at 0xffff9f2459d0>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |           │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff9f27af20>
    |           │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff9f27a840>
    |           │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.112.3', 8000),...
    |           │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff9f2459a0>
    |           └ <starlette.middleware.cors.CORSMiddleware object at 0xffff9f245730>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |           │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff9f27af20>
    |           │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff9f27a840>
    |           │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.112.3', 8000),...
    |           │                            │    │    └ <starlette.requests.Request object at 0xffff9d1391f0>
    |           │                            │    └ <fastapi.routing.APIRouter object at 0xffffa2f634a0>
    |           │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff9f2459a0>
    |           └ <function wrap_app_handling_exceptions at 0xffffa3033100>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |           │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff9f279bc0>
    |           │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff9f27a840>
    |           │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.112.3', 8000),...
    |           └ <fastapi.routing.APIRouter object at 0xffffa2f634a0>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |           │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff9f279bc0>
    |           │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff9f27a840>
    |           │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.112.3', 8000),...
    |           │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0xffffa2f634a0>>
    |           └ <fastapi.routing.APIRouter object at 0xffffa2f634a0>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |           │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff9f279bc0>
    |           │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff9f27a840>
    |           │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.112.3', 8000),...
    |           │     └ <function Route.handle at 0xffffa2ef45e0>
    |           └ APIRoute(path='/api/v1/agentic/classification', name='classify_evidence_endpoint', methods=['POST'])
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |           │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff9f279bc0>
    |           │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff9f27a840>
    |           │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.112.3', 8000),...
    |           │    └ <function request_response.<locals>.app at 0xffff9f40a520>
    |           └ APIRoute(path='/api/v1/agentic/classification', name='classify_evidence_endpoint', methods=['POST'])
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |           │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff9f279bc0>
    |           │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff9f27a840>
    |           │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.112.3', 8000),...
    |           │                            │    └ <starlette.requests.Request object at 0xffff9d138e60>
    |           │                            └ <function request_response.<locals>.app.<locals>.app at 0xffff9f279620>
    |           └ <function wrap_app_handling_exceptions at 0xffffa3033100>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |           │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff9f27aac0>
    |           │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff9f27a840>
    |           │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.112.3', 8000),...
    |           └ <function request_response.<locals>.app.<locals>.app at 0xffff9f279620>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                      │ └ <starlette.requests.Request object at 0xffff9d138e60>
    |                      └ <function get_request_handler.<locals>.app at 0xffff9f40a3e0>
    |   File "/app/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                          └ <function run_endpoint_function at 0xffffa3032f20>
    |   File "/app/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |                  │         │      └ {'db': <sqlalchemy.ext.asyncio.session.AsyncSession object at 0xffff9f2aa5a0>, 'current_staff': <app.staffs.models.Staff obje...
    |                  │         └ <function classify_evidence_endpoint at 0xffffa0a97ba0>
    |                  └ Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[ModelField(field_info=File(Pydant...
    |
    |   File "/app/app/agentic/routers.py", line 54, in classify_evidence_endpoint
    |     result = await classify_evidence(files, lambda x: print(x)) # Dummy callback for HTTP
    |                    │                 └ [UploadFile(filename='发票.png', size=181542, headers=Headers({'content-disposition': 'form-data; name="files"; filename="å\x8f...
    |                    └ <function classify_evidence at 0xffffa0a95f80>
    |
    |   File "/app/app/agentic/services.py", line 26, in classify_evidence
    |     await send_progress({"status": "uploading", "file_index": i, "total_files": len(files), "filename": file.filename})
    |           │                                                   │                     │                   │    └ '发票.png'
    |           │                                                   │                     │                   └ UploadFile(filename='发票.png', size=181542, headers=Headers({'content-disposition': 'form-data; name="files"; filename="å\x8f\...
    |           │                                                   │                     └ [UploadFile(filename='发票.png', size=181542, headers=Headers({'content-disposition': 'form-data; name="files"; filename="å\x8f...
    |           │                                                   └ 0
    |           └ <function classify_evidence_endpoint.<locals>.<lambda> at 0xffff9d1a0ae0>
    |
    | TypeError: object NoneType can't be used in 'await' expression
    +------------------------------------


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/app/.venv/bin/uvicorn", line 10, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/app/.venv/lib/python3.12/site-packages/click/core.py", line 1442, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffffa46bd620>
           └ <Command main>
  File "/app/.venv/lib/python3.12/site-packages/click/core.py", line 1363, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffffa4976570>
         │    └ <function Command.invoke at 0xffffa46bd300>
         └ <Command main>
  File "/app/.venv/lib/python3.12/site-packages/click/core.py", line 1226, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffffa4976570>
           │   │      │    └ <function main at 0xffffa44480e0>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffffa46bc540>
           └ <click.core.Context object at 0xffffa4976570>
  File "/app/.venv/lib/python3.12/site-packages/click/core.py", line 794, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffffa44480e0>
  File "/app/.venv/lib/python3.12/site-packages/uvicorn/main.py", line 413, in main
    run(
    └ <function run at 0xffffa46bbb00>
  File "/app/.venv/lib/python3.12/site-packages/uvicorn/main.py", line 580, in run
    server.run()
    │      └ <function Server.run at 0xffffa44c4180>
    └ <uvicorn.server.Server object at 0xffffa54f5400>
  File "/app/.venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffffa44c4220>
           │       │   └ <uvicorn.server.Server object at 0xffffa54f5400>
           │       └ <function run at 0xffffa569c680>
           └ <module 'asyncio' from '/usr/local/lib/python3.12/asyncio/__init__.py'>
  File "/usr/local/lib/python3.12/asyncio/runners.py", line 195, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffffa43f67a0>
           │      └ <function Runner.run at 0xffffa51002c0>
           └ <asyncio.runners.Runner object at 0xffffa49767b0>
  File "/usr/local/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /app/.venv/lib/python3.12/site-packages/uvicorn/server.py:71> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffffa43cc450>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffffa49767b0>
  File "/app/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff9f8a00e0>
  File "/app/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff9f27f7...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff9f2...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.112.3', 8000),...
                 │    └ <fastapi.applications.FastAPI object at 0xffffa33816a0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff9f8a00e0>
  File "/app/.venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff9f27f7...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff9f2...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.112.3', 8000),...
  File "/app/.venv/lib/python3.12/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff9f27f7...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff9f2...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.112.3', 8000),...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff9f245a30>
          └ <fastapi.applications.FastAPI object at 0xffffa33816a0>
> File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffffa0834900>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff9f2...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.112.3', 8000),...
          │    └ <app.core.middleware.LoggingMiddleware object at 0xffff9f2459d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff9f245a30>
  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 176, in __call__
    with recv_stream, send_stream, collapse_excgroups():
         │            │            └ <function collapse_excgroups at 0xffffa3010f40>
         │            └ MemoryObjectSendStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_receive...
         └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [TypeError("object NoneType can't be used in 'await' expression")])
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0xffff9f2c6e90>
    └ <contextlib._GeneratorContextManager object at 0xffff9d1392e0>
  File "/app/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 178, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff9f27ab60>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0xffff9d138710>
                     │    └ <bound method LoggingMiddleware.dispatch of <app.core.middleware.LoggingMiddleware object at 0xffff9f2459d0>>
                     └ <app.core.middleware.LoggingMiddleware object at 0xffff9f2459d0>

  File "/app/app/core/middleware.py", line 57, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0xffff9d138710>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff9f27ab60>

  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 156, in call_next
    raise app_exc
          └ TypeError("object NoneType can't be used in 'await' expression")
  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff9f27af20>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff9f27a840>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.112.3', 8000),...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff9f245730>
          └ <app.core.middleware.LoggingMiddleware object at 0xffff9f2459d0>
  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff9f27af20>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff9f27a840>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.112.3', 8000),...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff9f2459a0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffff9f245730>
  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff9f27af20>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff9f27a840>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.112.3', 8000),...
          │                            │    │    └ <starlette.requests.Request object at 0xffff9d1391f0>
          │                            │    └ <fastapi.routing.APIRouter object at 0xffffa2f634a0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff9f2459a0>
          └ <function wrap_app_handling_exceptions at 0xffffa3033100>
  File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff9f279bc0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff9f27a840>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.112.3', 8000),...
          └ <fastapi.routing.APIRouter object at 0xffffa2f634a0>
  File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff9f279bc0>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff9f27a840>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.112.3', 8000),...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0xffffa2f634a0>>
          └ <fastapi.routing.APIRouter object at 0xffffa2f634a0>
  File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff9f279bc0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff9f27a840>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.112.3', 8000),...
          │     └ <function Route.handle at 0xffffa2ef45e0>
          └ APIRoute(path='/api/v1/agentic/classification', name='classify_evidence_endpoint', methods=['POST'])
  File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff9f279bc0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff9f27a840>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.112.3', 8000),...
          │    └ <function request_response.<locals>.app at 0xffff9f40a520>
          └ APIRoute(path='/api/v1/agentic/classification', name='classify_evidence_endpoint', methods=['POST'])
  File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff9f279bc0>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff9f27a840>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.112.3', 8000),...
          │                            │    └ <starlette.requests.Request object at 0xffff9d138e60>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0xffff9f279620>
          └ <function wrap_app_handling_exceptions at 0xffffa3033100>
  File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff9f27aac0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff9f27a840>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.112.3', 8000),...
          └ <function request_response.<locals>.app.<locals>.app at 0xffff9f279620>
  File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0xffff9d138e60>
                     └ <function get_request_handler.<locals>.app at 0xffff9f40a3e0>
  File "/app/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xffffa3032f20>
  File "/app/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.ext.asyncio.session.AsyncSession object at 0xffff9f2aa5a0>, 'current_staff': <app.staffs.models.Staff obje...
                 │         └ <function classify_evidence_endpoint at 0xffffa0a97ba0>
                 └ Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[ModelField(field_info=File(Pydant...

  File "/app/app/agentic/routers.py", line 54, in classify_evidence_endpoint
    result = await classify_evidence(files, lambda x: print(x)) # Dummy callback for HTTP
                   │                 └ [UploadFile(filename='发票.png', size=181542, headers=Headers({'content-disposition': 'form-data; name="files"; filename="å\x8f...
                   └ <function classify_evidence at 0xffffa0a95f80>

  File "/app/app/agentic/services.py", line 26, in classify_evidence
    await send_progress({"status": "uploading", "file_index": i, "total_files": len(files), "filename": file.filename})
          │                                                   │                     │                   │    └ '发票.png'
          │                                                   │                     │                   └ UploadFile(filename='发票.png', size=181542, headers=Headers({'content-disposition': 'form-data; name="files"; filename="å\x8f\...
          │                                                   │                     └ [UploadFile(filename='发票.png', size=181542, headers=Headers({'content-disposition': 'form-data; name="files"; filename="å\x8f...
          │                                                   └ 0
          └ <function classify_evidence_endpoint.<locals>.<lambda> at 0xffff9d1a0ae0>

TypeError: object NoneType can't be used in 'await' expression
2025-07-11 10:25:47 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/agentic/classification
2025-07-11 10:25:47 | ERROR | app.core.middleware:dispatch:66 - 请求异常: POST http://localhost:8000/api/v1/agentic/classification - 错误: object NoneType can't be used in 'await' expression
2025-07-11 10:25:47 | ERROR | app.core.middleware:global_exception_handler:39 - Unhandled error: object NoneType can't be used in 'await' expression
  + Exception Group Traceback (most recent call last):
  |
  |   File "/app/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 177, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                │     │                      └ <anyio._backends._asyncio.TaskGroup object at 0xffff8a280920>
  |                │     └ <function create_task_group at 0xffff8f384f40>
  |                └ <module 'anyio' from '/app/.venv/lib/python3.12/site-packages/anyio/__init__.py'>
  |   File "/app/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  |
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |           │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff8a40a980>
    |           │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff8a2...
    |           │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.128.3', 8000),...
    |           │    └ <app.core.middleware.LoggingMiddleware object at 0xffff8a5a91c0>
    |           └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff8a5a9100>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 176, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |          │            │            └ <function collapse_excgroups at 0xffff8e014f40>
    |          │            └ MemoryObjectSendStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_receive...
    |          └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
    |   File "/usr/local/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |     │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [TypeError("object NoneType can't be used in 'await' expression")])
    |     │    │   └ <method 'throw' of 'generator' objects>
    |     │    └ <generator object collapse_excgroups at 0xffff8a4031d0>
    |     └ <contextlib._GeneratorContextManager object at 0xffff8a2808f0>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 178, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                      │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff8a40aa20>
    |                      │    │             └ <starlette.middleware.base._CachedRequest object at 0xffff8a2479b0>
    |                      │    └ <bound method LoggingMiddleware.dispatch of <app.core.middleware.LoggingMiddleware object at 0xffff8a5a91c0>>
    |                      └ <app.core.middleware.LoggingMiddleware object at 0xffff8a5a91c0>
    |
    |   File "/app/app/core/middleware.py", line 57, in dispatch
    |     response = await call_next(request)
    |                      │         └ <starlette.middleware.base._CachedRequest object at 0xffff8a2479b0>
    |                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff8a40aa20>
    |
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 156, in call_next
    |     raise app_exc
    |           └ TypeError("object NoneType can't be used in 'await' expression")
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 141, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |           │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff881c84a0>
    |           │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff881caf20>
    |           │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.128.3', 8000),...
    |           │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff8a34faa0>
    |           └ <app.core.middleware.LoggingMiddleware object at 0xffff8a5a91c0>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |           │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff881c84a0>
    |           │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff881caf20>
    |           │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.128.3', 8000),...
    |           │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff8a5f8620>
    |           └ <starlette.middleware.cors.CORSMiddleware object at 0xffff8a34faa0>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |           │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff881c84a0>
    |           │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff881caf20>
    |           │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.128.3', 8000),...
    |           │                            │    │    └ <starlette.requests.Request object at 0xffff8a280b30>
    |           │                            │    └ <fastapi.routing.APIRouter object at 0xffff8e026180>
    |           │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff8a5f8620>
    |           └ <function wrap_app_handling_exceptions at 0xffff8e033100>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |           │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff8a26a200>
    |           │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff881caf20>
    |           │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.128.3', 8000),...
    |           └ <fastapi.routing.APIRouter object at 0xffff8e026180>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |           │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff8a26a200>
    |           │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff881caf20>
    |           │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.128.3', 8000),...
    |           │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0xffff8e026180>>
    |           └ <fastapi.routing.APIRouter object at 0xffff8e026180>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |           │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff8a26a200>
    |           │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff881caf20>
    |           │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.128.3', 8000),...
    |           │     └ <function Route.handle at 0xffff8def45e0>
    |           └ APIRoute(path='/api/v1/agentic/classification', name='classify_evidence_endpoint', methods=['POST'])
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |           │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff8a26a200>
    |           │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff881caf20>
    |           │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.128.3', 8000),...
    |           │    └ <function request_response.<locals>.app at 0xffff8a40a5c0>
    |           └ APIRoute(path='/api/v1/agentic/classification', name='classify_evidence_endpoint', methods=['POST'])
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |           │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff8a26a200>
    |           │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff881caf20>
    |           │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.128.3', 8000),...
    |           │                            │    └ <starlette.requests.Request object at 0xffff8a280a70>
    |           │                            └ <function request_response.<locals>.app.<locals>.app at 0xffff8a26a160>
    |           └ <function wrap_app_handling_exceptions at 0xffff8e033100>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |           │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff8a26a020>
    |           │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff881caf20>
    |           │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.128.3', 8000),...
    |           └ <function request_response.<locals>.app.<locals>.app at 0xffff8a26a160>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                      │ └ <starlette.requests.Request object at 0xffff8a280a70>
    |                      └ <function get_request_handler.<locals>.app at 0xffff8a40a480>
    |   File "/app/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                          └ <function run_endpoint_function at 0xffff8e032f20>
    |   File "/app/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |                  │         │      └ {'db': <sqlalchemy.ext.asyncio.session.AsyncSession object at 0xffff8a514980>, 'current_staff': <app.staffs.models.Staff obje...
    |                  │         └ <function classify_evidence_endpoint at 0xffff8ba93ba0>
    |                  └ Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[ModelField(field_info=File(Pydant...
    |
    |   File "/app/app/agentic/routers.py", line 54, in classify_evidence_endpoint
    |     result = await classify_evidence(files, lambda x: print(x)) # Dummy callback for HTTP
    |                    │                 └ [UploadFile(filename='发票.png', size=181542, headers=Headers({'content-disposition': 'form-data; name="files"; filename="å\x8f...
    |                    └ <function classify_evidence at 0xffff8ba91f80>
    |
    |   File "/app/app/agentic/services.py", line 26, in classify_evidence
    |     await send_progress({"status": "uploading", "file_index": i, "total_files": len(files), "filename": file.filename})
    |           │                                                   │                     │                   │    └ '发票.png'
    |           │                                                   │                     │                   └ UploadFile(filename='发票.png', size=181542, headers=Headers({'content-disposition': 'form-data; name="files"; filename="å\x8f\...
    |           │                                                   │                     └ [UploadFile(filename='发票.png', size=181542, headers=Headers({'content-disposition': 'form-data; name="files"; filename="å\x8f...
    |           │                                                   └ 0
    |           └ <function classify_evidence_endpoint.<locals>.<lambda> at 0xffff8a2693a0>
    |
    | TypeError: object NoneType can't be used in 'await' expression
    +------------------------------------


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/app/.venv/bin/uvicorn", line 10, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/app/.venv/lib/python3.12/site-packages/click/core.py", line 1442, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffff8f6bd620>
           └ <Command main>
  File "/app/.venv/lib/python3.12/site-packages/click/core.py", line 1363, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffff904f5370>
         │    └ <function Command.invoke at 0xffff8f6bd300>
         └ <Command main>
  File "/app/.venv/lib/python3.12/site-packages/click/core.py", line 1226, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffff904f5370>
           │   │      │    └ <function main at 0xffff8f4480e0>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffff8f6bc540>
           └ <click.core.Context object at 0xffff904f5370>
  File "/app/.venv/lib/python3.12/site-packages/click/core.py", line 794, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffff8f4480e0>
  File "/app/.venv/lib/python3.12/site-packages/uvicorn/main.py", line 413, in main
    run(
    └ <function run at 0xffff8f6bbb00>
  File "/app/.venv/lib/python3.12/site-packages/uvicorn/main.py", line 580, in run
    server.run()
    │      └ <function Server.run at 0xffff8f4c4180>
    └ <uvicorn.server.Server object at 0xffff90317aa0>
  File "/app/.venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffff8f4c4220>
           │       │   └ <uvicorn.server.Server object at 0xffff90317aa0>
           │       └ <function run at 0xffff9069c680>
           └ <module 'asyncio' from '/usr/local/lib/python3.12/asyncio/__init__.py'>
  File "/usr/local/lib/python3.12/asyncio/runners.py", line 195, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffff8f3f67a0>
           │      └ <function Runner.run at 0xffff901002c0>
           └ <asyncio.runners.Runner object at 0xffff904f5400>
  File "/usr/local/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /app/.venv/lib/python3.12/site-packages/uvicorn/server.py:71> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffff8f3c8450>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffff904f5400>
  File "/app/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8f6dbb60>
  File "/app/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff8a2477...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff8a2...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.128.3', 8000),...
                 │    └ <fastapi.applications.FastAPI object at 0xffff8f097ec0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8f6dbb60>
  File "/app/.venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff8a2477...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff8a2...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.128.3', 8000),...
  File "/app/.venv/lib/python3.12/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff8a2477...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff8a2...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.128.3', 8000),...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff8a5a9100>
          └ <fastapi.applications.FastAPI object at 0xffff8f097ec0>
> File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff8a40a980>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff8a2...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.128.3', 8000),...
          │    └ <app.core.middleware.LoggingMiddleware object at 0xffff8a5a91c0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff8a5a9100>
  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 176, in __call__
    with recv_stream, send_stream, collapse_excgroups():
         │            │            └ <function collapse_excgroups at 0xffff8e014f40>
         │            └ MemoryObjectSendStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_receive...
         └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [TypeError("object NoneType can't be used in 'await' expression")])
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0xffff8a4031d0>
    └ <contextlib._GeneratorContextManager object at 0xffff8a2808f0>
  File "/app/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 178, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff8a40aa20>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0xffff8a2479b0>
                     │    └ <bound method LoggingMiddleware.dispatch of <app.core.middleware.LoggingMiddleware object at 0xffff8a5a91c0>>
                     └ <app.core.middleware.LoggingMiddleware object at 0xffff8a5a91c0>

  File "/app/app/core/middleware.py", line 57, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0xffff8a2479b0>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff8a40aa20>

  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 156, in call_next
    raise app_exc
          └ TypeError("object NoneType can't be used in 'await' expression")
  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff881c84a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff881caf20>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.128.3', 8000),...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff8a34faa0>
          └ <app.core.middleware.LoggingMiddleware object at 0xffff8a5a91c0>
  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff881c84a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff881caf20>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.128.3', 8000),...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff8a5f8620>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffff8a34faa0>
  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff881c84a0>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff881caf20>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.128.3', 8000),...
          │                            │    │    └ <starlette.requests.Request object at 0xffff8a280b30>
          │                            │    └ <fastapi.routing.APIRouter object at 0xffff8e026180>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff8a5f8620>
          └ <function wrap_app_handling_exceptions at 0xffff8e033100>
  File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff8a26a200>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff881caf20>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.128.3', 8000),...
          └ <fastapi.routing.APIRouter object at 0xffff8e026180>
  File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff8a26a200>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff881caf20>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.128.3', 8000),...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0xffff8e026180>>
          └ <fastapi.routing.APIRouter object at 0xffff8e026180>
  File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff8a26a200>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff881caf20>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.128.3', 8000),...
          │     └ <function Route.handle at 0xffff8def45e0>
          └ APIRoute(path='/api/v1/agentic/classification', name='classify_evidence_endpoint', methods=['POST'])
  File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff8a26a200>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff881caf20>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.128.3', 8000),...
          │    └ <function request_response.<locals>.app at 0xffff8a40a5c0>
          └ APIRoute(path='/api/v1/agentic/classification', name='classify_evidence_endpoint', methods=['POST'])
  File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff8a26a200>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff881caf20>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.128.3', 8000),...
          │                            │    └ <starlette.requests.Request object at 0xffff8a280a70>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0xffff8a26a160>
          └ <function wrap_app_handling_exceptions at 0xffff8e033100>
  File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff8a26a020>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff881caf20>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.128.3', 8000),...
          └ <function request_response.<locals>.app.<locals>.app at 0xffff8a26a160>
  File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0xffff8a280a70>
                     └ <function get_request_handler.<locals>.app at 0xffff8a40a480>
  File "/app/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xffff8e032f20>
  File "/app/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.ext.asyncio.session.AsyncSession object at 0xffff8a514980>, 'current_staff': <app.staffs.models.Staff obje...
                 │         └ <function classify_evidence_endpoint at 0xffff8ba93ba0>
                 └ Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[ModelField(field_info=File(Pydant...

  File "/app/app/agentic/routers.py", line 54, in classify_evidence_endpoint
    result = await classify_evidence(files, lambda x: print(x)) # Dummy callback for HTTP
                   │                 └ [UploadFile(filename='发票.png', size=181542, headers=Headers({'content-disposition': 'form-data; name="files"; filename="å\x8f...
                   └ <function classify_evidence at 0xffff8ba91f80>

  File "/app/app/agentic/services.py", line 26, in classify_evidence
    await send_progress({"status": "uploading", "file_index": i, "total_files": len(files), "filename": file.filename})
          │                                                   │                     │                   │    └ '发票.png'
          │                                                   │                     │                   └ UploadFile(filename='发票.png', size=181542, headers=Headers({'content-disposition': 'form-data; name="files"; filename="å\x8f\...
          │                                                   │                     └ [UploadFile(filename='发票.png', size=181542, headers=Headers({'content-disposition': 'form-data; name="files"; filename="å\x8f...
          │                                                   └ 0
          └ <function classify_evidence_endpoint.<locals>.<lambda> at 0xffff8a2693a0>

TypeError: object NoneType can't be used in 'await' expression
2025-07-11 10:25:49 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/agentic/classification
2025-07-11 10:25:49 | ERROR | app.core.middleware:dispatch:66 - 请求异常: POST http://localhost:8000/api/v1/agentic/classification - 错误: object NoneType can't be used in 'await' expression
2025-07-11 10:25:49 | ERROR | app.core.middleware:global_exception_handler:39 - Unhandled error: object NoneType can't be used in 'await' expression
  + Exception Group Traceback (most recent call last):
  |
  |   File "/app/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 177, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                │     │                      └ <anyio._backends._asyncio.TaskGroup object at 0xffff8a34cf80>
  |                │     └ <function create_task_group at 0xffff8f384f40>
  |                └ <module 'anyio' from '/app/.venv/lib/python3.12/site-packages/anyio/__init__.py'>
  |   File "/app/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  |
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |           │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff8dc9a660>
    |           │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff8df...
    |           │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.128.3', 8000),...
    |           │    └ <app.core.middleware.LoggingMiddleware object at 0xffff8a5a91c0>
    |           └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff8a5a9100>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 176, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |          │            │            └ <function collapse_excgroups at 0xffff8e014f40>
    |          │            └ MemoryObjectSendStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_receive...
    |          └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
    |   File "/usr/local/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |     │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [TypeError("object NoneType can't be used in 'await' expression")])
    |     │    │   └ <method 'throw' of 'generator' objects>
    |     │    └ <generator object collapse_excgroups at 0xffff8de42dc0>
    |     └ <contextlib._GeneratorContextManager object at 0xffff8df283e0>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 178, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                      │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff8dc9a520>
    |                      │    │             └ <starlette.middleware.base._CachedRequest object at 0xffff8df29d60>
    |                      │    └ <bound method LoggingMiddleware.dispatch of <app.core.middleware.LoggingMiddleware object at 0xffff8a5a91c0>>
    |                      └ <app.core.middleware.LoggingMiddleware object at 0xffff8a5a91c0>
    |
    |   File "/app/app/core/middleware.py", line 57, in dispatch
    |     response = await call_next(request)
    |                      │         └ <starlette.middleware.base._CachedRequest object at 0xffff8df29d60>
    |                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff8dc9a520>
    |
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 156, in call_next
    |     raise app_exc
    |           └ TypeError("object NoneType can't be used in 'await' expression")
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 141, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |           │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff8dc9a340>
    |           │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff8dc9a3e0>
    |           │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.128.3', 8000),...
    |           │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff8a34faa0>
    |           └ <app.core.middleware.LoggingMiddleware object at 0xffff8a5a91c0>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |           │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff8dc9a340>
    |           │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff8dc9a3e0>
    |           │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.128.3', 8000),...
    |           │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff8a5f8620>
    |           └ <starlette.middleware.cors.CORSMiddleware object at 0xffff8a34faa0>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |           │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff8dc9a340>
    |           │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff8dc9a3e0>
    |           │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.128.3', 8000),...
    |           │                            │    │    └ <starlette.requests.Request object at 0xffff8a306300>
    |           │                            │    └ <fastapi.routing.APIRouter object at 0xffff8e026180>
    |           │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff8a5f8620>
    |           └ <function wrap_app_handling_exceptions at 0xffff8e033100>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |           │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff8dc9a0c0>
    |           │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff8dc9a3e0>
    |           │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.128.3', 8000),...
    |           └ <fastapi.routing.APIRouter object at 0xffff8e026180>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |           │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff8dc9a0c0>
    |           │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff8dc9a3e0>
    |           │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.128.3', 8000),...
    |           │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0xffff8e026180>>
    |           └ <fastapi.routing.APIRouter object at 0xffff8e026180>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |           │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff8dc9a0c0>
    |           │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff8dc9a3e0>
    |           │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.128.3', 8000),...
    |           │     └ <function Route.handle at 0xffff8def45e0>
    |           └ APIRoute(path='/api/v1/agentic/classification', name='classify_evidence_endpoint', methods=['POST'])
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |           │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff8dc9a0c0>
    |           │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff8dc9a3e0>
    |           │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.128.3', 8000),...
    |           │    └ <function request_response.<locals>.app at 0xffff8a40a5c0>
    |           └ APIRoute(path='/api/v1/agentic/classification', name='classify_evidence_endpoint', methods=['POST'])
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |           │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff8dc9a0c0>
    |           │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff8dc9a3e0>
    |           │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.128.3', 8000),...
    |           │                            │    └ <starlette.requests.Request object at 0xffff8a306450>
    |           │                            └ <function request_response.<locals>.app.<locals>.app at 0xffff8dc9a020>
    |           └ <function wrap_app_handling_exceptions at 0xffff8e033100>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |           │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff8dc99ee0>
    |           │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff8dc9a3e0>
    |           │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.128.3', 8000),...
    |           └ <function request_response.<locals>.app.<locals>.app at 0xffff8dc9a020>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                      │ └ <starlette.requests.Request object at 0xffff8a306450>
    |                      └ <function get_request_handler.<locals>.app at 0xffff8a40a480>
    |   File "/app/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                          └ <function run_endpoint_function at 0xffff8e032f20>
    |   File "/app/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |                  │         │      └ {'db': <sqlalchemy.ext.asyncio.session.AsyncSession object at 0xffff8a307590>, 'current_staff': <app.staffs.models.Staff obje...
    |                  │         └ <function classify_evidence_endpoint at 0xffff8ba93ba0>
    |                  └ Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[ModelField(field_info=File(Pydant...
    |
    |   File "/app/app/agentic/routers.py", line 54, in classify_evidence_endpoint
    |     result = await classify_evidence(files, lambda x: print(x)) # Dummy callback for HTTP
    |                    │                 └ [UploadFile(filename='发票.png', size=181542, headers=Headers({'content-disposition': 'form-data; name="files"; filename="å\x8f...
    |                    └ <function classify_evidence at 0xffff8ba91f80>
    |
    |   File "/app/app/agentic/services.py", line 26, in classify_evidence
    |     await send_progress({"status": "uploading", "file_index": i, "total_files": len(files), "filename": file.filename})
    |           │                                                   │                     │                   │    └ '发票.png'
    |           │                                                   │                     │                   └ UploadFile(filename='发票.png', size=181542, headers=Headers({'content-disposition': 'form-data; name="files"; filename="å\x8f\...
    |           │                                                   │                     └ [UploadFile(filename='发票.png', size=181542, headers=Headers({'content-disposition': 'form-data; name="files"; filename="å\x8f...
    |           │                                                   └ 0
    |           └ <function classify_evidence_endpoint.<locals>.<lambda> at 0xffff8dc98220>
    |
    | TypeError: object NoneType can't be used in 'await' expression
    +------------------------------------


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/app/.venv/bin/uvicorn", line 10, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/app/.venv/lib/python3.12/site-packages/click/core.py", line 1442, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffff8f6bd620>
           └ <Command main>
  File "/app/.venv/lib/python3.12/site-packages/click/core.py", line 1363, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffff904f5370>
         │    └ <function Command.invoke at 0xffff8f6bd300>
         └ <Command main>
  File "/app/.venv/lib/python3.12/site-packages/click/core.py", line 1226, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffff904f5370>
           │   │      │    └ <function main at 0xffff8f4480e0>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffff8f6bc540>
           └ <click.core.Context object at 0xffff904f5370>
  File "/app/.venv/lib/python3.12/site-packages/click/core.py", line 794, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffff8f4480e0>
  File "/app/.venv/lib/python3.12/site-packages/uvicorn/main.py", line 413, in main
    run(
    └ <function run at 0xffff8f6bbb00>
  File "/app/.venv/lib/python3.12/site-packages/uvicorn/main.py", line 580, in run
    server.run()
    │      └ <function Server.run at 0xffff8f4c4180>
    └ <uvicorn.server.Server object at 0xffff90317aa0>
  File "/app/.venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffff8f4c4220>
           │       │   └ <uvicorn.server.Server object at 0xffff90317aa0>
           │       └ <function run at 0xffff9069c680>
           └ <module 'asyncio' from '/usr/local/lib/python3.12/asyncio/__init__.py'>
  File "/usr/local/lib/python3.12/asyncio/runners.py", line 195, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffff8f3f67a0>
           │      └ <function Runner.run at 0xffff901002c0>
           └ <asyncio.runners.Runner object at 0xffff904f5400>
  File "/usr/local/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /app/.venv/lib/python3.12/site-packages/uvicorn/server.py:71> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffff8f3c8450>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffff904f5400>
  File "/app/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8f6dbb60>
  File "/app/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff8df2a3...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff8df...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.128.3', 8000),...
                 │    └ <fastapi.applications.FastAPI object at 0xffff8f097ec0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff8f6dbb60>
  File "/app/.venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff8df2a3...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff8df...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.128.3', 8000),...
  File "/app/.venv/lib/python3.12/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff8df2a3...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff8df...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.128.3', 8000),...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff8a5a9100>
          └ <fastapi.applications.FastAPI object at 0xffff8f097ec0>
> File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff8dc9a660>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff8df...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.128.3', 8000),...
          │    └ <app.core.middleware.LoggingMiddleware object at 0xffff8a5a91c0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff8a5a9100>
  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 176, in __call__
    with recv_stream, send_stream, collapse_excgroups():
         │            │            └ <function collapse_excgroups at 0xffff8e014f40>
         │            └ MemoryObjectSendStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_receive...
         └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [TypeError("object NoneType can't be used in 'await' expression")])
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0xffff8de42dc0>
    └ <contextlib._GeneratorContextManager object at 0xffff8df283e0>
  File "/app/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 178, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff8dc9a520>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0xffff8df29d60>
                     │    └ <bound method LoggingMiddleware.dispatch of <app.core.middleware.LoggingMiddleware object at 0xffff8a5a91c0>>
                     └ <app.core.middleware.LoggingMiddleware object at 0xffff8a5a91c0>

  File "/app/app/core/middleware.py", line 57, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0xffff8df29d60>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff8dc9a520>

  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 156, in call_next
    raise app_exc
          └ TypeError("object NoneType can't be used in 'await' expression")
  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff8dc9a340>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff8dc9a3e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.128.3', 8000),...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff8a34faa0>
          └ <app.core.middleware.LoggingMiddleware object at 0xffff8a5a91c0>
  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff8dc9a340>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff8dc9a3e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.128.3', 8000),...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff8a5f8620>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffff8a34faa0>
  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff8dc9a340>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff8dc9a3e0>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.128.3', 8000),...
          │                            │    │    └ <starlette.requests.Request object at 0xffff8a306300>
          │                            │    └ <fastapi.routing.APIRouter object at 0xffff8e026180>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff8a5f8620>
          └ <function wrap_app_handling_exceptions at 0xffff8e033100>
  File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff8dc9a0c0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff8dc9a3e0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.128.3', 8000),...
          └ <fastapi.routing.APIRouter object at 0xffff8e026180>
  File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff8dc9a0c0>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff8dc9a3e0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.128.3', 8000),...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0xffff8e026180>>
          └ <fastapi.routing.APIRouter object at 0xffff8e026180>
  File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff8dc9a0c0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff8dc9a3e0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.128.3', 8000),...
          │     └ <function Route.handle at 0xffff8def45e0>
          └ APIRoute(path='/api/v1/agentic/classification', name='classify_evidence_endpoint', methods=['POST'])
  File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff8dc9a0c0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff8dc9a3e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.128.3', 8000),...
          │    └ <function request_response.<locals>.app at 0xffff8a40a5c0>
          └ APIRoute(path='/api/v1/agentic/classification', name='classify_evidence_endpoint', methods=['POST'])
  File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff8dc9a0c0>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff8dc9a3e0>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.128.3', 8000),...
          │                            │    └ <starlette.requests.Request object at 0xffff8a306450>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0xffff8dc9a020>
          └ <function wrap_app_handling_exceptions at 0xffff8e033100>
  File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff8dc99ee0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff8dc9a3e0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.128.3', 8000),...
          └ <function request_response.<locals>.app.<locals>.app at 0xffff8dc9a020>
  File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0xffff8a306450>
                     └ <function get_request_handler.<locals>.app at 0xffff8a40a480>
  File "/app/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xffff8e032f20>
  File "/app/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.ext.asyncio.session.AsyncSession object at 0xffff8a307590>, 'current_staff': <app.staffs.models.Staff obje...
                 │         └ <function classify_evidence_endpoint at 0xffff8ba93ba0>
                 └ Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[ModelField(field_info=File(Pydant...

  File "/app/app/agentic/routers.py", line 54, in classify_evidence_endpoint
    result = await classify_evidence(files, lambda x: print(x)) # Dummy callback for HTTP
                   │                 └ [UploadFile(filename='发票.png', size=181542, headers=Headers({'content-disposition': 'form-data; name="files"; filename="å\x8f...
                   └ <function classify_evidence at 0xffff8ba91f80>

  File "/app/app/agentic/services.py", line 26, in classify_evidence
    await send_progress({"status": "uploading", "file_index": i, "total_files": len(files), "filename": file.filename})
          │                                                   │                     │                   │    └ '发票.png'
          │                                                   │                     │                   └ UploadFile(filename='发票.png', size=181542, headers=Headers({'content-disposition': 'form-data; name="files"; filename="å\x8f\...
          │                                                   │                     └ [UploadFile(filename='发票.png', size=181542, headers=Headers({'content-disposition': 'form-data; name="files"; filename="å\x8f...
          │                                                   └ 0
          └ <function classify_evidence_endpoint.<locals>.<lambda> at 0xffff8dc98220>

TypeError: object NoneType can't be used in 'await' expression
2025-07-11 10:38:32 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/agentic/classification
2025-07-11 10:38:32 | ERROR | app.core.middleware:dispatch:66 - 请求异常: POST http://localhost:8000/api/v1/agentic/classification - 错误: object NoneType can't be used in 'await' expression
2025-07-11 10:38:32 | ERROR | app.core.middleware:global_exception_handler:39 - Unhandled error: object NoneType can't be used in 'await' expression
  + Exception Group Traceback (most recent call last):
  |
  |   File "/app/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 177, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                │     │                      └ <anyio._backends._asyncio.TaskGroup object at 0xffff7e26f530>
  |                │     └ <function create_task_group at 0xffff833a4f40>
  |                └ <module 'anyio' from '/app/.venv/lib/python3.12/site-packages/anyio/__init__.py'>
  |   File "/app/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  |
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |           │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff7e42a7a0>
    |           │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7e2...
    |           │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.144.3', 8000),...
    |           │    └ <app.core.middleware.LoggingMiddleware object at 0xffff7e26d8e0>
    |           └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff7e26d910>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 176, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |          │            │            └ <function collapse_excgroups at 0xffff82034f40>
    |          │            └ MemoryObjectSendStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_receive...
    |          └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
    |   File "/usr/local/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |     │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [TypeError("object NoneType can't be used in 'await' expression")])
    |     │    │   └ <method 'throw' of 'generator' objects>
    |     │    └ <generator object collapse_excgroups at 0xffff7e41b2a0>
    |     └ <contextlib._GeneratorContextManager object at 0xffff7e26f500>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 178, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                      │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff7e42a980>
    |                      │    │             └ <starlette.middleware.base._CachedRequest object at 0xffff7e26e510>
    |                      │    └ <bound method LoggingMiddleware.dispatch of <app.core.middleware.LoggingMiddleware object at 0xffff7e26d8e0>>
    |                      └ <app.core.middleware.LoggingMiddleware object at 0xffff7e26d8e0>
    |
    |   File "/app/app/core/middleware.py", line 57, in dispatch
    |     response = await call_next(request)
    |                      │         └ <starlette.middleware.base._CachedRequest object at 0xffff7e26e510>
    |                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff7e42a980>
    |
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 156, in call_next
    |     raise app_exc
    |           └ TypeError("object NoneType can't be used in 'await' expression")
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 141, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |           │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff7c1ec400>
    |           │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7c1eee80>
    |           │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.144.3', 8000),...
    |           │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff7e26d8b0>
    |           └ <app.core.middleware.LoggingMiddleware object at 0xffff7e26d8e0>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |           │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff7c1ec400>
    |           │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7c1eee80>
    |           │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.144.3', 8000),...
    |           │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff7e26d850>
    |           └ <starlette.middleware.cors.CORSMiddleware object at 0xffff7e26d8b0>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |           │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff7c1ec400>
    |           │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7c1eee80>
    |           │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.144.3', 8000),...
    |           │                            │    │    └ <starlette.requests.Request object at 0xffff7e26f770>
    |           │                            │    └ <fastapi.routing.APIRouter object at 0xffff830bd8e0>
    |           │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff7e26d850>
    |           └ <function wrap_app_handling_exceptions at 0xffff82053100>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |           │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff7e29a160>
    |           │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7c1eee80>
    |           │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.144.3', 8000),...
    |           └ <fastapi.routing.APIRouter object at 0xffff830bd8e0>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |           │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff7e29a160>
    |           │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7c1eee80>
    |           │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.144.3', 8000),...
    |           │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0xffff830bd8e0>>
    |           └ <fastapi.routing.APIRouter object at 0xffff830bd8e0>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |           │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff7e29a160>
    |           │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7c1eee80>
    |           │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.144.3', 8000),...
    |           │     └ <function Route.handle at 0xffff81f145e0>
    |           └ APIRoute(path='/api/v1/agentic/classification', name='classify_evidence_endpoint', methods=['POST'])
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |           │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff7e29a160>
    |           │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7c1eee80>
    |           │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.144.3', 8000),...
    |           │    └ <function request_response.<locals>.app at 0xffff7e42a520>
    |           └ APIRoute(path='/api/v1/agentic/classification', name='classify_evidence_endpoint', methods=['POST'])
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |           │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff7e29a160>
    |           │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7c1eee80>
    |           │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.144.3', 8000),...
    |           │                            │    └ <starlette.requests.Request object at 0xffff7e26f8f0>
    |           │                            └ <function request_response.<locals>.app.<locals>.app at 0xffff7e29a0c0>
    |           └ <function wrap_app_handling_exceptions at 0xffff82053100>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |           │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff7e299f80>
    |           │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7c1eee80>
    |           │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.144.3', 8000),...
    |           └ <function request_response.<locals>.app.<locals>.app at 0xffff7e29a0c0>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                      │ └ <starlette.requests.Request object at 0xffff7e26f8f0>
    |                      └ <function get_request_handler.<locals>.app at 0xffff7e42a3e0>
    |   File "/app/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                          └ <function run_endpoint_function at 0xffff82052f20>
    |   File "/app/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |                  │         │      └ {'db': <sqlalchemy.ext.asyncio.session.AsyncSession object at 0xffff7e26deb0>, 'current_staff': <app.staffs.models.Staff obje...
    |                  │         └ <function classify_evidence_endpoint at 0xffff7fab7ba0>
    |                  └ Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[ModelField(field_info=File(Pydant...
    |
    |   File "/app/app/agentic/routers.py", line 54, in classify_evidence_endpoint
    |     result = await classify_evidence(files, lambda x: print(x)) # Dummy callback for HTTP
    |                    │                 └ [UploadFile(filename='发票.png', size=181542, headers=Headers({'content-disposition': 'form-data; name="files"; filename="å\x8f...
    |                    └ <function classify_evidence at 0xffff7fab5f80>
    |
    |   File "/app/app/agentic/services.py", line 26, in classify_evidence
    |     await send_progress({"status": "uploading", "file_index": i, "total_files": len(files), "filename": file.filename})
    |           │                                                   │                     │                   │    └ '发票.png'
    |           │                                                   │                     │                   └ UploadFile(filename='发票.png', size=181542, headers=Headers({'content-disposition': 'form-data; name="files"; filename="å\x8f\...
    |           │                                                   │                     └ [UploadFile(filename='发票.png', size=181542, headers=Headers({'content-disposition': 'form-data; name="files"; filename="å\x8f...
    |           │                                                   └ 0
    |           └ <function classify_evidence_endpoint.<locals>.<lambda> at 0xffff7e29b060>
    |
    | TypeError: object NoneType can't be used in 'await' expression
    +------------------------------------


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/app/.venv/bin/uvicorn", line 10, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/app/.venv/lib/python3.12/site-packages/click/core.py", line 1442, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffff836dd620>
           └ <Command main>
  File "/app/.venv/lib/python3.12/site-packages/click/core.py", line 1363, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffff84515370>
         │    └ <function Command.invoke at 0xffff836dd300>
         └ <Command main>
  File "/app/.venv/lib/python3.12/site-packages/click/core.py", line 1226, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffff84515370>
           │   │      │    └ <function main at 0xffff834080e0>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffff836dc540>
           └ <click.core.Context object at 0xffff84515370>
  File "/app/.venv/lib/python3.12/site-packages/click/core.py", line 794, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffff834080e0>
  File "/app/.venv/lib/python3.12/site-packages/uvicorn/main.py", line 413, in main
    run(
    └ <function run at 0xffff836dbb00>
  File "/app/.venv/lib/python3.12/site-packages/uvicorn/main.py", line 580, in run
    server.run()
    │      └ <function Server.run at 0xffff834e4180>
    └ <uvicorn.server.Server object at 0xffff839964e0>
  File "/app/.venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffff834e4220>
           │       │   └ <uvicorn.server.Server object at 0xffff839964e0>
           │       └ <function run at 0xffff846bc680>
           └ <module 'asyncio' from '/usr/local/lib/python3.12/asyncio/__init__.py'>
  File "/usr/local/lib/python3.12/asyncio/runners.py", line 195, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffff834167a0>
           │      └ <function Runner.run at 0xffff841202c0>
           └ <asyncio.runners.Runner object at 0xffff83982660>
  File "/usr/local/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /app/.venv/lib/python3.12/site-packages/uvicorn/server.py:71> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffff833e8450>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffff83982660>
  File "/app/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff7e6180e0>
  File "/app/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7e26e3...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7e2...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.144.3', 8000),...
                 │    └ <fastapi.applications.FastAPI object at 0xffff8343e360>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff7e6180e0>
  File "/app/.venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7e26e3...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7e2...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.144.3', 8000),...
  File "/app/.venv/lib/python3.12/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7e26e3...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7e2...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.144.3', 8000),...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff7e26d910>
          └ <fastapi.applications.FastAPI object at 0xffff8343e360>
> File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff7e42a7a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7e2...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.144.3', 8000),...
          │    └ <app.core.middleware.LoggingMiddleware object at 0xffff7e26d8e0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff7e26d910>
  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 176, in __call__
    with recv_stream, send_stream, collapse_excgroups():
         │            │            └ <function collapse_excgroups at 0xffff82034f40>
         │            └ MemoryObjectSendStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_receive...
         └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [TypeError("object NoneType can't be used in 'await' expression")])
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0xffff7e41b2a0>
    └ <contextlib._GeneratorContextManager object at 0xffff7e26f500>
  File "/app/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 178, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff7e42a980>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0xffff7e26e510>
                     │    └ <bound method LoggingMiddleware.dispatch of <app.core.middleware.LoggingMiddleware object at 0xffff7e26d8e0>>
                     └ <app.core.middleware.LoggingMiddleware object at 0xffff7e26d8e0>

  File "/app/app/core/middleware.py", line 57, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0xffff7e26e510>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff7e42a980>

  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 156, in call_next
    raise app_exc
          └ TypeError("object NoneType can't be used in 'await' expression")
  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff7c1ec400>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7c1eee80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.144.3', 8000),...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff7e26d8b0>
          └ <app.core.middleware.LoggingMiddleware object at 0xffff7e26d8e0>
  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff7c1ec400>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7c1eee80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.144.3', 8000),...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff7e26d850>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffff7e26d8b0>
  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff7c1ec400>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7c1eee80>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.144.3', 8000),...
          │                            │    │    └ <starlette.requests.Request object at 0xffff7e26f770>
          │                            │    └ <fastapi.routing.APIRouter object at 0xffff830bd8e0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff7e26d850>
          └ <function wrap_app_handling_exceptions at 0xffff82053100>
  File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff7e29a160>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7c1eee80>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.144.3', 8000),...
          └ <fastapi.routing.APIRouter object at 0xffff830bd8e0>
  File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff7e29a160>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7c1eee80>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.144.3', 8000),...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0xffff830bd8e0>>
          └ <fastapi.routing.APIRouter object at 0xffff830bd8e0>
  File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff7e29a160>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7c1eee80>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.144.3', 8000),...
          │     └ <function Route.handle at 0xffff81f145e0>
          └ APIRoute(path='/api/v1/agentic/classification', name='classify_evidence_endpoint', methods=['POST'])
  File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff7e29a160>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7c1eee80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.144.3', 8000),...
          │    └ <function request_response.<locals>.app at 0xffff7e42a520>
          └ APIRoute(path='/api/v1/agentic/classification', name='classify_evidence_endpoint', methods=['POST'])
  File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff7e29a160>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7c1eee80>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.144.3', 8000),...
          │                            │    └ <starlette.requests.Request object at 0xffff7e26f8f0>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0xffff7e29a0c0>
          └ <function wrap_app_handling_exceptions at 0xffff82053100>
  File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff7e299f80>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff7c1eee80>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.144.3', 8000),...
          └ <function request_response.<locals>.app.<locals>.app at 0xffff7e29a0c0>
  File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0xffff7e26f8f0>
                     └ <function get_request_handler.<locals>.app at 0xffff7e42a3e0>
  File "/app/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xffff82052f20>
  File "/app/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.ext.asyncio.session.AsyncSession object at 0xffff7e26deb0>, 'current_staff': <app.staffs.models.Staff obje...
                 │         └ <function classify_evidence_endpoint at 0xffff7fab7ba0>
                 └ Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[ModelField(field_info=File(Pydant...

  File "/app/app/agentic/routers.py", line 54, in classify_evidence_endpoint
    result = await classify_evidence(files, lambda x: print(x)) # Dummy callback for HTTP
                   │                 └ [UploadFile(filename='发票.png', size=181542, headers=Headers({'content-disposition': 'form-data; name="files"; filename="å\x8f...
                   └ <function classify_evidence at 0xffff7fab5f80>

  File "/app/app/agentic/services.py", line 26, in classify_evidence
    await send_progress({"status": "uploading", "file_index": i, "total_files": len(files), "filename": file.filename})
          │                                                   │                     │                   │    └ '发票.png'
          │                                                   │                     │                   └ UploadFile(filename='发票.png', size=181542, headers=Headers({'content-disposition': 'form-data; name="files"; filename="å\x8f\...
          │                                                   │                     └ [UploadFile(filename='发票.png', size=181542, headers=Headers({'content-disposition': 'form-data; name="files"; filename="å\x8f...
          │                                                   └ 0
          └ <function classify_evidence_endpoint.<locals>.<lambda> at 0xffff7e29b060>

TypeError: object NoneType can't be used in 'await' expression
2025-07-11 10:39:26 | INFO | app.core.middleware:dispatch:54 - 开始请求: POST http://localhost:8000/api/v1/agentic/classification
2025-07-11 10:39:26 | ERROR | app.core.middleware:dispatch:66 - 请求异常: POST http://localhost:8000/api/v1/agentic/classification - 错误: object NoneType can't be used in 'await' expression
2025-07-11 10:39:26 | ERROR | app.core.middleware:global_exception_handler:39 - Unhandled error: object NoneType can't be used in 'await' expression
  + Exception Group Traceback (most recent call last):
  |
  |   File "/app/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 177, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                │     │                      └ <anyio._backends._asyncio.TaskGroup object at 0xffff7c162180>
  |                │     └ <function create_task_group at 0xffff833a4f40>
  |                └ <module 'anyio' from '/app/.venv/lib/python3.12/site-packages/anyio/__init__.py'>
  |   File "/app/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  |
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |           │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff81cb6660>
    |           │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7c1...
    |           │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.144.3', 8000),...
    |           │    └ <app.core.middleware.LoggingMiddleware object at 0xffff7e26d8e0>
    |           └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff7e26d910>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 176, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |          │            │            └ <function collapse_excgroups at 0xffff82034f40>
    |          │            └ MemoryObjectSendStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_receive...
    |          └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
    |   File "/usr/local/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |     │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [TypeError("object NoneType can't be used in 'await' expression")])
    |     │    │   └ <method 'throw' of 'generator' objects>
    |     │    └ <generator object collapse_excgroups at 0xffff81e62dc0>
    |     └ <contextlib._GeneratorContextManager object at 0xffff7c162150>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 178, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                      │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff81cb6520>
    |                      │    │             └ <starlette.middleware.base._CachedRequest object at 0xffff7c162030>
    |                      │    └ <bound method LoggingMiddleware.dispatch of <app.core.middleware.LoggingMiddleware object at 0xffff7e26d8e0>>
    |                      └ <app.core.middleware.LoggingMiddleware object at 0xffff7e26d8e0>
    |
    |   File "/app/app/core/middleware.py", line 57, in dispatch
    |     response = await call_next(request)
    |                      │         └ <starlette.middleware.base._CachedRequest object at 0xffff7c162030>
    |                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff81cb6520>
    |
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 156, in call_next
    |     raise app_exc
    |           └ TypeError("object NoneType can't be used in 'await' expression")
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 141, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |           │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff81cb62a0>
    |           │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff81cb6340>
    |           │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.144.3', 8000),...
    |           │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff7e26d8b0>
    |           └ <app.core.middleware.LoggingMiddleware object at 0xffff7e26d8e0>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |           │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff81cb62a0>
    |           │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff81cb6340>
    |           │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.144.3', 8000),...
    |           │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff7e26d850>
    |           └ <starlette.middleware.cors.CORSMiddleware object at 0xffff7e26d8b0>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |           │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff81cb62a0>
    |           │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff81cb6340>
    |           │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.144.3', 8000),...
    |           │                            │    │    └ <starlette.requests.Request object at 0xffff7c162360>
    |           │                            │    └ <fastapi.routing.APIRouter object at 0xffff830bd8e0>
    |           │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff7e26d850>
    |           └ <function wrap_app_handling_exceptions at 0xffff82053100>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |           │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff81cb6020>
    |           │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff81cb6340>
    |           │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.144.3', 8000),...
    |           └ <fastapi.routing.APIRouter object at 0xffff830bd8e0>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |           │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff81cb6020>
    |           │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff81cb6340>
    |           │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.144.3', 8000),...
    |           │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0xffff830bd8e0>>
    |           └ <fastapi.routing.APIRouter object at 0xffff830bd8e0>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |           │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff81cb6020>
    |           │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff81cb6340>
    |           │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.144.3', 8000),...
    |           │     └ <function Route.handle at 0xffff81f145e0>
    |           └ APIRoute(path='/api/v1/agentic/classification', name='classify_evidence_endpoint', methods=['POST'])
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |           │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff81cb6020>
    |           │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff81cb6340>
    |           │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.144.3', 8000),...
    |           │    └ <function request_response.<locals>.app at 0xffff7e42a520>
    |           └ APIRoute(path='/api/v1/agentic/classification', name='classify_evidence_endpoint', methods=['POST'])
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |           │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff81cb6020>
    |           │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff81cb6340>
    |           │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.144.3', 8000),...
    |           │                            │    └ <starlette.requests.Request object at 0xffff7c1624b0>
    |           │                            └ <function request_response.<locals>.app.<locals>.app at 0xffff81cb5f80>
    |           └ <function wrap_app_handling_exceptions at 0xffff82053100>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |           │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff81cb5e40>
    |           │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff81cb6340>
    |           │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.144.3', 8000),...
    |           └ <function request_response.<locals>.app.<locals>.app at 0xffff81cb5f80>
    |   File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                      │ └ <starlette.requests.Request object at 0xffff7c1624b0>
    |                      └ <function get_request_handler.<locals>.app at 0xffff7e42a3e0>
    |   File "/app/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                          └ <function run_endpoint_function at 0xffff82052f20>
    |   File "/app/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |                  │         │      └ {'db': <sqlalchemy.ext.asyncio.session.AsyncSession object at 0xffff7c163dd0>, 'current_staff': <app.staffs.models.Staff obje...
    |                  │         └ <function classify_evidence_endpoint at 0xffff7fab7ba0>
    |                  └ Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[ModelField(field_info=File(Pydant...
    |
    |   File "/app/app/agentic/routers.py", line 54, in classify_evidence_endpoint
    |     result = await classify_evidence(files, lambda x: print(x)) # Dummy callback for HTTP
    |                    │                 └ [UploadFile(filename='发票.png', size=181542, headers=Headers({'content-disposition': 'form-data; name="files"; filename="å\x8f...
    |                    └ <function classify_evidence at 0xffff7fab5f80>
    |
    |   File "/app/app/agentic/services.py", line 26, in classify_evidence
    |     await send_progress({"status": "uploading", "file_index": i, "total_files": len(files), "filename": file.filename})
    |           │                                                   │                     │                   │    └ '发票.png'
    |           │                                                   │                     │                   └ UploadFile(filename='发票.png', size=181542, headers=Headers({'content-disposition': 'form-data; name="files"; filename="å\x8f\...
    |           │                                                   │                     └ [UploadFile(filename='发票.png', size=181542, headers=Headers({'content-disposition': 'form-data; name="files"; filename="å\x8f...
    |           │                                                   └ 0
    |           └ <function classify_evidence_endpoint.<locals>.<lambda> at 0xffff7e299e40>
    |
    | TypeError: object NoneType can't be used in 'await' expression
    +------------------------------------


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/app/.venv/bin/uvicorn", line 10, in <module>
    sys.exit(main())
    │   │    └ <Command main>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/app/.venv/lib/python3.12/site-packages/click/core.py", line 1442, in __call__
    return self.main(*args, **kwargs)
           │    │     │       └ {}
           │    │     └ ()
           │    └ <function Command.main at 0xffff836dd620>
           └ <Command main>
  File "/app/.venv/lib/python3.12/site-packages/click/core.py", line 1363, in main
    rv = self.invoke(ctx)
         │    │      └ <click.core.Context object at 0xffff84515370>
         │    └ <function Command.invoke at 0xffff836dd300>
         └ <Command main>
  File "/app/.venv/lib/python3.12/site-packages/click/core.py", line 1226, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           │   │      │    │           │   └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │   │      │    │           └ <click.core.Context object at 0xffff84515370>
           │   │      │    └ <function main at 0xffff834080e0>
           │   │      └ <Command main>
           │   └ <function Context.invoke at 0xffff836dc540>
           └ <click.core.Context object at 0xffff84515370>
  File "/app/.venv/lib/python3.12/site-packages/click/core.py", line 794, in invoke
    return callback(*args, **kwargs)
           │         │       └ {'host': '0.0.0.0', 'port': 8000, 'app': 'app.main:app', 'uds': None, 'fd': None, 'reload': False, 'reload_dirs': (), 'reload...
           │         └ ()
           └ <function main at 0xffff834080e0>
  File "/app/.venv/lib/python3.12/site-packages/uvicorn/main.py", line 413, in main
    run(
    └ <function run at 0xffff836dbb00>
  File "/app/.venv/lib/python3.12/site-packages/uvicorn/main.py", line 580, in run
    server.run()
    │      └ <function Server.run at 0xffff834e4180>
    └ <uvicorn.server.Server object at 0xffff839964e0>
  File "/app/.venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0xffff834e4220>
           │       │   └ <uvicorn.server.Server object at 0xffff839964e0>
           │       └ <function run at 0xffff846bc680>
           └ <module 'asyncio' from '/usr/local/lib/python3.12/asyncio/__init__.py'>
  File "/usr/local/lib/python3.12/asyncio/runners.py", line 195, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0xffff834167a0>
           │      └ <function Runner.run at 0xffff841202c0>
           └ <asyncio.runners.Runner object at 0xffff83982660>
  File "/usr/local/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /app/.venv/lib/python3.12/site-packages/uvicorn/server.py:71> wai...
           │    │     └ <cyfunction Loop.run_until_complete at 0xffff833e8450>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0xffff83982660>
  File "/app/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff7e6180e0>
  File "/app/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7c161e...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7c1...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.144.3', 8000),...
                 │    └ <fastapi.applications.FastAPI object at 0xffff8343e360>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xffff7e6180e0>
  File "/app/.venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7c161e...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7c1...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.144.3', 8000),...
  File "/app/.venv/lib/python3.12/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7c161e...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7c1...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.144.3', 8000),...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff7e26d910>
          └ <fastapi.applications.FastAPI object at 0xffff8343e360>
> File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xffff81cb6660>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0xffff7c1...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.144.3', 8000),...
          │    └ <app.core.middleware.LoggingMiddleware object at 0xffff7e26d8e0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xffff7e26d910>
  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 176, in __call__
    with recv_stream, send_stream, collapse_excgroups():
         │            │            └ <function collapse_excgroups at 0xffff82034f40>
         │            └ MemoryObjectSendStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_receive...
         └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/usr/local/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [TypeError("object NoneType can't be used in 'await' expression")])
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object collapse_excgroups at 0xffff81e62dc0>
    └ <contextlib._GeneratorContextManager object at 0xffff7c162150>
  File "/app/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 178, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff81cb6520>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0xffff7c162030>
                     │    └ <bound method LoggingMiddleware.dispatch of <app.core.middleware.LoggingMiddleware object at 0xffff7e26d8e0>>
                     └ <app.core.middleware.LoggingMiddleware object at 0xffff7e26d8e0>

  File "/app/app/core/middleware.py", line 57, in dispatch
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0xffff7c162030>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0xffff81cb6520>

  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 156, in call_next
    raise app_exc
          └ TypeError("object NoneType can't be used in 'await' expression")
  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff81cb62a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff81cb6340>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.144.3', 8000),...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0xffff7e26d8b0>
          └ <app.core.middleware.LoggingMiddleware object at 0xffff7e26d8e0>
  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff81cb62a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff81cb6340>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.144.3', 8000),...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff7e26d850>
          └ <starlette.middleware.cors.CORSMiddleware object at 0xffff7e26d8b0>
  File "/app/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0xffff81cb62a0>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff81cb6340>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.144.3', 8000),...
          │                            │    │    └ <starlette.requests.Request object at 0xffff7c162360>
          │                            │    └ <fastapi.routing.APIRouter object at 0xffff830bd8e0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0xffff7e26d850>
          └ <function wrap_app_handling_exceptions at 0xffff82053100>
  File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff81cb6020>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff81cb6340>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.144.3', 8000),...
          └ <fastapi.routing.APIRouter object at 0xffff830bd8e0>
  File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff81cb6020>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff81cb6340>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.144.3', 8000),...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0xffff830bd8e0>>
          └ <fastapi.routing.APIRouter object at 0xffff830bd8e0>
  File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff81cb6020>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff81cb6340>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.144.3', 8000),...
          │     └ <function Route.handle at 0xffff81f145e0>
          └ APIRoute(path='/api/v1/agentic/classification', name='classify_evidence_endpoint', methods=['POST'])
  File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff81cb6020>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff81cb6340>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.144.3', 8000),...
          │    └ <function request_response.<locals>.app at 0xffff7e42a520>
          └ APIRoute(path='/api/v1/agentic/classification', name='classify_evidence_endpoint', methods=['POST'])
  File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff81cb6020>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff81cb6340>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.144.3', 8000),...
          │                            │    └ <starlette.requests.Request object at 0xffff7c1624b0>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0xffff81cb5f80>
          └ <function wrap_app_handling_exceptions at 0xffff82053100>
  File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/app/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0xffff81cb5e40>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0xffff81cb6340>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('192.168.144.3', 8000),...
          └ <function request_response.<locals>.app.<locals>.app at 0xffff81cb5f80>
  File "/app/.venv/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0xffff7c1624b0>
                     └ <function get_request_handler.<locals>.app at 0xffff7e42a3e0>
  File "/app/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xffff82052f20>
  File "/app/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.ext.asyncio.session.AsyncSession object at 0xffff7c163dd0>, 'current_staff': <app.staffs.models.Staff obje...
                 │         └ <function classify_evidence_endpoint at 0xffff7fab7ba0>
                 └ Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[ModelField(field_info=File(Pydant...

  File "/app/app/agentic/routers.py", line 54, in classify_evidence_endpoint
    result = await classify_evidence(files, lambda x: print(x)) # Dummy callback for HTTP
                   │                 └ [UploadFile(filename='发票.png', size=181542, headers=Headers({'content-disposition': 'form-data; name="files"; filename="å\x8f...
                   └ <function classify_evidence at 0xffff7fab5f80>

  File "/app/app/agentic/services.py", line 26, in classify_evidence
    await send_progress({"status": "uploading", "file_index": i, "total_files": len(files), "filename": file.filename})
          │                                                   │                     │                   │    └ '发票.png'
          │                                                   │                     │                   └ UploadFile(filename='发票.png', size=181542, headers=Headers({'content-disposition': 'form-data; name="files"; filename="å\x8f\...
          │                                                   │                     └ [UploadFile(filename='发票.png', size=181542, headers=Headers({'content-disposition': 'form-data; name="files"; filename="å\x8f...
          │                                                   └ 0
          └ <function classify_evidence_endpoint.<locals>.<lambda> at 0xffff7e299e40>

TypeError: object NoneType can't be used in 'await' expression
